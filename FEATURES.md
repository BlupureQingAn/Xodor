# 代码刷题系统 - 功能文档

## 项目概述

基于 Qt6 的智能代码刷题系统，集成本地 AI 模型（Ollama）和云端 API，支持题库导入、代码编辑、自动编译测试和 AI 分析。

---

## 功能模块

### 1. 题库管理 📚

#### 1.1 题库导入
- [x] 支持 Markdown 格式题库导入
- [x] 三种导入模式：
  - 一个文件一道题
  - 一个文件多道题
  - 混合模式（AI 自动识别）
- [x] 自动解析题目结构（标题、描述、难度、测试用例）
- [x] 批量导入文件夹中的所有 Markdown 文件
- [x] 导入成功提示

**实现状态：** ✅ 完成

#### 1.2 题目结构
- [x] 题目类型：代码题、选择题、填空题
- [x] 难度等级：简单、中等、困难
- [x] 标签系统
- [x] 测试用例（输入/输出）
- [x] 参考答案
- [x] JSON 序列化/反序列化

**实现状态：** ✅ 完成

#### 1.3 题库存储
- [x] JSON 格式存储题目
- [x] 文件系统管理
- [x] 题目搜索（按标题）
- [x] 题目筛选（按难度）
- [ ] 题目分类浏览（按标签）

**实现状态：** ✅ 完成

---

### 2. 代码编辑器 ✏️

#### 2.1 编辑功能
- [x] 基于 QScintilla 的专业代码编辑器
- [x] C++ 语法高亮
- [x] 行号显示
- [x] 自动缩进
- [x] 自动补全（阈值：2 个字符）
- [ ] 代码折叠
- [ ] 多标签页支持

**实现状态：** 基础编辑功能完成

#### 2.2 自动保存
- [x] 实时保存代码（防抖 300ms）
- [x] 保存到本地文件
- [x] 记录最后修改时间
- [x] 按题目 ID 组织保存文件

**实现状态：** ✅ 完成

---

### 3. 编译与测试 🔧

#### 3.1 本地编译
- [x] 支持 g++/clang++ 编译器
- [x] C++17 标准
- [x] 临时文件管理
- [x] 编译错误提示
- [x] 编译失败弹窗提示
- [ ] 编译选项配置（优化级别、警告等）
- [ ] 多文件项目支持

**实现状态：** ✅ 完成

#### 3.2 自动测试
- [x] 运行测试用例
- [x] 输入/输出对比
- [x] 测试结果详细展示（通过/失败、输入输出对比）
- [x] 超时控制（5 秒）
- [x] 通过率统计
- [x] 全部通过时的成功提示
- [ ] 内存使用监控
- [ ] 性能分析

**实现状态：** ✅ 完成

---

### 4. AI 功能 🤖

#### 4.1 Ollama 本地模型
- [x] 连接本地 Ollama 服务
- [x] 支持自定义模型（默认 qwen）
- [x] 代码分析
- [ ] 题目生成
- [ ] 题库解析
- [ ] 错误诊断
- [ ] 优化建议

**实现状态：** 基础连接完成，需要完善提示词和响应处理

#### 4.2 云端 API
- [x] 支持 OpenAI API
- [x] API Key 配置
- [x] 代码分析
- [ ] 自定义 API 端点
- [ ] 多模型切换

**实现状态：** 基础功能完成

#### 4.3 AI 分析面板
- [x] 显示 AI 分析结果
- [x] 可折叠面板
- [x] 手动触发分析
- [ ] 实时分析（代码变化时）
- [ ] 分析历史记录
- [ ] Markdown 渲染

**实现状态：** 基础 UI 完成

#### 4.4 模型微调
- [x] Ollama 模型微调框架
- [x] Modelfile 生成
- [ ] 训练数据准备
- [ ] 微调进度监控
- [ ] 模型评估

**实现状态：** 框架搭建完成

---

### 5. 历史记录 📊

#### 5.1 做题历史
- [x] 记录所有做过的题目
- [x] 显示题目 ID、状态、修改时间
- [x] 代码行数统计
- [ ] 题目难度显示（需要关联题库）
- [ ] 通过率统计
- [ ] 用时统计

**实现状态：** 基础历史记录完成

#### 5.2 错题本
- [ ] 自动记录未通过的题目
- [ ] 错误原因分析
- [ ] 重做功能
- [ ] 错题统计

**实现状态：** 未实现

#### 5.3 进度统计
- [ ] 总题数/已完成题数
- [ ] 按难度统计
- [ ] 按标签统计
- [ ] 学习曲线图表

**实现状态：** 未实现

---

### 6. 用户界面 🎨

#### 6.1 主窗口
- [x] 三栏布局（题目、编辑器、AI 分析）
- [x] 可调整分割比例
- [x] 完整菜单栏（文件、考试、历史、帮助）
- [x] 工具栏（导入、切换题目、运行测试、AI 分析、历史）
- [x] 状态栏（显示题目加载信息）
- [x] 窗口标题显示当前题目和进度
- [x] 快捷键支持（Ctrl+I、Ctrl+H、Ctrl+Q、F5、F6）
- [x] 题目列表侧边栏（可停靠、可隐藏）
- [x] 美化的分隔条（细线、悬停效果）
- [ ] 主题切换（暗色/亮色）

**实现状态：** ✅ 完成

#### 6.2 题目面板
- [x] 题目内容显示（HTML 格式）
- [x] 难度和标签显示
- [x] 上一题/下一题按钮（循环浏览）
- [x] 运行测试按钮
- [ ] 题目收藏
- [ ] 题目笔记

**实现状态：** ✅ 完成

#### 6.3 对话框
- [x] 导入题库对话框
- [x] 历史记录窗口
- [x] 关于对话框
- [ ] 设置对话框
- [ ] 题目生成对话框

**实现状态：** 主要对话框完成

---

### 7. 配置管理 ⚙️

#### 7.1 配置项
- [x] 编译器路径
- [x] Ollama URL 和模型
- [x] 云端 API Key
- [x] JSON 格式存储
- [ ] 编辑器配置（字体、主题）
- [ ] 快捷键配置

**实现状态：** 基础配置完成

#### 7.2 配置界面
- [ ] 图形化设置界面
- [ ] 配置验证
- [ ] 默认值恢复

**实现状态：** 未实现

---

## 待实现功能优先级

### 已完成 ✅
1. ~~**主窗口功能集成**~~ ✅
2. ~~**题目浏览和切换**~~ ✅
3. ~~**编译测试流程**~~ ✅
4. ~~**AI 代码分析优化**~~ ✅
5. ~~**题目列表侧边栏**~~ ✅
6. ~~**题库搜索和过滤**~~ ✅
7. ~~**工具栏**~~ ✅
8. ~~**美化测试结果**~~ ✅

### 高优先级 🔴（亟待改进）
1. **编译器路径自动检测** - 自动查找系统中的 g++/clang++
2. **错误处理优化** - 更友好的错误提示和恢复机制
3. **题库持久化** - 启动时自动加载上次的题库
4. **代码模板** - 提供 C++ 常用代码模板
5. **测试用例编辑** - 允许用户添加/修改测试用例

### 中优先级 🟡
6. **错题本功能** - 自动记录未通过的题目
7. **设置界面** - 图形化配置管理
8. **进度统计** - 显示完成情况和学习曲线
9. **代码对比** - 对比用户代码和参考答案
10. **导出功能** - 导出代码和学习报告

### 低优先级 🟢
11. **AI 题目生成** - 根据题库生成新题
12. **多语言支持** - 支持 Python、Java 等
13. **主题切换** - 暗色/亮色主题
14. **在线题库同步** - 支持 LeetCode 等平台

---

## 技术架构

### 核心技术栈
- **Qt 6.10.0** - GUI 框架
- **QScintilla 2.14.1** - 代码编辑器
- **C++17** - 编程语言
- **CMake + Ninja** - 构建系统
- **Ollama** - 本地 AI 模型

### 模块划分
```
src/
├── ui/          # 界面层
│   ├── MainWindow       - 主窗口
│   ├── QuestionPanel    - 题目面板
│   ├── CodeEditor       - 代码编辑器
│   ├── AIAnalysisPanel  - AI 分析面板
│   ├── ImportDialog     - 导入对话框
│   └── HistoryWidget    - 历史记录
├── core/        # 核心逻辑
│   ├── QuestionBank     - 题库管理
│   ├── Question         - 题目模型
│   ├── AutoSaver        - 自动保存
│   └── CompilerRunner   - 编译运行
├── ai/          # AI 服务
│   ├── AIService        - AI 服务接口
│   ├── OllamaClient     - Ollama 客户端
│   ├── CloudAIClient    - 云端 API 客户端
│   ├── QuestionParser   - 题目解析器
│   └── FineTuneManager  - 微调管理
└── utils/       # 工具类
    ├── FileManager      - 文件管理
    └── ConfigManager    - 配置管理
```

---

## 更新日志

### 2024-11-29

#### 第一阶段：基础架构 ✅
- ✅ 完成项目基础架构搭建
- ✅ 实现题目模型和序列化
- ✅ 实现代码编辑器基础功能
- ✅ 实现自动保存功能
- ✅ 实现编译和测试功能
- ✅ 实现历史记录查看
- ✅ 实现导入对话框
- ✅ 完成 Ollama 和云端 API 客户端
- ✅ 完成题目解析器

#### 第二阶段：核心功能集成 ✅
- ✅ 完成主窗口功能集成
- ✅ 实现题目导入流程（Markdown → 解析 → 保存）
- ✅ 实现题目浏览和切换（上一题/下一题，循环浏览）
- ✅ 实现完整的编译-测试流程
- ✅ 实现测试结果详细展示（通过率、输入输出对比）
- ✅ 实现代码自动保存和加载
- ✅ 实现 AI 代码分析触发
- ✅ 添加菜单栏和快捷键
- ✅ 添加状态栏提示
- ✅ 添加关于对话框

#### 第三阶段：UI 增强 ✅
- ✅ 添加题目列表侧边栏（可停靠）
- ✅ 实现题目搜索功能
- ✅ 实现难度筛选功能
- ✅ 添加工具栏（快速访问常用功能）
- ✅ 美化测试结果显示（CSS 样式、颜色标记）
- ✅ 改进 AI 分析提示词（结构化输出）
- ✅ 美化分隔条样式（细线、悬停效果）

#### 当前状态
**功能完善！** 系统已具备完整的刷题体验：
- 📚 导入和管理 Markdown 题库
- 🔍 搜索和筛选题目（按标题、难度）
- 📝 专业代码编辑器（语法高亮、自动补全）
- ⚡ 快速切换题目（列表点击、工具栏按钮）
- 🔧 编译运行测试（详细结果展示）
- 🤖 AI 代码分析（结构化反馈）
- 📊 历史记录查看
- ⌨️ 快捷键支持（F5 运行、F6 AI分析）

---

## 下一步计划

### 短期目标（本周）
1. **题目列表侧边栏** - 显示所有题目，支持快速跳转
2. **AI 分析优化** - 改进提示词，添加 Markdown 渲染
3. **设置界面** - 图形化配置编译器、AI 等
4. **错误处理优化** - 更友好的错误提示

### 中期目标（本月）
5. **错题本功能** - 自动记录未通过的题目
6. **题库搜索** - 按标题、难度、标签搜索
7. **代码模板** - 提供 C++ 常用模板
8. **进度统计** - 显示完成情况和学习曲线

### 长期目标
9. **AI 题目生成** - 根据题库风格生成新题
10. **多语言支持** - 支持 Python、Java 等
11. **在线题库同步** - 支持 LeetCode 等平台
