# 测试用例修复工具 - 增强验证版本

## 概述

进一步增强测试用例修复工具，重点关注：
1. AI扫描重点检查用文字代替数据的情况
2. 修复后必须是完整数据，带验证机制
3. 题目展示时长IO数据使用固定高度+滚动条

## 改进1：AI扫描重点关注文字代替数据

### 扫描提示词优化

**新增重点检查部分：**

```
【重点检查】
⚠️ 特别注意：用文字或符号代替实际数据的情况！

常见问题：
1. 省略号：如"..."、"...（重复100次）"、"...重复"
2. 文字描述：如"（此处省略98行）"、"（重复n次）"、"（数据过长省略）"
3. 符号代替：如"[...]"、"<省略>"、"..."
4. 不完整数据：描述说100行，实际只有几行
5. 格式问题：输入输出格式不符合题目要求
```

### 检查要点强化

```
【检查要点】
1. 输入数据必须是完整的、可直接复制使用的实际数据
2. 不能包含任何文字描述或符号代替
3. 数据行数必须与描述匹配
4. 期望输出必须完整
5. 格式必须符合题目要求
```

### 示例对比

**会被检测出的问题：**

```
❌ 输入：
100 1
1 0
...（重复98行）
0 0

❌ 输入：
10000 1
（此处省略9998行数据）
0 0

❌ 输入：
[数据过长省略]

❌ 输入：
<省略100行>
```

**正常的数据：**

```
✅ 输入：
100 1
1 0
1 0
1 0
... (完整的100行实际数据)
0 0
```

## 改进2：修复后必须是完整数据

### 修复提示词强化

**新增强调部分：**

```
【修复要求 - 非常重要！】
⚠️ 必须生成完整的、可直接使用的实际数据！

1. 将所有省略号（...）、"重复"标记、文字描述展开为完整的实际数据
2. 不能使用任何文字描述或符号代替数据
3. 数据必须完整、准确、可直接复制使用
4. 如果描述说100行，必须生成完整的100行数据
5. 输入格式必须严格符合题目要求
6. 期望输出也必须是完整的实际数据
```

### 错误示例和正确示例

```
【错误示例】
❌ 错误：
input: "100 1\n1 0\n...（重复98行）\n0 0"

✅ 正确：
input: "100 1\n1 0\n1 0\n1 0\n...(完整的100行)\n0 0"
```

### 重要提醒

```
⚠️ 重要提醒：
- input和output字段必须包含完整的实际数据
- 不能包含"..."、"（重复）"、"省略"等任何文字或符号
- 数据必须可以直接用于程序测试
```

### 验证机制

**应用修复时的验证：**

```cpp
// 验证修复后的数据不包含文字描述或符号
if (newInput.contains("...") || newInput.contains("（重复") || 
    newInput.contains("(重复") || newInput.contains("省略") ||
    newInput.contains("[...]") || newInput.contains("<省略>")) {
    m_logView->append(QString("⚠️ 警告：测试用例 %1 的输入仍包含文字描述，跳过").arg(index + 1));
    validationErrors++;
    continue;
}

if (newOutput.contains("...") || newOutput.contains("（重复") || 
    newOutput.contains("(重复") || newOutput.contains("省略")) {
    m_logView->append(QString("⚠️ 警告：测试用例 %1 的输出仍包含文字描述，跳过").arg(index + 1));
    validationErrors++;
    continue;
}
```

### 保存确认

**保存后验证文件：**

```cpp
// 保存到文件
if (saveFixedQuestion(m_currentQuestion, item.filePath)) {
    m_logView->append(QString("✅ 成功修复并保存 %1 个测试用例到文件").arg(fixedCount));
    if (validationErrors > 0) {
        m_logView->append(QString("⚠️ %1 个测试用例因包含文字描述被跳过").arg(validationErrors));
    }
    
    // 验证文件已保存
    QFile verifyFile(item.filePath);
    if (verifyFile.exists()) {
        m_logView->append(QString("✓ 已确认文件保存：%1").arg(item.filePath));
    }
}
```

### 日志输出示例

```
[1/3] 正在AI修复：字符串处理
✅ 成功修复并保存 2 个测试用例到文件
⚠️ 1 个测试用例因包含文字描述被跳过
✓ 已确认文件保存：data/questions/string_process.json
```

## 改进3：长IO数据使用固定高度+滚动条

### CSS样式优化

**之前：**
```css
.io-block {
    background-color: #1e1e1e;
    padding: 12px;
    /* ... */
    white-space: pre-wrap;
    word-wrap: break-word;
}
```

**现在：**
```css
.io-block {
    background-color: #1e1e1e;
    padding: 12px;
    /* ... */
    white-space: pre-wrap;
    word-wrap: break-word;
    max-height: 200px;           /* 最大高度200px */
    overflow-y: auto;            /* 垂直滚动 */
    overflow-x: auto;            /* 水平滚动 */
}

/* 自定义滚动条样式 */
.io-block::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

.io-block::-webkit-scrollbar-track {
    background: #2a2a2a;
    border-radius: 4px;
}

.io-block::-webkit-scrollbar-thumb {
    background: #555;
    border-radius: 4px;
}

.io-block::-webkit-scrollbar-thumb:hover {
    background: #666;
}
```

### 效果对比

**之前：**
```
┌─────────────────────────────────┐
│ 输入：                           │
│ 100 1                           │
│ 1 0                             │
│ 1 0                             │
│ 1 0                             │
│ ... (100行数据全部显示)          │
│ ... (占用大量空间)               │
│ ... (需要滚动整个页面)           │
│ 0 0                             │
└─────────────────────────────────┘
```

**现在：**
```
┌─────────────────────────────────┐
│ 输入：                      ▲   │
│ 100 1                       █   │
│ 1 0                         █   │
│ 1 0                         ║   │
│ 1 0                         ║   │
│ ... (最多显示200px高度)      ║   │
│ ... (超出部分用滚动条)       ▼   │
└─────────────────────────────────┘
```

### 优势

1. **节省空间** - 每个IO块最多占用200px高度
2. **保持可读性** - 短数据正常显示，长数据可滚动查看
3. **美观的滚动条** - 自定义样式，与主题一致
4. **独立滚动** - 每个IO块独立滚动，不影响页面其他部分

### 适用场景

**短数据（< 200px）：**
- 正常显示，无滚动条
- 用户体验不受影响

**长数据（> 200px）：**
- 显示前200px内容
- 出现滚动条
- 用户可以滚动查看完整数据

## 完整工作流程

### 1. 用户选择题目

```
打开工具 → 显示所有题目 → 用户勾选要检查的题目
```

### 2. AI扫描（重点检查文字代替数据）

```
点击"扫描问题"
    ↓
AI逐个分析题目
    ↓
重点检查：
- 省略号（...）
- 文字描述（"重复"、"省略"）
- 符号代替（[...]、<省略>）
- 数据完整性
    ↓
返回分析结果
```

### 3. 显示扫描结果

```
✅ 题目A - 正常
⚠️ 题目B (2个问题) - 输入包含省略号
⚠️ 题目C (1个问题) - 输入用文字描述代替数据
```

### 4. AI修复（生成完整数据）

```
点击"修复选中"
    ↓
AI逐个修复题目
    ↓
生成完整的实际数据
- 展开所有省略号
- 展开所有"重复"标记
- 替换所有文字描述
- 生成完整的数据行
    ↓
验证修复结果
- 检查是否还有文字描述
- 检查是否还有符号代替
- 跳过不合格的修复
    ↓
保存到文件
    ↓
验证文件已保存
```

### 5. 题目展示（长数据滚动）

```
显示题目
    ↓
渲染测试用例
    ↓
IO数据 < 200px：正常显示
IO数据 > 200px：固定高度 + 滚动条
    ↓
用户可以滚动查看完整数据
```

## 测试要点

### AI扫描测试

- [ ] 能检测出省略号（...）
- [ ] 能检测出"重复"标记
- [ ] 能检测出文字描述
- [ ] 能检测出符号代替
- [ ] 能检测出数据不完整

### AI修复测试

- [ ] 修复后没有省略号
- [ ] 修复后没有"重复"标记
- [ ] 修复后没有文字描述
- [ ] 修复后没有符号代替
- [ ] 修复后数据完整

### 验证机制测试

- [ ] 验证能检测出不合格的修复
- [ ] 验证能跳过不合格的数据
- [ ] 验证能正确统计错误数量
- [ ] 验证能确认文件保存

### UI显示测试

- [ ] 短数据正常显示
- [ ] 长数据显示滚动条
- [ ] 滚动条样式正确
- [ ] 独立滚动正常工作
- [ ] 不影响页面其他部分

## 示例场景

### 场景1：检测并修复省略号

**原始数据：**
```
输入：
100 1
1 0
...（重复98行）
0 0
```

**AI扫描：**
```
⚠️ 发现问题：输入数据包含省略号和文字描述
```

**AI修复：**
```
输入：
100 1
1 0
1 0
1 0
... (完整的100行实际数据)
0 0
```

**验证：**
```
✅ 通过验证：数据完整，无文字描述
✅ 成功保存到文件
```

### 场景2：检测并修复文字描述

**原始数据：**
```
输入：
10000 1
（此处省略9998行数据）
0 0
```

**AI扫描：**
```
⚠️ 发现问题：输入数据用文字描述代替实际数据
```

**AI修复：**
```
输入：
10000 1
1 0
1 0
... (完整的10000行实际数据)
0 0
```

**验证：**
```
✅ 通过验证：数据完整，无文字描述
✅ 成功保存到文件
```

**题目展示：**
```
┌─────────────────────────────────┐
│ 输入：                      ▲   │
│ 10000 1                     █   │
│ 1 0                         █   │
│ 1 0                         ║   │
│ ... (滚动查看完整数据)       ║   │
│ 0 0                         ▼   │
└─────────────────────────────────┘
```

### 场景3：验证失败的情况

**AI修复结果：**
```json
{
    "index": 3,
    "input": "100 1\n1 0\n...（重复98行）\n0 0",
    "output": "100 0"
}
```

**验证：**
```
⚠️ 警告：测试用例 3 的输入仍包含文字描述，跳过
```

**结果：**
```
✅ 成功修复并保存 2 个测试用例到文件
⚠️ 1 个测试用例因包含文字描述被跳过
```

## 优势总结

| 方面 | 之前 | 现在 |
|------|------|------|
| AI扫描重点 | 一般检查 | 重点关注文字代替数据 |
| 修复要求 | 一般要求 | 强调必须完整数据 |
| 验证机制 | 无 | 有（检测文字描述） |
| 保存确认 | 无 | 有（验证文件存在） |
| IO数据显示 | 无限高度 | 固定高度+滚动条 |
| 用户体验 | 一般 | 优秀 |

## 后续优化建议

1. 添加修复前后对比功能
2. 支持手动编辑修复结果
3. 添加修复质量评分
4. 支持批量重新修复
5. 添加修复历史记录
