# AI导师最终优化

## 优化内容

### 1. ✅ 每次对话都发送题目信息
**原因**: AI需要知道当前题目的上下文才能给出准确的建议

**实现**:
```cpp
// 1. 添加题目信息（每次都发送）
fullMessage += QString("【当前题目】\n标题: %1\n描述: %2\n\n")
    .arg(m_currentQuestion.title())
    .arg(m_currentQuestion.description().left(200));  // 只取前200字
```

**好处**:
- AI始终知道当前题目
- 回答更准确、更有针对性
- 不需要学生重复描述题目

### 2. ✅ 限制AI输出在500字左右
**原因**: 回答太长会让学生失去耐心，太短又不够详细

**实现**:
```
系统提示词中添加：
**重要：回答长度控制在500字以内，简洁明了，重点突出。**

帮助力度分级：
1. 轻度困难：给出思路方向和关键词（100字内）
2. 中度困难：给出算法步骤和伪代码（300字内）
3. 重度困难：给出代码框架和关键实现（500字内）
```

**效果**:
- 回答简洁有力
- 重点突出
- 易于阅读和理解

### 3. ✅ 支持Markdown格式正确显示
**支持的格式**:
- ✅ 代码块 ```cpp ... ```
- ✅ 行内代码 `code`
- ✅ 加粗 **text**
- ✅ 斜体 *text*
- ✅ 标题 ## 或 ###
- ✅ 有序列表 1. 2. 3.
- ✅ 无序列表 - item

**实现**:
```cpp
// 处理加粗 **text**
result.replace(QRegularExpression("\\*\\*([^\\*]+)\\*\\*"), 
              "<strong style='color: #ffc107; font-weight: bold;'>\\1</strong>");

// 处理标题 ### text
result.replace(QRegularExpression("^### (.+)$", QRegularExpression::MultilineOption), 
              "<h3 style='color: #ffc107; margin: 12px 0 8px 0; font-size: 11pt;'>\\1</h3>");

// 处理有序列表 1. text
result.replace(QRegularExpression("^(\\d+)\\. (.+)$", QRegularExpression::MultilineOption), 
              "<div style='margin: 4px 0; padding-left: 20px;'><span style='color: #ffc107; font-weight: bold;'>\\1.</span> \\2</div>");

// 处理无序列表 - text
result.replace(QRegularExpression("^- (.+)$", QRegularExpression::MultilineOption), 
              "<div style='margin: 4px 0; padding-left: 20px;'><span style='color: #ffc107;'>•</span> \\1</div>");
```

## 完整的消息格式

### 发送给AI的消息
```
【系统提示词】
你是一位经验丰富的编程导师...
**重要：回答长度控制在500字以内**

【当前题目】
标题: 坐标变换（其一）
描述: 对于平面直角坐标系上的坐标(x, y)，给定一个包含n个平移操作的序列...

【对话历史】
学生: 这道题怎么做？

AI导师: 这道题用**模拟法**解决：
1. 读取n个操作
2. 对每个坐标应用所有操作
3. 输出结果

【当前问题】
学生: 能给个代码示例吗？
```

### AI的回答示例
```markdown
当然可以！这是关键代码：

```cpp
#include <iostream>
using namespace std;

int main() {
    int n, m;
    cin >> n >> m;
    
    // 读取操作
    int dx[100], dy[100];
    for (int i = 0; i < n; i++) {
        cin >> dx[i] >> dy[i];
    }
    
    // 处理每个坐标
    for (int i = 0; i < m; i++) {
        int x, y;
        cin >> x >> y;
        
        // 应用所有操作
        for (int j = 0; j < n; j++) {
            x += dx[j];
            y += dy[j];
        }
        
        cout << x << " " << y << endl;
    }
    
    return 0;
}
```

**关键点**：
1. 第8-10行：读取所有操作
2. 第17-19行：应用所有操作
3. 时间复杂度：O(n*m)

试试看，有问题随时问我！
```

### 显示效果
```
当然可以！这是关键代码：

┌─────────────────────────────┐
│ cpp                         │
├─────────────────────────────┤
│ #include <iostream>         │
│ using namespace std;        │
│                             │
│ int main() {                │
│     int n, m;               │
│     cin >> n >> m;          │
│     ...                     │
│ }                           │
└─────────────────────────────┘

关键点：
1. 第8-10行：读取所有操作
2. 第17-19行：应用所有操作
3. 时间复杂度：O(n*m)

试试看，有问题随时问我！
```

## Markdown格式对照表

| Markdown | 显示效果 | 样式 |
|----------|---------|------|
| `**文本**` | **文本** | 黄色加粗 |
| `*文本*` | *文本* | 斜体 |
| `` `代码` `` | `代码` | 灰色背景 |
| `## 标题` | ## 标题 | 黄色大字 |
| `1. 项目` | 1. 项目 | 黄色序号 |
| `- 项目` | • 项目 | 黄色圆点 |

## 字数控制示例

### 轻度困难（100字内）
```
学生: 我想用循环，对吗？

AI: 对的！用**两层循环**：
- 外层遍历每个坐标
- 内层应用所有操作

试试看！
```

### 中度困难（300字内）
```
学生: 这道题怎么做？

AI: 这道题用**模拟法**解决：

## 思路
1. 读取n个操作(dx, dy)
2. 读取m个坐标(x, y)
3. 对每个坐标应用所有操作
4. 输出最终坐标

## 伪代码
```
for each coordinate (x, y):
    for each operation (dx, dy):
        x += dx
        y += dy
    output x, y
```

时间复杂度：O(n*m)

试试实现一下！
```

### 重度困难（500字内）
```
学生: 完全不会，能给完整代码吗？

AI: 可以！这是完整实现：

```cpp
#include <iostream>
using namespace std;

int main() {
    int n, m;
    cin >> n >> m;
    
    int dx[100], dy[100];
    for (int i = 0; i < n; i++) {
        cin >> dx[i] >> dy[i];
    }
    
    for (int i = 0; i < m; i++) {
        int x, y;
        cin >> x >> y;
        
        for (int j = 0; j < n; j++) {
            x += dx[j];
            y += dy[j];
        }
        
        cout << x << " " << y << endl;
    }
    
    return 0;
}
```

**关键点**：
- 第8-10行：读取所有操作
- 第12-21行：处理每个坐标
- 第17-19行：应用所有操作

**注意**：
- 数组大小要够（这里用100）
- 输出格式：x空格y换行

运行试试，理解每一步！
```

## 测试建议

### 测试1: 题目上下文
1. 问："这道题怎么做？"
2. **预期**: AI回答中提到题目的具体内容
3. 不需要学生重复描述题目

### 测试2: 字数控制
1. 问简单问题
2. **预期**: 回答100字左右
3. 问复杂问题
4. **预期**: 回答500字左右

### 测试3: Markdown格式
1. AI回答包含代码块
2. **预期**: 代码块有边框和语言标签
3. AI回答包含列表
4. **预期**: 列表有序号或圆点
5. AI回答包含加粗
6. **预期**: 加粗文字显示为黄色

### 测试4: 对话连贯性
1. 连续问3个相关问题
2. **预期**: AI记住之前的对话
3. 每次回答都基于题目上下文

## 总结

### 三大优化
1. ✅ **每次发送题目信息** - AI始终知道上下文
2. ✅ **限制500字** - 简洁有力，重点突出
3. ✅ **Markdown支持** - 格式美观，易于阅读

### 用户体验提升
- **更准确** - AI知道题目，回答更有针对性
- **更简洁** - 500字限制，不啰嗦
- **更美观** - Markdown格式，代码、列表清晰

### 技术实现
- 消息格式：题目信息 + 对话历史 + 当前问题
- 系统提示词：明确字数限制和格式要求
- Markdown解析：支持代码块、列表、加粗等

现在AI导师更加智能、简洁、美观了！
