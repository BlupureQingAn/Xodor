# 题库难度筛选功能完成

## 功能概述
在左侧题库面板添加了按难度筛选题目的功能，支持保存筛选状态，重新打开程序后筛选条件仍然保持。

## 实现的功能

### 1. 难度筛选UI
**文件**: `src/ui/QuestionBankPanel.h`, `src/ui/QuestionBankPanel.cpp`

在题库面板顶部添加了三个复选框：
- ✅ **简单** (绿色) - 筛选简单难度的题目
- ✅ **中等** (橙色) - 筛选中等难度的题目  
- ✅ **困难** (红色) - 筛选困难难度的题目

特点：
- 默认全部选中，显示所有题目
- 可以任意组合筛选条件
- 实时生效，无需刷新
- 颜色编码清晰，易于识别

### 2. 筛选逻辑
**文件**: `src/ui/QuestionBankTreeWidget.h`, `src/ui/QuestionBankTreeWidget.cpp`

在题库树控件中实现筛选：
```cpp
void QuestionBankTreeWidget::setDifficultyFilter(const QSet<Difficulty> &difficulties)
{
    m_difficultyFilter = difficulties;
    refreshTree();  // 重新加载树以应用筛选
}

bool QuestionBankTreeWidget::shouldShowQuestion(const Question &question) const
{
    // 如果没有设置筛选，显示所有题目
    if (m_difficultyFilter.isEmpty()) {
        return true;
    }
    
    // 检查题目难度是否在筛选列表中
    return m_difficultyFilter.contains(question.difficulty());
}
```

在 `loadQuestionFiles()` 中应用筛选：
- 加载题目时检查难度
- 不符合筛选条件的题目直接跳过
- 保持树形结构的完整性

### 3. 状态持久化
**文件**: `src/utils/SessionManager.h`, `src/utils/SessionManager.cpp`

在 `SessionState` 中添加难度筛选字段：
```cpp
struct SessionState {
    // ...
    QList<int> activeDifficultyFilters;  // 激活的难度筛选（0=Easy, 1=Medium, 2=Hard）
    // ...
};
```

新增保存和加载方法：
```cpp
void SessionManager::saveDifficultyFilters(const QList<int> &filters);
QList<int> SessionManager::loadDifficultyFilters();
```

序列化到 JSON：
- 保存：将 `QSet<Difficulty>` 转换为 `QList<int>` 并保存到 JSON 数组
- 加载：从 JSON 数组读取并转换回 `QSet<Difficulty>`
- 默认值：如果没有保存的筛选，返回所有难度（0, 1, 2）

### 4. 主窗口集成
**文件**: `src/ui/MainWindow.cpp`

在题目选择时保存筛选状态：
```cpp
// 保存难度筛选状态
QSet<Difficulty> filters = m_questionBankPanel->getActiveDifficultyFilters();
QList<int> filterList;
for (Difficulty d : filters) {
    filterList.append(static_cast<int>(d));
}
SessionManager::instance().saveDifficultyFilters(filterList);
```

在会话恢复时加载筛选状态：
```cpp
// 恢复难度筛选状态
QList<int> filterList = SessionManager::instance().loadDifficultyFilters();
QSet<Difficulty> filters;
for (int f : filterList) {
    filters.insert(static_cast<Difficulty>(f));
}
m_questionBankPanel->restoreDifficultyFilters(filters);
```

## 修改的文件
1. `src/ui/QuestionBankPanel.h` - 添加难度筛选UI组件和方法
2. `src/ui/QuestionBankPanel.cpp` - 实现筛选UI和逻辑
3. `src/ui/QuestionBankTreeWidget.h` - 添加筛选方法声明
4. `src/ui/QuestionBankTreeWidget.cpp` - 实现筛选逻辑
5. `src/utils/SessionManager.h` - 添加筛选状态字段和方法
6. `src/utils/SessionManager.cpp` - 实现筛选状态的保存和加载
7. `src/ui/MainWindow.cpp` - 集成筛选状态的保存和恢复

## 使用方法

### 筛选题目
1. 在左侧题库面板顶部找到"难度筛选"区域
2. 勾选或取消勾选对应的难度复选框
3. 题库树会立即更新，只显示符合条件的题目

### 筛选组合示例
- **只看简单题**：只勾选"简单"
- **中等和困难**：勾选"中等"和"困难"，取消"简单"
- **显示所有**：勾选全部三个复选框

### 状态保存
- 筛选条件会自动保存
- 关闭程序后重新打开，筛选条件保持不变
- 切换题目时也会保存当前的筛选状态

## 技术细节

### 数据流程
1. 用户点击复选框 → `onDifficultyFilterChanged()`
2. 更新 `m_activeDifficultyFilters` 集合
3. 调用 `applyFilters()` → `m_treeWidget->setDifficultyFilter()`
4. 树控件调用 `refreshTree()` 重新加载
5. 在 `loadQuestionFiles()` 中应用 `shouldShowQuestion()` 筛选
6. 保存到 SessionManager → 序列化到 JSON 文件

### 难度枚举映射
```cpp
enum class Difficulty {
    Easy = 0,    // 简单
    Medium = 1,  // 中等
    Hard = 2     // 困难
};
```

### 性能优化
- 使用 `QSet` 存储筛选条件，查找效率 O(1)
- 只在筛选条件改变时重新加载树
- 使用 `blockSignals()` 避免恢复状态时触发不必要的刷新

## 样式设计

### 复选框样式
- **简单**：绿色 (#4CAF50)
- **中等**：橙色 (#FFA500)
- **困难**：红色 (#F44336)

每个复选框都有：
- 自定义的勾选框样式
- 悬停效果
- 与难度对应的颜色主题

### 布局
```
搜索: [搜索框]
难度筛选:
  [✓ 简单] [✓ 中等] [✓ 困难]
[题库树]
```

## 测试步骤
1. 启动程序，查看题库面板
2. 取消勾选"简单"，验证简单题目被隐藏
3. 只勾选"困难"，验证只显示困难题目
4. 关闭程序，重新打开
5. 验证筛选条件是否保持（应该只显示困难题目）
6. 勾选所有难度，验证所有题目都显示

## 预期结果
- ✅ 筛选功能实时生效
- ✅ 筛选条件可以任意组合
- ✅ 关闭程序后筛选状态保持
- ✅ UI清晰美观，颜色编码明确
- ✅ 性能良好，切换流畅

## 编译状态
✅ 编译成功，无错误（有2个关于 Qt 6.10 弃用 API 的警告，不影响功能）

## 后续优化建议
1. 添加"全选"/"全不选"快捷按钮
2. 添加题目数量统计（显示当前筛选结果的题目数）
3. 支持按标签筛选
4. 支持按完成状态筛选（未开始/进行中/已完成/已掌握）
5. 添加筛选条件的快捷键
