# 树状图数据源统一修复完成

## 问题

移除题库注册后，树状图仍然显示该题库，说明树状图的加载逻辑绕过了 QuestionBankManager。

## 根本原因

`QuestionBankTreeWidget::loadRootNode()` 直接扫描文件系统：

```cpp
// ❌ 错误：直接扫描 data/基础题库 目录
QDir baseDir("data/基础题库");
QStringList banks = baseDir.entryList(QDir::Dirs | QDir::NoDotAndDotDot);
for (const QString &bankName : banks) {
    loadBankNode(m_rootItem, baseDir.filePath(bankName));
}
```

这导致：
- 忽略列表机制被绕过
- 移除注册的题库仍然显示
- 三个数据源不统一

## 解决方案

修改为扫描文件系统，但检查忽略列表：

```cpp
// ✅ 正确：扫描文件夹，但跳过忽略列表中的
QDir baseDir("data/基础题库");
QStringList banks = baseDir.entryList(QDir::Dirs | QDir::NoDotAndDotDot);

for (const QString &bankName : banks) {
    // 检查是否在忽略列表中（用户主动移除的）
    if (QuestionBankManager::instance().isInIgnoreList(bankName)) {
        continue;  // 跳过被移除注册的题库
    }
    
    QString bankPath = baseDir.filePath(bankName);
    loadBankNode(m_rootItem, bankPath);
}
```

这样既能显示所有题库（包括未注册的），又能隐藏用户主动移除的题库。

## 数据流

### 修复前
```
树状图 → 直接扫描文件系统 → 显示所有文件夹（包括被移除的）
题库管理 → QuestionBankManager → 显示已注册题库
题库面板 → QuestionBankManager → 显示已注册题库

结果：移除注册后，树状图仍然显示 ❌
```

### 修复后
```
树状图 → 扫描文件系统 → 检查忽略列表 → 跳过被移除的 → 显示其他题库
题库管理 → QuestionBankManager → 显示已注册题库
题库面板 → QuestionBankManager → 显示已注册题库

结果：移除注册后，所有界面都不显示 ✅
```

### 设计理念
- **树状图**：显示所有文件夹（方便发现新题库），但隐藏用户主动移除的
- **题库管理**：只显示已注册的题库（严格管理）
- **题库面板**：只显示已注册的题库（严格管理）
- **忽略列表**：统一控制哪些题库应该被隐藏

## 效果

现在移除题库注册后：
1. ✅ 题库管理：题库消失（不在已注册列表中）
2. ✅ 题库面板：题库消失（不在已注册列表中）
3. ✅ 树状图：题库消失（在忽略列表中，被跳过）
4. ✅ 自动扫描：不会重新注册（忽略列表保护）

新导入的题库（未注册）：
1. ✅ 树状图：显示（方便发现）
2. ⚪ 题库管理：不显示（需要注册）
3. ⚪ 题库面板：不显示（需要注册）
4. ✅ 自动扫描：会自动注册（不在忽略列表中）

## 修改的文件

**src/ui/QuestionBankTreeWidget.cpp**
- 修改 `loadRootNode()` 方法
- 扫描 `data/基础题库` 目录获取所有文件夹
- 调用 `QuestionBankManager::instance().isInIgnoreList()` 检查每个题库
- 跳过在忽略列表中的题库（用户主动移除的）
- 加载其他所有题库（包括未注册的）

## 编译状态

✅ 编译成功，无错误无警告

## 测试验证

1. 移除题库注册
2. 验证：题库管理、题库面板、树状图都不显示该题库 ✓
3. 刷新界面
4. 验证：题库仍然不显示（忽略列表生效）✓
5. 重启程序
6. 验证：题库仍然不显示（持久化生效）✓
