# 测试用例复制按钮功能完成

## 功能描述

在题目面板的测试用例显示区域添加复制按钮，方便用户快速复制输入和输出数据。

## 实现效果

### 显示效果

每个测试用例的输入和输出旁边都有一个📋复制按钮：

```
示例 1
输入：📋
n=3, m=2，操作序列为(10,10), (0,0), (10,-20)

输出：📋
(21, -11), (10, -20)
```

### 交互效果

1. **正常状态**: 显示📋图标，红色背景
2. **悬停状态**: 背景变为深红色
3. **点击后**: 
   - 按钮显示✓图标
   - 背景变为绿色
   - 1.5秒后恢复原状
4. **复制成功**: 文本已复制到剪贴板

## 技术实现

### 1. HTML结构修改

为每个测试用例添加唯一ID和复制按钮：

```cpp
QString caseId = QString("case_%1").arg(caseNum);

// 输入部分 - 带复制按钮
html += "<div class='io-container'>";
html += "<div class='io-label'>输入：";
html += QString("<button class='copy-btn' onclick='copyToClipboard(\"%1_input\")' title='复制输入'>📋</button>")
    .arg(caseId);
html += "</div>";
html += QString("<div class='io-block' id='%1_input' data-text='%2'>%3</div>")
    .arg(caseId)
    .arg(tc.input.toHtmlEscaped().replace("'", "\\'").replace("\n", "\\n"))
    .arg(inputHtml);
html += "</div>";
```

**关键点**:
- 每个测试用例有唯一ID（`case_1_input`, `case_1_output`等）
- 使用`data-text`属性存储原始文本（保留换行符）
- 复制按钮通过`onclick`调用JavaScript函数

### 2. CSS样式

添加复制按钮和容器的样式：

```css
.io-label {
    color: #b0b0b0;
    font-weight: bold;
    margin-bottom: 6px;
    font-size: 10pt;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.io-container {
    margin: 8px 0;
}

.copy-btn {
    background-color: #660000;
    color: white;
    border: none;
    border-radius: 4px;
    padding: 4px 8px;
    cursor: pointer;
    font-size: 12px;
    margin-left: 8px;
    transition: background-color 0.2s;
}

.copy-btn:hover {
    background-color: #880000;
}

.copy-btn:active {
    background-color: #440000;
}

.copy-btn.copied {
    background-color: #2d5016;
}
```

**样式特点**:
- 使用flexbox布局，按钮在右侧
- 红色主题，与应用整体风格一致
- 悬停和点击有视觉反馈
- 复制成功后显示绿色

### 3. JavaScript复制功能

实现复制到剪贴板的功能：

```javascript
function copyToClipboard(elementId) {
    var element = document.getElementById(elementId);
    if (!element) return;
    
    // 获取原始文本（从data-text属性）
    var text = element.getAttribute('data-text');
    if (!text) {
        text = element.innerText;
    } else {
        // 解码转义的换行符
        text = text.replace(/\\n/g, '\n');
    }
    
    // 创建临时textarea来复制文本
    var textarea = document.createElement('textarea');
    textarea.value = text;
    textarea.style.position = 'fixed';
    textarea.style.opacity = '0';
    document.body.appendChild(textarea);
    textarea.select();
    
    try {
        document.execCommand('copy');
        // 显示反馈
        var buttons = document.querySelectorAll('.copy-btn');
        for (var i = 0; i < buttons.length; i++) {
            var btn = buttons[i];
            if (btn.getAttribute('onclick').indexOf(elementId) !== -1) {
                var originalText = btn.innerHTML;
                btn.innerHTML = '✓';
                btn.classList.add('copied');
                setTimeout(function() {
                    btn.innerHTML = originalText;
                    btn.classList.remove('copied');
                }, 1500);
                break;
            }
        }
    } catch (err) {
        console.error('复制失败:', err);
    }
    
    document.body.removeChild(textarea);
}
```

**实现细节**:
1. 从`data-text`属性获取原始文本（保留换行符）
2. 创建隐藏的textarea元素
3. 使用`document.execCommand('copy')`复制
4. 找到对应按钮并显示视觉反馈
5. 1.5秒后恢复按钮原状

### 4. 换行符处理

**问题**: HTML显示使用`<br>`，但复制时需要真实的换行符`\n`

**解决方案**:
1. 在`data-text`属性中存储原始文本
2. 将`\n`转义为`\\n`存储在HTML属性中
3. JavaScript读取时将`\\n`还原为`\n`

```cpp
// C++端：转义换行符
.arg(tc.input.toHtmlEscaped().replace("'", "\\'").replace("\n", "\\n"))

// JavaScript端：还原换行符
text = text.replace(/\\n/g, '\n');
```

## 用户体验

### 使用场景

1. **快速测试**: 复制输入数据到代码编辑器测试
2. **对比输出**: 复制预期输出与实际输出对比
3. **调试**: 复制测试数据进行调试

### 交互流程

1. 用户查看题目和测试用例
2. 点击输入旁的📋按钮
3. 按钮变为✓，背景变绿
4. 输入数据已复制到剪贴板
5. 粘贴到代码编辑器或其他地方使用

### 视觉反馈

- **未点击**: 📋 红色背景
- **悬停**: 📋 深红色背景
- **点击**: ✓ 绿色背景（1.5秒）
- **恢复**: 📋 红色背景

## 编译状态

```
[3/3] Linking CXX executable CodePracticeSystem.exe
========================================
编译成功！
========================================
```

✅ 编译成功，无错误

## 修改文件

- `src/ui/QuestionPanel.cpp` - 添加复制按钮HTML、CSS和JavaScript

## 测试建议

### 功能测试

1. **基本复制**:
   - 打开任意题目
   - 点击输入的复制按钮
   - 粘贴到文本编辑器
   - 验证：内容正确，换行符保留

2. **多行文本**:
   - 选择包含多行输入的测试用例
   - 复制输入
   - 验证：所有行都被复制，格式正确

3. **特殊字符**:
   - 测试包含特殊字符的用例（括号、逗号等）
   - 验证：特殊字符正确复制

4. **视觉反馈**:
   - 点击复制按钮
   - 验证：按钮变为✓，背景变绿
   - 等待1.5秒
   - 验证：按钮恢复为📋，背景恢复红色

### 兼容性测试

1. **不同题目类型**: 测试简单、中等、困难题目
2. **不同测试用例数量**: 1个、3个、5个测试用例
3. **长文本**: 测试很长的输入输出

## 后续优化建议

### 可选增强

1. **全部复制按钮**:
   - 添加"复制所有测试用例"按钮
   - 一次性复制所有输入输出

2. **格式化选项**:
   - 提供不同的复制格式（纯文本、带标签等）
   - 用户可选择复制格式

3. **键盘快捷键**:
   - 支持Ctrl+C快捷键复制选中的测试用例
   - 提供快捷键提示

4. **复制历史**:
   - 记录最近复制的测试用例
   - 提供快速访问

## 技术亮点

1. **原生JavaScript**: 不依赖外部库，轻量高效
2. **优雅降级**: 如果复制失败，不影响其他功能
3. **视觉反馈**: 清晰的状态指示，用户体验好
4. **换行符处理**: 正确处理多行文本
5. **样式统一**: 与应用整体风格一致

## 总结

成功为测试用例添加了复制按钮功能，提升了用户体验。用户现在可以快速复制测试数据进行测试和调试，无需手动选择和复制文本。

**功能状态**: ✅ 完成
**编译状态**: ✅ 成功
**测试状态**: ⏳ 待用户验证

---

**实现时间**: 2024-12-08
**功能**: 测试用例复制按钮
**修改文件**: `src/ui/QuestionPanel.cpp`
