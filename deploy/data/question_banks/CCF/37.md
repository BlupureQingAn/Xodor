以下是整理好的第37次CCF计算机软件能力认证（CSP）模拟试题集合。

---

# 第37次CCF计算机软件能力认证

## 题目 1：数值积分 (Numerical Integration)

**时间限制：** 1.0 秒
**空间限制：** 512 MiB

### 题目描述

在了解了数值积分的基本原理后，小 P 打算用如下方法估算二次函数在 $[l, r]$ 区间的积分：

给定二次函数 $f(x) = x^2 + bx + c$，其中两个系数 $b$ 和 $c$ 均为整数；

对于给定区间 $[l, r]$（$l$ 和 $r$ 均为整数），选取闭区间内所有偶数坐标点：
$$ l \le x, x+2, x+4, \dots \le r $$

分别计算每个坐标点的函数值并求和，再乘以坐标点间距 2，即计算：
$$ s = 2 \times (f(x) + f(x+2) + f(x+4) + \dots) $$

$s$ 即为小 P 估算的积分结果。

试帮助小 P 编程实现上述计算过程：对于任意给定的系数 $b$、 $c$ 和区间 $l$、$r$，计算并输出 $s$。

### 输入格式

从标准输入读入数据。
输入仅一行，包含四个整数 $b$、$c$、$l$、$r$，含义如前文所述。

### 输出格式

输出到标准输出。
输出一个整数 $s$，表示小 P 估算的积分结果。

### 样例 1

**输入：**

```text
1 2 0 5
```

**输出：**

```text
64
```

### 样例 2

**输入：**

```text
-20 -20 1 1000
```

**输出：**

```text
324294000
```

### 子任务

全部测试数据保证 $0 \le l < l+2 \le r \le 1000$ 且 $-20 \le b, c \le 20$。

---

## 题目 2：机器人饲养指南 (Robot Feeding Guide)

**时间限制：** 1.0 秒
**空间限制：** 512 MiB

### 题目背景

众所周知，西西艾弗岛上的机器人喜欢吃苹果。

### 题目描述

据饲养员小 P 介绍：

1. 机器人一天最多可以吃 $m$ 个苹果。
2. 一天内通过吃苹果获得的快乐值具体为：$A_0, A_1, \dots, A_m$；如果某一天饲养员共投喂机器人 $i$ 个苹果，则这一天机器人获得的快乐值为 $A_i$。
3. 特别地 $A_0 = 0$，快乐值并不会凭空产生。

现在小 P 有 $n$ 个苹果，试帮助小 P 计算：向机器人投喂这 $n$ 个苹果能获得的最大快乐值收益。

### 输入格式

从标准输入读入数据。
输入共两行。
第一行包含两个整数 $n$ 和 $m$，分别表示苹果总数和每天最大投喂量。
第二行依次包含 $m$ 个整数 $A_1, A_2, \dots, A_m$，表示一天内投喂不同苹果数的收益。

### 输出格式

输出到标准输出。
输出仅一个整数，表示投喂全部 $n$ 个苹果能获得的最大收益。

### 样例 1

**输入：**

```text
10 5
1 3 5 3 1
```

**输出：**

```text
16
```

**解释：**
一种最优投喂方案为：投喂四天，每天分别投喂 3、3、1 和 3 个苹果。
如该样例所示，收益序列 $A$ 不一定单调递增，即一天内吃较多苹果可能反而获得较小快乐值。

### 样例 2

**输入：**

```text
4 3
1 60 100
```

**输出：**

```text
120
```

**解释：**
一种最优投喂方案为：投喂两天，每天投喂 2 个苹果。

### 子任务

* 40% 的测试数据保证：$n \le 50$ 且 $m=5$；
* 另有 40% 的测试数据保证：$n=60$ 且 $m=6$；
* 全部测试数据保证：$0 < n \le 10^4$、$0 < m \le 100$ 且 $0 \le A_i \le 10^5$。

---

## 题目 3：模板展开 (Template Expansion)

**时间限制：** 2.0 秒
**空间限制：** 512 MiB

### 题目背景

西西艾弗岛信息中心开发了一种模板语言，重点支持变量和其代换。你的任务是能够读取这种模板语言，并按照模板语言的规则生成相应输出。

### 题目描述

模板语言涉及的数据是字符串（由 `[a-z0-9]` 组成）。变量名称是非空字符串，值也是字符串。初始时所有变量值为空。

**表达式**：由空格分隔的若干操作数组成。

* 操作数如果是 `$name`，表示变量 `name` 的值。
* 操作数如果是 `string`，表示字符串字面量。
* 表达式的值是将所有变量替换为其值后，所有操作数拼接的结果。

**语句类型**：

1. **直接赋值**：`1 <var> <expr>`。
   * 求表达式 `<expr>` 的值，赋给变量 `<var>`。
   * 例如 `1 c $a $b`，若 $a$=`hello`, $b$=`world`，则 $c$=`helloworld`。
2. **间接赋值**：`2 <var> <expr>`。
   * **不立即**求值，而是建立映射。后续每次用到该变量时，**重新计算**对应的表达式。
   * 例如 `2 c $a $b`，若此时 $a$=`hello`，则 $c$ 为 `helloworld`；若后续 $a$ 变为 `hi`，则 $c$ 自动变为 `hiworld`。
3. **输出语句**：`3 <var>`。
   * 输出变量值的长度除以 $1000000007$ 的余数。

**注意**：间接赋值建立了依赖关系，题目保证表达式中不存在循环依赖。

形式化 BNF 定义：

```text
CHAR ::= [a-z0-9]
SPACE ::= ' '
DOLLAR ::= '$'
NONEMPTY_STRING ::= CHAR | NONEMPTY_STRING CHAR
STRING ::= '' | NONEMPTY_STRING
VAR ::= NONEMPTY_STRING
OPERAND ::= DOLLAR VAR | NONEMPTY_STRING
EXPR ::= OPERAND | EXPR SPACE OPERAND
ASSIGN_OP ::= '1' | '2'
ASSIGN ::= ASSIGN_OP SPACE VAR SPACE EXPR
OUTPUT ::= '3' SPACE VAR
STATEMENT ::= ASSIGN | OUTPUT
```

### 输入格式

输入第一行为整数 $n$，表示语句数量。
接下来 $n$ 行，每行为一个语句。

### 输出格式

对于每个输出语句，输出一行变量值的长度模 $1000000007$ 的余数。

### 样例 1

**输入：**

```text
6
1 a hello
1 b world
2 c $a $b
3 c
1 a hi
3 c
```

**输出：**

```text
10
7
```

### 样例 2

**输入：**

```text
5
1 var value
3 var
3 val
1 var $var $val $var
3 var
```

**输出：**

```text
5
0
10
```

### 子任务

* 测试点 1, 2: $n \le 200$，无间接赋值，每个表达式仅 1 个字符串操作数。
* 测试点 3, 4: 每个表达式仅 1 个操作数。
* 测试点 5, 6: 每个表达式不超过 100 个操作数。
* 测试点 7, 8: 包含所有类型语句。
* 测试点 9, 10: $n \le 2000$。
* 全部数据：变量总数不超过 1000，变量名/字符串长度不超过 50。

---

## 题目 4：集体锻炼 (Collective Exercise)

**时间限制：** 1.0 秒
**空间限制：** 512 MiB

### 题目背景

西西艾弗岛上弗艾西西大学的同学们正在集体锻炼。

### 题目描述

一共 $n$ 个同学站成一排，第 $i$ 个同学具有力量值 $a_i$。

老师规定对一个区间 $[l, r]$，它的体育价值：
$$ f([l, r]) = l \times r \times \gcd(a_l, a_{l+1}, \dots, a_r) $$
其中 $\gcd$ 表示最大公约数。

老师想求所有区间的体育价值之和，即：
$$ \sum_{l=1}^{n} \sum_{r=l}^{n} f([l, r]) $$

请计算结果对 $998244353$ 取模的值。

### 输入格式

第一行一个整数 $n$，表示同学数量。
第二行 $n$ 个整数 $a_1, a_2, \dots, a_n$，代表力量值。

### 输出格式

输出一行一个整数，表示结果对 $998244353$ 取模的值。

### 样例 1

**输入：**

```text
5
10 2 6 6 8
```

**输出：**

```text
586
```

### 样例 2

**输入：**

```text
20
7 6 5 5 17 18 13 3 11 12 7 9 16 15 5 19 20 13 14 6
```

**输出：**

```text
57254
```

### 子任务

* 子任务一 (30分): $n \le 1000, a_i \le 10^5$。
* 子任务二 (20分): $n \le 10^5, a_i \le 10$。
* 子任务三 (30分): $n, a_i \le 10^5$。
* 子任务四 (20分): 无特殊限制。
* 全部数据: $1 \le n, a_i \le 10^6$。

---

## 题目 5：收费标准评估 (Charging Standard Assessment)

**时间限制：** 2.5 秒
**空间限制：** 512 MiB

### 题目描述

西埃斯公园有 $n$ 个景点（编号 1 到 $n$），景点 $i$ 收费 $a_i$（可能为负）。景点由 $n-1$ 条双向道路连通成一棵树。
初始时，1 号景点为根（演出景点）。

**基本费用**定义：游客从根节点入园游览一次（到达一个包含根的连通区域）可能的最大花费（所有到达景点 $a_i$ 之和）。

系统需先计算初始基本费用，然后处理 $m$ 次操作：

1. `1 u`: 假设只开放 $u$ 的子树，计算从该子树任意点入园游览一次的最大花费。（仅评估，不影响后续）
2. `2 u x`: 将景点 $u$ 收费改为 $x$，重新计算基本费用。
3. `3 u`: 将根节点改为 $u$，重新计算基本费用。
4. `4 a b c d`: 删去边 $(a, b)$，连接新边 $(c, d)$。保证操作前后均为树。重新计算基本费用。

### 输入格式

第一行：$n, m$。
第二行：$n$ 个整数 $a_i$。
接下来 $n-1$ 行：每行 $u, v$，表示初始边。
接下来 $m$ 行：每行描述一个操作。

### 输出格式

输出 $m+1$ 行。第一行是初始基本费用，后续 $m$ 行对应每次操作的结果。

### 样例输入

```text
5 4
-5 7 9 -3 1
1 2
1 4
2 3
4 5
1 1
3 2
2 5 7
4 5 4 1 5
```

### 样例输出

```text
11
16
16
16
18
```

### 样例解释

* 初始：根为1。游览 {1, 2, 3} 花费 $-5+7+9=11$。
* 操作 1 (u=1)：即全图开放，任意点入园。从 2 入园游览 {2, 3} 花费 $7+9=16$。
* 操作 3 (u=2)：根变为 2。从 2 出发游览 {2, 3} 花费 16。
* 操作 2 (u=5, x=7)：5 号变 7。根仍为 2。从 2 到 5 需经 1, 4。路径 {2, 3} 仍最优，花费 16。
* 操作 4：断 (4,5) 连 (1,5)。根仍为 2。从 2 出发游览 {1, 2, 3, 5} 花费 $-5+7+9+7=18$。

### 子任务

* 子任务一 (15分): $n, m \le 3000$，只含操作 1, 2。
* 子任务二 (15分): $n, m \le 10^5$，只含操作 1, 2，且树高（根到任意点距离）不超过 100。
* 子任务三 (40分): $n, m \le 10^5$，只含操作 1, 2。
* 子任务四 (30分): 无特殊限制。
* 全部数据: $1 \le n, m \le 10^5$, $|a_i|, |x| \le 10^9$。
