以下是整理好的第31次与第32次CCF计算机软件能力认证（CSP）模拟试题集合。

---

# 第31次CCF计算机软件能力认证

## 题目 1：坐标变换（其一）

**时间限制：** 1.0 秒
**空间限制：** 512 MiB

### 题目描述

对于平面直角坐标系上的坐标 $(x, y)$，小 P 定义了一个包含 $n$ 个操作的序列 $T = (t_1, t_2, \cdots, t_n)$。其中每个操作 $t_i$（$1 \le i \le n$）包含两个参数 $dx_i$ 和 $dy_i$，表示将坐标 $(x, y)$ 平移至 $(x + dx_i, y + dy_i)$ 处。

现给定 $m$ 个初始坐标，试计算对每个坐标 $(x_j, y_j)$（$1 \le j \le m$）依次进行 $T$ 中 $n$ 个操作后的最终坐标。

### 输入格式

从标准输入读入数据。
输入共 $n + m + 1$ 行。
输入的第一行包含空格分隔的两个正整数 $n$ 和 $m$，分别表示操作和初始坐标个数。
接下来 $n$ 行依次输入 $n$ 个操作，其中第 $i$（$1 \le i \le n$）行包含空格分隔的两个整数 $dx_i$、$dy_i$。
接下来 $m$ 行依次输入 $m$ 个坐标，其中第 $j$（$1 \le j \le m$）行包含空格分隔的两个整数 $x_j$、$y_j$。

### 输出格式

输出到标准输出。
输出共 $m$ 行，其中第 $j$（$1 \le j \le m$）行包含空格分隔的两个整数，表示初始坐标 $(x_j, y_j)$ 经过 $n$ 个操作后的位置。

### 样例输入

```text
3 2
10 10
0 0
10 -20
1 -1
0 0
```

### 样例输出

```text
21 -11
20 -10
```

### 样例解释

第一个坐标 $(1, -1)$ 经过三次操作后变为 $(21, -11)$；第二个坐标 $(0, 0)$ 经过三次操作后变为 $(20, -10)$。

### 子任务

全部的测试数据满足：$n, m \le 100$，所有输入数据（$x, y, dx, dy$）均为整数且绝对值不超过 $10^5$。

---

## 题目 2：坐标变换（其二）

**时间限制：** 2.0 秒
**空间限制：** 512 MiB

### 题目描述

对于平面直角坐标系上的坐标 $(x, y)$，小 P 定义了如下两种操作：

1. **拉伸 $k$ 倍**：横坐标 $x$ 变为 $kx$，纵坐标 $y$ 变为 $ky$；
2. **旋转 $\theta$**：将坐标 $(x, y)$ 绕坐标原点 $(0, 0)$ 逆时针旋转 $\theta$ 弧度（$0 \le \theta < 2\pi$）。易知旋转后的横坐标为 $x \cos \theta - y \sin \theta$，纵坐标为 $x \sin \theta + y \cos \theta$。

设定好了包含 $n$ 个操作的序列 $(t_1, t_2, \cdots, t_n)$ 后，小 P 又定义了如下查询：

* `i j x y`：坐标 $(x, y)$ 经过操作 $t_i, \cdots, t_j$（$1 \le i \le j \le n$）后的新坐标。

对于给定的操作序列，试计算 $m$ 个查询的结果。

### 输入格式

从标准输入读入数据。
输入共 $n + m + 1$ 行。
输入的第一行包含空格分隔的两个正整数 $n$ 和 $m$，分别表示操作和查询个数。
接下来 $n$ 行依次输入 $n$ 个操作，每行包含空格分隔的一个整数（操作类型）和一个实数（$k$ 或 $\theta$），形如 `1 k`（表示拉伸 $k$ 倍）或 `2 θ`（表示旋转 $\theta$）。
接下来 $m$ 行依次输入 $m$ 个查询，每行包含空格分隔的四个整数 $i$、$j$、$x$ 和 $y$，含义如前文所述。

### 输出格式

输出到标准输出。
输出共 $m$ 行，每行包含空格分隔的两个实数，表示对应查询的结果。

### 样例输入

```text
10 5
2 0.59
2 4.956
1 0.997
1 1.364
1 1.242
1 0.82
2 2.824
1 0.716
2 0.178
2 4.094
1 6 -953188 -946637
1 9 969538 848081
4 7 -114758 522223
1 9 -535079 601597
8 8 159430 -511187
```

### 样例输出

```text
-1858706.758 -83259.993
-1261428.46 201113.678
-75099.123 -738950.159
-119179.897 -789457.532
114151.88 -366009.892
```

### 子任务

* 80% 的测试数据满足：$n, m \le 1000$；
* 全部的测试数据满足：$n, m \le 10^5$；输入的坐标均为整数且绝对值不超过 $10^6$；单个拉伸操作的系数 $k \in [0.5, 2]$；任意操作区间内的拉伸系数乘积在 $[0.001, 1000]$ 范围内。
* 评分方式：绝对误差不大于 $0.1$ 即可。

---

## 题目 3：梯度求解

**时间限制：** 1.0 秒
**空间限制：** 512 MiB

### 题目背景

信息中心研发了一款数学模型来评估市政设施。要想得到最优化的成本，就要依靠梯度下降算法来求解。小 C 需要实现求解函数在一点处对某一自变量的偏导数的功能。

### 题目描述

设被求算的函数 $u = f(x_1, x_2, \dots, x_n)$，本题目要求你求出 $u$ 对 $x_i$ 在 $(a_1, a_2, \dots, a_n)$ 处的偏导数 $\frac{\partial u}{\partial x_i}(a_1, a_2, \dots, a_n)$。

本题目中，你需要求解的函数 $f$ 仅由常数、自变量和它们的加法、减法、乘法组成，且函数表达式已经被整理为逆波兰式（后缀表达式）的形式。
例如，$x_1 \cdot x_1 \cdot x_2$ 的逆波兰式为 `x1 x1 * x2 *`。

求导法则提示：

* $c' = 0$ ($c$ 是常数)
* $x' = 1$
* $(u + v)' = u' + v'$
* $(u - v)' = u' - v'$
* $(uv)' = u'v + uv'$

### 输入格式

从标准输入读入数据。
输入的第一行是由空格分隔的两个正整数 $n$、$m$，分别表示要求解函数中所含自变量的个数和要求解的偏导数的个数。
输入的第二行是一个逆波兰式，表示要求解的函数 $f$。其中，每个元素用一个空格分隔，每个元素可能是：

* 一个自变量 $x_i$，用字符 `x` 后接一个正整数表示 ($i=1, \dots, n$)。
* 一个整常数，其值在 $-10^5$ 到 $10^5$ 之间。
* 一个运算符，`+`、`-` 或 `*`。
  输入的第三行到第 $m + 2$ 行，每行有 $n + 1$ 个用空格分隔的整数。其中第一个整数是要求偏导数的自变量的编号 $i$，随后的整数是要求算的点的坐标 $a_1, a_2, \dots, a_n$。

### 输出格式

输出到标准输出。
输出 $m$ 行，每行一个整数，表示对应的偏导数对 $10^9 + 7$ 取模的结果。

### 样例输入

```text
2 2
x1 x1 x1 * x2 + *
1 2 3
2 3 4
```

### 样例输出

```text
15
3
```

### 子任务

* 测试点 1, 2: $n=1, m \le 100$，表达式仅含有 1 个元素。
* 测试点 3, 4: 表达式仅含有一个运算符。
* 测试点 5, 6: $n \le 10$，表达式含不超过 120 个元素，且不含乘法。
* 测试点 7, 8: 表达式含不超过 120 个元素。
* 测试点 9, 10: $n \le 100$。

---

## 题目 4：阴阳龙

**时间限制：** 2.0 秒
**空间限制：** 1024 MiB

### 题目描述

西西艾弗遗迹可以视为一个 $n \times m$ 的网格。初始时，有 $p$ 名员工分布在不同位置。
阴阳龙在位置 $P=(u, v)$ 以强度 $t \in [1, 7]$ 现身时，会改变环境，导致员工位置变化。

**变化规则**：

1. 阴阳龙观察 8 个方向（右、右上、上、...、右下）。
2. 计算“最近距离” $k$：
   * 设 $K_1$ 为所有 8 个方向上最近的员工到阴阳龙的距离集合。
   * 设 $K_2$ 为所有 8 个方向上阴阳龙到边界的距离集合。
   * 若 $K_1 \cap K_2 = \emptyset$，则 $k=0$。
   * 否则，$k = \min(K_1 \cap K_2)$ 且 $k > 0$。
3. 若 $k > 0$，将所有在 8 个方向上距离阴阳龙为 $k$ 的员工，以阴阳龙为中心逆时针旋转 $t \times 45^\circ$（即移动到 $t$ 个方向后的对应位置）。

共有 $q$ 次阴阳龙现身，求最终所有员工位置的校验和。

### 输入格式

第一行四个正整数 $n, m, p, q$。
接下来 $p$ 行，每行两个正整数 $(x_i, y_i)$ 表示员工初始位置。
接下来 $q$ 行，每行三个正整数 $u_i, v_i, t_i$ 表示阴阳龙现身的位置和强度。

### 输出格式

输出一个整数，表示 $\bigoplus_{i=1}^p (i \times x_i + y_i)$，其中 $\bigoplus$ 为按位异或。

### 样例输入

```text
3 3 9 1
1 1
1 2
1 3
2 1
2 2
2 3
3 1
3 2
3 3
2 2 1
```

### 样例输出

```text
20
```

### 子任务

* $1 \le n, m \le 10^9$
* $1 \le p, q \le 10^5$
* 部分数据满足 $n, m, p, q$ 较小。

---

## 题目 5：阻击

**时间限制：** 2.0 秒
**空间限制：** 512 MiB

### 题目描述

西西艾弗岛共有 $n$ 座城市，由 $n-1$ 条道路连接成树形结构。每条边有“发掘宝物收益” $w$ 和“受到阻击损失” $b$。
敌军选择两座城市作为起点和终点，沿唯一路径进攻。间谍可以决定起点和终点，使得敌军的**总损失**最大化。
总损失 $= \sum_{e \in \text{path}} (b_e - w_e)$。
此外，会发生 $m$ 次“阴阳龙现身”事件，每次事件会修改某条道路的 $w$ 值。
求在所有事件前及每次事件后，敌军可能遭受的最大总损失。

### 输入格式

第一行 $n, m$。
接下来 $n-1$ 行，每行 $u_i, v_i, w_i, b_i$，表示连接城市的边及其属性。
接下来 $m$ 行，每行 $x_i, y_i$，表示将第 $x_i$ 条边的 $w$ 修改为 $y_i$。

### 输出格式

输出 $m+1$ 行，每行一个非负整数，表示最大总损失。

### 样例输入

```text
5 3
1 2 6 4
2 3 2 1
3 4 5 3
3 5 8 5
3 2
4 3
1 1
```

### 样例输出

```text
0
1
3
4
```

### 子任务

* $2 \le n \le 10^5, 0 \le m \le 10^5$。
* $0 \le w_i, b_i, y_i \le 10^9$。
* 特殊性质包括链状结构、特定权值范围、树的直径较小等。
