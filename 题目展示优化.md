# 题目展示优化

## 问题描述

### 问题1: 测试数据没有换行
**现象**:
```
输入：3 2 10 10 0 0 10 -20 1 -1 0 0
输出：21 -11 20 -10
```
所有数据挤在一行，难以阅读。

**期望**:
```
输入：
3 2
10 10
0 0
10 -20
1 -1
0 0

输出：
21 -11
20 -10
```

### 问题2: Ctrl+滚轮无法缩放测试数据
**现象**: 
- 按Ctrl+滚轮时，只有题目描述部分缩放
- 测试输入输出区域不跟随缩放
- 字体大小不一致，阅读体验差

## 解决方案

### 1. 修复换行显示

#### 问题原因
```cpp
// 之前的代码
html += QString("<div class='io-block'>%1</div>")
    .arg(tc.input.toHtmlEscaped());
```

`toHtmlEscaped()`会转义所有HTML字符，包括换行符`\n`，导致换行不显示。

#### 解决方法
```cpp
// 修复后的代码
QString inputHtml = tc.input.toHtmlEscaped().replace("\n", "<br>");
html += QString("<div class='io-block'>%1</div>").arg(inputHtml);
```

**步骤**:
1. 先用`toHtmlEscaped()`转义特殊字符（防止XSS）
2. 再把`\n`替换为`<br>`标签
3. 这样既安全又能正确显示换行

### 2. 支持Ctrl+滚轮缩放

#### 创建自定义QTextBrowser
```cpp
class ZoomableTextBrowser : public QTextBrowser
{
    Q_OBJECT
public:
    explicit ZoomableTextBrowser(QWidget *parent = nullptr) 
        : QTextBrowser(parent) {}
    
protected:
    void wheelEvent(QWheelEvent *event) override
    {
        // Ctrl+滚轮缩放
        if (event->modifiers() & Qt::ControlModifier) {
            int delta = event->angleDelta().y();
            if (delta > 0) {
                zoomIn(1);  // 放大
            } else if (delta < 0) {
                zoomOut(1);  // 缩小
            }
            event->accept();
        } else {
            // 正常滚动
            QTextBrowser::wheelEvent(event);
        }
    }
};
```

**功能**:
- `Ctrl+滚轮向上` - 放大字体
- `Ctrl+滚轮向下` - 缩小字体
- 不按Ctrl - 正常滚动

### 3. 改进CSS样式

#### 测试数据区域样式
```css
.io-block {
    background-color: #1e1e1e;
    padding: 12px;
    border-radius: 4px;
    margin: 8px 0;
    font-family: 'Consolas', 'Monaco', monospace;
    font-size: 10pt;
    line-height: 1.6;
    user-select: text;
    white-space: pre-wrap;      /* 保留空白和换行 */
    word-wrap: break-word;      /* 长单词换行 */
    border: 1px solid #3a3a3a;  /* 边框 */
    color: #e8e8e8;
}
```

**改进点**:
- `white-space: pre-wrap` - 保留换行和空格
- `word-wrap: break-word` - 长单词自动换行
- `line-height: 1.6` - 增加行高，更易读
- `border: 1px solid #3a3a3a` - 添加边框，更清晰
- `font-size: 10pt` - 增大字体（之前9.5pt）

## 效果对比

### 之前 ❌
```
示例 1
输入：
3 2 10 10 0 0 10 -20 1 -1 0 0
输出：
21 -11 20 -10
```
- 所有数据挤在一行
- Ctrl+滚轮不能缩放
- 字体较小，难以阅读

### 现在 ✅
```
示例 1
输入：
3 2
10 10
0 0
10 -20
1 -1
0 0

输出：
21 -11
20 -10
```
- 换行正确显示
- Ctrl+滚轮可以缩放
- 字体更大，易于阅读
- 有边框，视觉更清晰

## 使用说明

### 查看测试数据
1. 打开题目
2. 滚动到"示例"部分
3. 查看输入输出数据
4. 数据会按原始格式显示，保留所有换行

### 缩放字体
1. 将鼠标移到题目面板上
2. 按住`Ctrl`键
3. 滚动鼠标滚轮
   - 向上滚 → 放大字体
   - 向下滚 → 缩小字体
4. 整个题目面板（包括测试数据）都会缩放

### 复制测试数据
1. 在测试数据区域选中文本
2. `Ctrl+C`复制
3. 粘贴到代码编辑器或其他地方
4. 换行会被保留

## 技术细节

### HTML转义和换行处理
```cpp
// 1. 转义HTML特殊字符（安全）
QString inputHtml = tc.input.toHtmlEscaped();

// 2. 替换换行符为<br>标签
inputHtml = inputHtml.replace("\n", "<br>");

// 3. 插入到HTML中
html += QString("<div class='io-block'>%1</div>").arg(inputHtml);
```

**为什么这样做**:
- `toHtmlEscaped()` - 防止XSS攻击，转义`<`、`>`、`&`等
- `replace("\n", "<br>")` - 保留换行显示
- 顺序很重要：先转义，再替换换行

### 滚轮事件处理
```cpp
void wheelEvent(QWheelEvent *event) override
{
    if (event->modifiers() & Qt::ControlModifier) {
        // Ctrl被按下，执行缩放
        int delta = event->angleDelta().y();
        if (delta > 0) {
            zoomIn(1);   // QTextBrowser内置方法
        } else if (delta < 0) {
            zoomOut(1);  // QTextBrowser内置方法
        }
        event->accept();  // 标记事件已处理
    } else {
        // Ctrl未按下，正常滚动
        QTextBrowser::wheelEvent(event);
    }
}
```

### CSS white-space属性
| 值 | 换行 | 空格 | 自动换行 |
|----|------|------|---------|
| normal | 合并 | 合并 | 是 |
| nowrap | 合并 | 合并 | 否 |
| pre | 保留 | 保留 | 否 |
| pre-wrap | 保留 | 保留 | 是 ✅ |
| pre-line | 保留 | 合并 | 是 |

我们使用`pre-wrap`，既保留换行和空格，又支持自动换行。

## 测试建议

### 测试1: 多行输入
```
输入：
3 2
10 10
0 0
10 -20
1 -1
0 0
```
**预期**: 每行数据单独显示

### 测试2: 长行输入
```
输入：
100 1 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0 1 0
```
**预期**: 自动换行，不出现横向滚动条

### 测试3: 缩放功能
1. 按住Ctrl，向上滚动
2. **预期**: 字体变大
3. 按住Ctrl，向下滚动
4. **预期**: 字体变小
5. 不按Ctrl，滚动
6. **预期**: 正常上下滚动

### 测试4: 特殊字符
```
输入：
<html>
&nbsp;
"quotes"
```
**预期**: 特殊字符正确转义显示，不会被解析为HTML

## 常见问题

### Q1: 为什么不用`<pre>`标签？
**A**: `<pre>`标签不会自动换行，长行会导致横向滚动条，体验不好。`white-space: pre-wrap`既保留格式又支持自动换行。

### Q2: 缩放后刷新题目会重置吗？
**A**: 会的。每次调用`setQuestion()`都会重新生成HTML，缩放级别会重置。可以考虑保存缩放级别。

### Q3: 能否支持更多快捷键？
**A**: 可以。可以添加：
- `Ctrl+0` - 重置缩放
- `Ctrl++` - 放大
- `Ctrl+-` - 缩小

### Q4: 复制的文本会保留格式吗？
**A**: 会保留换行，但不会保留HTML格式（如颜色、字体）。这是QTextBrowser的默认行为。

## 总结

✅ **换行正确显示** - 测试数据按原始格式显示
✅ **支持缩放** - Ctrl+滚轮缩放整个题目面板
✅ **样式优化** - 更大的字体、更清晰的边框
✅ **易于复制** - 可以直接选中复制测试数据
✅ **安全性** - HTML转义防止XSS攻击

现在题目展示区更加清晰易读，测试数据的格式也能正确显示了！
