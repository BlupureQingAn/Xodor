# 题库列表功能增强

## 概述

对题库列表（PracticeWidget）进行了全面的功能增强，提供更丰富的刷题体验和更强大的管理功能。

## 新增功能

### 1. 题库选择器 📚

**位置：** 页面顶部

**功能：**
- 显示当前题库名称和题目数量
- 下拉选择其他已导入的题库
- 快速切换题库按钮

**使用场景：**
- 在多个题库之间快速切换
- 查看当前使用的题库信息

### 2. 可视化进度条 📊

**位置：** 统计信息右侧

**功能：**
- 实时显示刷题完成进度百分比
- 渐变色进度条（红色主题）
- 动态更新

**显示内容：**
- 完成进度：XX%
- 视觉化的进度条

### 3. 随机题目 🎲

**按钮：** "🎲 随机题目"

**功能：**
- 从题库中随机选择一道题目
- 自动切换到刷题模式
- 适合想要挑战不同题目的用户

**使用场景：**
- 打破顺序刷题的单调
- 随机练习，增加趣味性

### 4. 智能推荐 💡

**按钮：** "💡 推荐题目"

**功能：**
- 基于智能算法推荐下一道题目
- 推荐策略：
  1. 优先推荐进行中的题目（继续未完成的）
  2. 其次推荐未开始的简单题目（循序渐进）
  3. 都完成后推荐第一题（复习）

**使用场景：**
- 不知道做哪道题时
- 想要系统化学习

### 5. 批量标记 ✓

**按钮：** "✓ 批量标记"

**功能：**
- 支持多选题目（Ctrl/Shift + 点击）
- 批量标记状态：
  - 未开始
  - 进行中
  - 已完成
  - 已掌握

**使用场景：**
- 导入已做过的题库，批量标记已完成
- 整理题目状态

### 6. 导出进度报告 📊

**按钮：** "📊 导出报告"

**功能：**
- 导出详细的刷题进度报告（TXT格式）
- 报告内容：
  - 生成时间
  - 题库名称
  - 总体统计（总题数、完成数、掌握数、正确率）
  - 详细题目列表（题号、题目、难度、状态、正确率、尝试次数）

**使用场景：**
- 记录学习进度
- 分享给老师或同学
- 备份进度数据

### 7. 排序功能 🔄

**方式1：** 点击表头排序
- 点击任意列的表头
- 再次点击切换升序/降序

**方式2：** 排序下拉框
- 默认排序
- 按题号
- 按难度
- 按正确率
- 按尝试次数

**使用场景：**
- 找出正确率最低的题目重点练习
- 按难度排序，循序渐进

### 8. 增强的筛选功能

**新增筛选项：**
- 排序选择器
- 更好的样式和交互

**原有筛选：**
- 搜索框（支持题目名称搜索）
- 难度筛选（简单/中等/困难）
- 题型筛选（动态加载题库中的标签）
- 状态筛选（未开始/进行中/已完成/已掌握/AI判题通过）

## UI 改进

### 1. 现代化设计

**颜色主题：**
- 深色背景：#242424
- 次级背景：#2d2d2d
- 边框：#4a4a4a
- 主题色：#660000（红色）
- 悬停色：#880000

**组件样式：**
- 圆角设计（6-12px）
- 渐变进度条
- 悬停效果
- 统一的按钮样式

### 2. 布局优化

**层次结构：**
```
┌─────────────────────────────────────────────┐
│ 📚 刷题系统  [当前题库: XXX] [切换题库]      │
├─────────────────────────────────────────────┤
│ 统计信息                    [进度条 XX%]     │
├─────────────────────────────────────────────┤
│ [搜索] [难度] [题型] [状态] [排序]          │
├─────────────────────────────────────────────┤
│ [🎲随机] [💡推荐] [✓批量] [📊导出] [🔄刷新] │
├─────────────────────────────────────────────┤
│                                             │
│            题目列表表格                      │
│                                             │
└─────────────────────────────────────────────┘
```

### 3. 交互改进

**多选支持：**
- Ctrl + 点击：多选
- Shift + 点击：范围选择
- 选中行高亮显示

**表头交互：**
- 悬停时高亮
- 点击排序
- 鼠标指针变化

**按钮反馈：**
- 悬停变色
- 按下效果
- 禁用状态

## 技术实现

### 新增成员变量

```cpp
// UI组件
QComboBox *m_bankSelector;        // 题库选择器
QProgressBar *m_progressBar;      // 进度条
QComboBox *m_sortCombo;           // 排序选择
QPushButton *m_randomBtn;         // 随机题目
QPushButton *m_recommendBtn;      // 推荐题目
QPushButton *m_exportBtn;         // 导出报告
QPushButton *m_batchMarkBtn;      // 批量标记

// 状态变量
int m_sortColumn;                 // 排序列
Qt::SortOrder m_sortOrder;        // 排序顺序
```

### 新增方法

```cpp
// UI更新
void updateBankSelector();        // 更新题库选择器

// 功能方法
Question getRandomQuestion() const;      // 获取随机题目
Question getRecommendedQuestion() const; // 获取推荐题目
void exportProgressReport();             // 导出进度报告
void batchMarkStatus();                  // 批量标记状态

// 槽函数
void onRandomQuestionClicked();
void onRecommendQuestionClicked();
void onSwitchBankClicked();
void onExportProgressClicked();
void onBatchMarkClicked();
void onHeaderClicked(int logicalIndex);
```

### 新增信号

```cpp
signals:
    void switchBankRequested();  // 请求切换题库
```

## 使用指南

### 快速开始

1. **查看题库信息**
   - 顶部显示当前题库名称和题目数量
   - 进度条显示完成百分比

2. **筛选题目**
   - 使用搜索框快速查找
   - 选择难度、题型、状态筛选
   - 选择排序方式

3. **选择题目**
   - 双击题目行开始刷题
   - 或使用随机/推荐功能

4. **批量操作**
   - Ctrl + 点击选择多个题目
   - 点击"批量标记"统一设置状态

5. **导出报告**
   - 点击"导出报告"
   - 选择保存位置
   - 生成详细的进度报告

### 高级技巧

**智能推荐策略：**
- 系统会优先推荐你正在做的题目
- 新题目从简单开始
- 帮助你循序渐进地学习

**排序技巧：**
- 按正确率排序，找出薄弱环节
- 按尝试次数排序，找出难题
- 按难度排序，系统化学习

**批量标记场景：**
- 导入已做过的题库，批量标记为"已完成"
- 标记一批题目为"进行中"，集中攻克
- 标记已掌握的题目，避免重复练习

## 与其他功能的集成

### 题库管理器集成

- 题库选择器自动同步 QuestionBankManager
- 显示所有已注册的题库
- 点击"切换题库"打开题库管理对话框

### 进度管理器集成

- 实时同步 ProgressManager 的数据
- 自动更新统计信息
- 支持批量修改进度状态

### 主窗口集成

- 选择题目后自动切换到刷题模式
- 保持题目索引同步
- 状态栏显示操作反馈

## 性能优化

1. **延迟加载**
   - 初始化时不立即加载题目
   - 等待 refreshQuestionList() 调用

2. **信号阻塞**
   - 更新筛选器时临时阻塞信号
   - 避免触发多次刷新

3. **批量操作**
   - 使用 QSet 去重选中行
   - 一次性更新所有状态

## 未来扩展

### 可能的增强功能

1. **统计图表**
   - 难度分布饼图
   - 完成趋势折线图
   - 正确率柱状图

2. **学习计划**
   - 设置每日目标
   - 自动生成学习计划
   - 进度提醒

3. **题目标签**
   - 自定义标签
   - 标签管理
   - 按标签筛选

4. **导出格式**
   - 支持 PDF 导出
   - 支持 Excel 导出
   - 支持 Markdown 导出

5. **云同步**
   - 进度云端备份
   - 多设备同步
   - 分享进度

## 修改的文件

- `src/ui/PracticeWidget.h` - 添加新的成员和方法
- `src/ui/PracticeWidget.cpp` - 实现所有新功能
- `src/ui/MainWindow.cpp` - 连接新的信号

## 测试建议

1. **题库选择器测试**
   - 导入多个题库
   - 测试切换功能
   - 验证显示正确

2. **随机和推荐测试**
   - 测试随机题目选择
   - 验证推荐算法
   - 检查边界情况（空题库）

3. **批量标记测试**
   - 选择多个题目
   - 测试各种状态标记
   - 验证更新正确

4. **导出报告测试**
   - 导出完整报告
   - 检查格式正确
   - 验证中文编码

5. **排序测试**
   - 点击各列表头
   - 测试升序降序
   - 验证排序正确

6. **UI响应测试**
   - 测试所有按钮
   - 验证悬停效果
   - 检查禁用状态

## 总结

这次增强为题库列表添加了丰富的功能，使其从简单的题目列表变成了功能完善的刷题管理中心。用户可以更高效地管理和练习题目，获得更好的学习体验。
