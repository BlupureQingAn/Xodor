# 题库管理路径修复说明

## 问题诊断

从截图可以看到，题库详情显示的存储路径是：
```
C:/Users/1/AppData/Roaming/CodePractice/CodePracticeSystem/QuestionBanks/2ca80bb8-d352-4534-a9d5-61c0962da9a0
```

这是错误的！应该显示项目目录下的路径：
```
data/基础题库/CCF
```

## 根本原因

1. **旧配置文件问题**：用户的 AppData 目录下可能有旧的 `question_banks.json` 配置文件，其中保存了错误的路径
2. **路径规范化缺失**：`QuestionBankManager::importQuestionBank()` 没有强制规范化路径到 `data/基础题库/`

## 修复方案

### 1. 修复 QuestionBankManager::importQuestionBank()

已完成修复，确保所有导入的题库路径都规范化为：
- 存储路径：`data/基础题库/{题库名}`
- 原始路径：`data/原始题库/{题库名}`

### 2. 修复题库详情显示

需要在 `QuestionBankManagerDialog::onViewBankDetails()` 中：
- 显示绝对路径而不是相对路径
- 确保路径信息清晰易读

### 3. 添加题库路径验证和修复功能

在题库管理器加载时，自动检测并修复错误的路径。

## 具体修改

### 文件1: src/core/QuestionBankManager.cpp

✅ 已修复 `importQuestionBank()` 函数，添加路径规范化逻辑

### 文件2: src/core/QuestionBankManager.h

需要添加路径验证和修复函数：
```cpp
// 验证和修复题库路径
bool validateAndFixBankPaths();
```

### 文件3: src/ui/QuestionBankManagerDialog.cpp

需要修改 `onViewBankDetails()` 函数，在第510-515行之间添加：
```cpp
// 获取绝对路径用于显示
QDir currentDir;
QString absolutePath = currentDir.absoluteFilePath(info.path);
QString absoluteOriginalPath = info.originalPath.isEmpty() ? "无" : currentDir.absoluteFilePath(info.originalPath);
```

然后将第547-548行的：
```cpp
.arg(info.path)
.arg(info.originalPath.isEmpty() ? "无" : info.originalPath);
```

替换为：
```cpp
.arg(absolutePath)
.arg(absoluteOriginalPath);
```

## 用户操作建议

### 临时解决方案（立即生效）

1. 删除旧配置文件：
   ```
   C:\Users\1\AppData\Roaming\CodePractice\CodePracticeSystem\question_banks.json
   ```

2. 重启程序，重新导入题库

### 永久解决方案

等待代码修复完成后重新编译程序。

## 测试验证

修复后需要验证：
1. ✅ 新导入的题库路径正确（data/基础题库/）
2. ⏳ 题库详情显示完整的绝对路径
3. ⏳ 旧题库路径自动修复
4. ⏳ 题库加载功能正常
