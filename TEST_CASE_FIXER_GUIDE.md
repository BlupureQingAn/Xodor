# 测试用例修复工具使用指南

## 功能说明

测试用例修复工具用于检测和修复题目JSON文件中的测试用例格式问题，特别是AI生成的测试用例中常见的问题：
- 包含省略号（...）的不完整输入
- 包含"重复"标记但未展开的数据
- 输入数据过短或格式不正确

## 使用方法

### 1. 打开修复工具
- 选择一道题目
- 点击菜单：**工具 → 🔧 修复测试用例**

### 2. 检测问题
- 点击"🔍 检测问题"按钮
- 工具会扫描所有测试用例，列出发现的问题

### 3. 使用AI修复
- 点击"🤖 AI修复"按钮
- 工具会生成一个详细的修复提示词
- 将提示词复制并发送给AI（如ChatGPT、Claude等）
- 将AI的响应粘贴到下方的文本框中

### 4. 应用修复
- 点击"💾 保存修复"按钮
- 工具会解析AI的响应，提取修复后的测试用例
- 自动保存到题目JSON文件中

## 示例

### 问题示例
```json
{
    "description": "边界条件：最大操作数，简单重复",
    "input": "100 1\n1 0\n1 0\n... (重复100次)\n0 0",
    "output": "100 0"
}
```

### 修复后
```json
{
    "description": "边界条件：最大操作数，简单重复",
    "input": "100 1\n1 0\n1 0\n1 0\n...(展开所有100行)\n0 0",
    "output": "100 0"
}
```

## AI提示词格式

工具会生成类似以下的提示词：

```
你是一个测试用例修复专家。请修复以下C++编程题目的测试用例。

【题目信息】
标题：坐标变换（其一）
描述：对于平面直角坐标系上的坐标...

【有问题的测试用例】
测试用例 5：
描述：边界条件：最大操作数，简单重复
当前输入：
100 1
1 0
1 0
... (重复100次)
0 0

期望输出：
100 0

【修复要求】
1. 将所有省略号（...）和"重复"标记展开为完整的输入数据
2. 确保输入格式符合题目要求
3. 输入数据要完整、准确、可直接复制使用
...
```

## 注意事项

1. **备份数据**：修复前建议备份题目JSON文件
2. **验证修复**：修复后运行测试验证结果是否正确
3. **手动调整**：如果AI修复不准确，可以手动编辑JSON文件
4. **重新加载**：修复后题库会自动重新加载

## 文件位置

题目JSON文件通常位于：
- `data/基础题库/CCF/XX/题目名称.json`
- `data/原始题库/...`

## 故障排除

### 问题：无法找到题目文件路径
**解决**：确保题目是从JSON文件加载的，而不是临时创建的

### 问题：AI响应无法解析
**解决**：确保AI的响应包含```json...```格式的JSON数据

### 问题：保存失败
**解决**：检查文件权限，确保有写入权限

## 技术实现

- **检测逻辑**：`TestCaseFixer::hasTestCaseIssues()`
- **提示词生成**：`TestCaseFixerDialog::generateFixPrompt()`
- **JSON解析**：使用QJsonDocument解析AI响应
- **文件保存**：直接覆盖原JSON文件

## 未来改进

- [ ] 集成AI客户端，实现自动修复
- [ ] 支持批量修复多个题目
- [ ] 提供测试用例编辑器
- [ ] 自动验证修复后的测试用例
