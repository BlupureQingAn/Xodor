# 圆角元素文字显示修复完成（1.5倍字体权重）

## 修复时间
2024-12-05

## 问题描述
题库统计面板界面内所有有圆框样式的元素（包括按钮、下拉框、搜索框、统计卡片、进度条等）都会出现字体显示不全的问题，主要是高度不够导致圆角边框会把字的上下部分截断。

## 根本原因
1. **Qt StyleSheet 不支持 `line-height` 属性**：CSS 中的 `line-height` 在 Qt StyleSheet 中不起作用
2. **缺少 `setMinimumHeight()` 设置**：仅依赖 CSS padding 无法保证足够的高度
3. **字体大小权重不足**：原始计算没有给字体留足够的垂直空间，需要将字体大小的权重增加到1.5倍

## 解决方案（字体权重 × 1.5）

### 1. 统计卡片（PracticeStatsPanel.cpp）
```cpp
// 18pt字体 * 1.5 = 27pt等效高度
// 卡片高度：165px（原110px）
card->setFixedHeight(165);
cardLayout->setContentsMargins(16, 24, 16, 24);  // 增加内边距

// 图标和数值：minimumHeight 48px（原32px），padding 8px
iconLabel->setMinimumHeight(48);
valueLabel->setMinimumHeight(48);

// 标签：minimumHeight 30px（原20px），padding 6px
titleLabel->setMinimumHeight(30);
```

### 2. 进度条（PracticeStatsPanel.cpp）
```cpp
// 9pt字体 * 1.5 = 13.5pt等效高度
// 进度条高度：45px（原30px），圆角 22px
bar->setFixedHeight(45);
bar->setStyleSheet("border-radius: 22px; padding: 6px 14px;");

// 标签：minimumHeight 36px（原24px），padding 6px
labelWidget->setMinimumHeight(36);
labelWidget->setFixedWidth(70);  // 增加宽度
```

### 3. 操作按钮（PracticeWidget.cpp）
```cpp
// 10pt字体 * 1.5 = 15pt等效高度
// 所有操作按钮：minimumHeight 56px（原38px）
m_randomBtn->setMinimumHeight(56);
m_recommendBtn->setMinimumHeight(56);
m_batchMarkBtn->setMinimumHeight(56);
m_exportBtn->setMinimumHeight(56);
m_refreshBtn->setMinimumHeight(56);
m_resetProgressBtn->setMinimumHeight(56);

// 圆角和内边距：border-radius 10px，padding 14px 20px
```

### 4. 下拉框（PracticeWidget.cpp）
```cpp
// 10pt字体 * 1.5 = 15pt等效高度
// 所有下拉框：minimumHeight 54px（原36px）
m_difficultyFilter->setMinimumHeight(54);
m_tagFilter->setMinimumHeight(54);
m_statusFilter->setMinimumHeight(54);
m_sortCombo->setMinimumHeight(54);
m_bankSelector->setMinimumHeight(54);

// 圆角和内边距：border-radius 8px，padding 12px 16px
```

### 5. 搜索框和切换按钮（PracticeWidget.cpp）
```cpp
// 10pt字体 * 1.5 = 15pt等效高度
// 搜索框：minimumHeight 54px（原36px）
m_searchEdit->setMinimumHeight(54);

// 切换题库按钮：minimumHeight 54px（原36px）
switchBankBtn->setMinimumHeight(54);

// 圆角和内边距：border-radius 8px，padding 12px 16px/20px
```

### 6. 题目列表表格（PracticeWidget.cpp）
```cpp
// 表格最小高度：440px（确保显示至少10行）
m_questionTable->setMinimumHeight(440);
```

## 修改的文件
1. `src/ui/PracticeStatsPanel.cpp` - 统计卡片和进度条
2. `src/ui/PracticeWidget.cpp` - 按钮、下拉框、搜索框、表格

## 高度计算公式（字体权重 × 1.5）

### 基本公式
```
minimumHeight = (字体大小pt × 1.5 × 像素比例) + (padding × 2) + 边框
```

### 实际应用
- **9pt 字体**：9 × 1.5 = 13.5pt → 约30-36px
- **10pt 字体**：10 × 1.5 = 15pt → 约54-56px
- **18pt 字体**：18 × 1.5 = 27pt → 约48px（单个元素）

### 圆角半径调整
- 高度增加后，圆角半径也相应增加以保持视觉比例
- 例如：height 45px → border-radius 22px
- 例如：height 54px → border-radius 8-10px

## 技术要点

### Qt StyleSheet 限制
Qt StyleSheet 是 CSS 的子集，不支持以下属性：
- `line-height` - 不起作用
- `min-height` - 应使用 C++ 的 `setMinimumHeight()`
- `max-height` - 应使用 C++ 的 `setMaximumHeight()`

### 正确的做法
1. **使用 C++ 方法设置尺寸**：
   ```cpp
   widget->setMinimumHeight(height);
   widget->setFixedHeight(height);
   ```

2. **根据字体大小调整内边距和高度（1.5倍权重）**：
   - 小字体（9-10pt）：padding 6-12px，minimumHeight 30-54px
   - 中字体（10-12pt）：padding 8-14px，minimumHeight 48-56px
   - 大字体（18-20pt）：padding 8px，minimumHeight 48px

3. **圆角半径与高度的关系**：
   - 圆角半径应为高度的一半（完全圆角）或略小
   - 例如：height 45px → border-radius 22px
   - 例如：height 54px → border-radius 8px

## 编译结果
✅ 编译成功，无错误

## 对比表（修改前后）

| 元素 | 原高度 | 新高度 | 字体大小 | 增幅 |
|------|--------|--------|----------|------|
| 统计卡片 | 110px | 165px | 18pt | +50% |
| 进度条 | 30px | 45px | 9pt | +50% |
| 操作按钮 | 38px | 56px | 10pt | +47% |
| 下拉框 | 36px | 54px | 10pt | +50% |
| 搜索框 | 36px | 54px | 10pt | +50% |
| 切换按钮 | 36px | 54px | 10pt | +50% |

## 测试建议
1. 检查所有统计卡片的文字是否完整显示（特别是18pt大字体）
2. 检查所有按钮的文字是否完整显示
3. 检查所有下拉框的文字是否完整显示
4. 检查搜索框的文字是否完整显示
5. 检查进度条的文字是否完整显示
6. 检查题目列表是否至少显示10行
7. 测试不同字体大小下的显示效果
8. 验证圆角边框不会截断任何文字的上下部分

## 相关文档
- 题库面板滚动区域重构完成.md
- 统计面板间距优化完成.md
- 题库面板数据加载修复完成.md
- 题目列表高度和大字体显示修复完成.md
