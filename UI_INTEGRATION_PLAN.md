# UI 集成计划

## 🎯 目标

将阶段一和阶段二完成的功能集成到用户界面，让用户可以实际使用这些功能。

## 📋 集成任务清单

### 任务 1：导入对话框增强 ⭐⭐⭐

**目标**：在导入对话框中添加"通用解析"选项

**修改文件**：
- `src/ui/SmartImportDialog.h`
- `src/ui/SmartImportDialog.cpp`

**功能**：
- 添加单选按钮：AI 解析 / 通用解析
- 通用解析调用 `startImportWithUniversalParser()`
- 显示题库分析报告链接

**UI 设计**：
```
┌─────────────────────────────────────────┐
│ 🤖 智能导入题库                        │
├─────────────────────────────────────────┤
│ 题库路径：[_______________] [浏览]     │
│ 题库名称：[_______________]             │
│                                         │
│ 导入模式：                              │
│ ○ AI 智能解析（推荐，生成测试数据）    │
│ ● 通用格式解析（快速，保留原始数据）   │
│                                         │
│ [开始导入]  [取消]                      │
└─────────────────────────────────────────┘
```

---

### 任务 2：代码版本历史对话框 ⭐⭐⭐

**目标**：创建代码版本历史查看和恢复界面

**新增文件**：
- `src/ui/CodeVersionDialog.h`
- `src/ui/CodeVersionDialog.cpp`

**功能**：
- 显示版本列表（时间、行数、测试结果）
- 查看版本代码
- 恢复到指定版本
- 删除版本

**UI 设计**：
```
┌──────────────────────────────────────────────┐
│ 📜 代码版本历史 - 两数之和                   │
├──────────────────────────────────────────────┤
│ 版本列表：                                   │
│ ┌──────────────────────────────────────────┐ │
│ │ ✅ 2024-12-02 15:45:12  45行  [5/5]     │ │
│ │ ❌ 2024-12-02 15:40:33  42行  [3/5]     │ │
│ │ ❌ 2024-12-02 15:35:00  38行  [2/5]     │ │
│ │ ⏳ 2024-12-02 15:30:00  35行  [未测试]  │ │
│ └──────────────────────────────────────────┘ │
│                                              │
│ 代码预览：                                   │
│ ┌──────────────────────────────────────────┐ │
│ │ #include <vector>                        │ │
│ │ using namespace std;                     │ │
│ │ ...                                      │ │
│ └──────────────────────────────────────────┘ │
│                                              │
│ [恢复此版本]  [删除]  [关闭]                │
└──────────────────────────────────────────────┘
```

---

### 任务 3：AI 助手面板集成 ⭐⭐⭐

**目标**：在主窗口或刷题界面添加 AI 助手面板

**修改文件**：
- `src/ui/MainWindow.h`
- `src/ui/MainWindow.cpp`

**新增文件**：
- `src/ui/AIAssistantPanel.h`
- `src/ui/AIAssistantPanel.cpp`

**功能**：
- 对话历史显示
- 输入框和发送按钮
- 快捷按钮（获取提示、知识点讲解）
- 可折叠面板

**UI 设计**：
```
┌─────────────────────────────────────┐
│ 🤖 AI 助手                    [▼]  │
├─────────────────────────────────────┤
│ [💡 获取思路]  [📚 知识点讲解]     │
├─────────────────────────────────────┤
│ 对话历史：                          │
│ ┌─────────────────────────────────┐ │
│ │ 👤 用户: 这道题用什么算法？     │ │
│ │ 🤖 AI: 可以使用哈希表...        │ │
│ │                                 │ │
│ │ 👤 用户: 时间复杂度是多少？     │ │
│ │ 🤖 AI: 时间复杂度是 O(n)...    │ │
│ └─────────────────────────────────┘ │
│                                     │
│ 输入问题：                          │
│ [_____________________________]     │
│                        [发送]       │
└─────────────────────────────────────┘
```

---

### 任务 4：测试结果显示优化 ⭐⭐

**目标**：优化测试结果显示，显示失败原因和执行时间

**修改文件**：
- `src/ui/MainWindow.cpp` (showTestResults 方法)
- `src/core/CompilerRunner.cpp` (实现执行时间统计)

**功能**：
- 显示失败原因（答案错误/运行时错误/超时）
- 显示执行时间
- 标注测试数据来源（原始/AI 补充）
- 使用图标和颜色区分

**UI 优化**：
```
测试结果：通过 3/5

✅ 测试用例 1/5 - 基本测试 [原始]
   输入：[2,7,11,15], 9
   期望：[0,1]
   实际：[0,1]
   ⏱️ 2ms

❌ 测试用例 3/5 - 边界条件 [AI补充]
   输入：[], 0
   期望：[]
   实际：null
   ❗ 失败原因：答案错误
   ⏱️ 0ms
```

---

### 任务 5：自动保存集成 ⭐⭐

**目标**：在 AutoSaver 中集成 CodeVersionManager

**修改文件**：
- `src/core/AutoSaver.h`
- `src/core/AutoSaver.cpp`

**功能**：
- 保存代码时同时保存版本
- 测试通过后保存版本（标记测试结果）

---

### 任务 6：菜单和快捷键 ⭐

**目标**：添加新功能的菜单项和快捷键

**修改文件**：
- `src/ui/MainWindow.cpp` (setupMenuBar)

**新增菜单项**：
- 查看 → 代码版本历史 (Ctrl+Shift+H)
- 查看 → AI 助手面板 (Ctrl+Shift+A)
- 查看 → 题库分析报告

---

## 📊 实施优先级

### 高优先级（必须实现）⭐⭐⭐
1. ✅ 导入对话框增强
2. ✅ 代码版本历史对话框
3. ✅ 测试结果显示优化

### 中优先级（建议实现）⭐⭐
4. ✅ AI 助手面板集成
5. ✅ 自动保存集成

### 低优先级（可选）⭐
6. ⏳ 菜单和快捷键

---

## 🔧 实施步骤

### Step 1: 增强导入对话框
- 添加导入模式选择
- 集成通用解析器
- 显示分析报告

### Step 2: 创建版本历史对话框
- 设计 UI 布局
- 实现版本列表显示
- 实现恢复功能

### Step 3: 创建 AI 助手面板
- 设计 UI 布局
- 实现对话显示
- 集成 AIAssistant

### Step 4: 优化测试结果显示
- 修改显示格式
- 添加失败原因
- 添加执行时间

### Step 5: 集成自动保存
- 在 AutoSaver 中添加版本管理
- 测试通过时保存版本

---

## 🎯 验收标准

- [ ] 导入对话框有"通用解析"选项
- [ ] 可以查看代码版本历史
- [ ] 可以恢复到历史版本
- [ ] AI 助手面板可以提问和获取提示
- [ ] 测试结果显示失败原因和执行时间
- [ ] 代码自动保存版本
- [ ] 编译通过，无错误

---

## 📝 预计时间

- Step 1: 0.5 天
- Step 2: 1 天
- Step 3: 1 天
- Step 4: 0.5 天
- Step 5: 0.5 天

**总计**: 3.5 天

---

开始实施！
