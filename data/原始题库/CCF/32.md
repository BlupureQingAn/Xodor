以下是整理好的第32次CCF计算机软件能力认证（CSP）模拟试题集合。

---

# 第32次CCF计算机软件能力认证

## 题目 1：仓库规划 (Warehouse Planning)

**时间限制：** 1.0 秒
**空间限制：** 512 MiB

### 题目描述

西西艾弗岛上共有 $n$ 个仓库，依次编号为 $1 \dots n$。每个仓库均有一个 $m$ 维向量的位置编码，用来表示仓库间的物流运转关系。

具体来说，每个仓库 $i$ 均可能有一个上级仓库 $j$，满足：仓库 $j$ 位置编码的每一维均大于仓库 $i$ 位置编码的对应元素。比如编码为 $(1,1,1)$ 的仓库可以成为 $(0,0,0)$ 的上级，但不能成为 $(0,1,0)$ 的上级。如果有多个仓库均满足该要求，则选取其中编号最小的仓库作为仓库 $i$ 的上级仓库；如果没有仓库满足条件，则说明仓库 $i$ 是一个物流中心，没有上级仓库。

现给定 $n$ 个仓库的位置编码，试计算每个仓库的上级仓库编号。

### 输入格式

从标准输入读入数据。
输入共 $n+1$ 行。
输入的第一行包含两个正整数 $n$ 和 $m$，分别表示仓库个数和位置编码的维数。
接下来 $n$ 行依次输入 $n$ 个仓库的位置编码。其中第 $i$ 行（$1 \le i \le n$）包含 $m$ 个整数，表示仓库 $i$ 的位置编码。

### 输出格式

输出到标准输出。
输出共 $n$ 行。
第 $i$ 行（$1 \le i \le n$）输出一个整数，表示仓库 $i$ 的上级仓库编号；如果仓库 $i$ 没有上级，则第 $i$ 行输出 0。

### 样例

**输入：**

```text
4 2
0 0
-1 -1
1 2
0 -1
```

**输出：**

```text
3
1
0
3
```

**解释：**
对于仓库 2: $(-1, -1)$ 来说，仓库 1: $(0, 0)$ 和仓库 3: $(1, 2)$ 均满足上级仓库的编码要求，因此选择编号较小的仓库 1 作为其上级。

### 子任务

* 50% 的测试数据满足 $m=2$；
* 全部的测试数据满足 $0 < m \le 10, 0 < n \le 1000$，且位置编码中的所有元素均为绝对值不大于 $10^6$ 的整数。

---

## 题目 2：因子化简 (Factor Simplification)

**时间限制：** 2.0 秒
**空间限制：** 512 MiB

### 题目背景

质数（又称“素数”）是指在大于 1 的自然数中，除了 1 和它本身以外不再有其他因数的自然数。

### 题目描述

小 P 同学在学习了素数的概念后得知，任意的正整数 $n$ 都可以唯一地表示为若干素因子相乘的形式。如果正整数 $n$ 有 $m$ 个不同的素数因子 $p_1, p_2, \dots, p_m$，则可以表示为：
$$ n = p_1^{t_1} \times p_2^{t_2} \times \dots \times p_m^{t_m} $$

小 P 认为，每个素因子对应的指数 $t_i$ 反映了该素因子对于 $n$ 的重要程度。现设定一个阈值 $k$，如果某个素因子 $p_i$ 对应的指数 $t_i$ 小于 $k$，则认为该素因子不重要，可以将 $p_i^{t_i}$ 项从 $n$ 中除去；反之则将 $p_i^{t_i}$ 项保留。最终剩余项的乘积就是 $n$ 简化后的值，如果没有剩余项则认为简化后的值等于 1。

试编写程序处理 $q$ 个查询：每个查询包含两个正整数 $n$ 和 $k$，要求计算按上述方法将 $n$ 简化后的值。

### 输入格式

从标准输入读入数据。
输入共 $q+1$ 行。
输入第一行包含一个正整数 $q$，表示查询的个数。
接下来 $q$ 行每行包含两个正整数 $n$ 和 $k$，表示一个查询。

### 输出格式

输出到标准输出。
输出共 $q$ 行。
每行输出一个正整数，表示对应查询的结果。

### 样例

**输入：**

```text
3
2155895064 3
2 2
10000000000 10
```

**输出：**

```text
2238728
1
10000000000
```

**解释：**

* 查询一：$n = 2^3 \times 3^2 \times 23^4 \times 107$。其中素因子 3 指数为 2，107 指数为 1。将这两项从 $n$ 中除去后，剩余项的乘积为 $2^3 \times 23^4 = 2238728$。
* 查询二：所有项均被除去，输出 1。
* 查询三：所有项均保留，将 $n$ 原样输出。

### 子任务

* 40% 的测试数据满足：$n \le 1000$；
* 80% 的测试数据满足：$n \le 10^5$；
* 全部的测试数据满足：$1 < n \le 10^{10}$ 且 $1 < k, q \le 10$。

---

## 题目 3：树上搜索 (Tree Search)

**时间限制：** 1.0 秒
**空间限制：** 512 MiB

### 题目背景

大数据中心需要收集名词分类数据。名词类别按树形组织，每个名词属于且仅属于一个类别。为了确定一个名词的类别，系统向用户提问“某名词是否属于某类别（或其后代类别）”。

### 题目描述

每个类别有一个权重 $w_i$，表示名词属于该类别的可能性。为了用最少的问题确定名词类别，采用如下策略：

1. 对于当前候选类别集合中的每一个类别，统计它和其全部后代类别（在候选集合中）的权重之和 $W_{in}$，同时统计其余类别权重之和 $W_{out}$，计算差值绝对值 $w_\delta = |W_{in} - W_{out}|$。
2. 选择 $w_\delta$ 最小的类别，若有多个，选编号最小的。向用户询问。
3. 若回答“是”，保留该类别及其后代；若回答“否”，保留其余类别。
4. 重复上述步骤，直到只剩一个类别。

请编写程序，对于给定的类别树和权重，以及若干个目标类别，输出按照上述策略确定该目标类别所需要提出的问题序列。

### 输入格式

输入第一行包含两个正整数 $n$ 和 $m$，分别表示类别数量和测试数量。类别编号 $1 \dots n$，1 为根。
第二行包含 $n$ 个正整数 $w_1, \dots, w_n$，表示权重。
第三行包含 $n-1$ 个正整数 $p_2, \dots, p_n$，表示类别 $2 \dots n$ 的上级类别编号。
接下来 $m$ 行，每行一个正整数，表示需要测试的类别编号。

### 输出格式

输出 $m$ 行，每行若干个空格分隔的正整数，表示对该目标类别提问的类别编号序列。

### 样例

**输入：**

```text
5 2
10 50 10 10 20
1 1 3 3
5
3
```

**输出：**

```text
2 5
2 5 3 4
```

### 子任务

* 20% 数据：权重相等，树高为 2（星型结构）。
* 20% 数据：权重相等，链状结构。
* 60% 数据：$n \le 100, m \le 10$。
* 100% 数据：$n \le 2000, m \le 100, w_i \le 10^7$。

---

## 题目 4：宝藏 (Treasure)

**时间限制：** 1.5 秒
**空间限制：** 512 MiB

### 题目描述

给定 $n$ 条指令，操作一个初始为空的双端队列，元素为 $2 \times 2$ 矩阵。指令类型：

1. 给定矩阵 $A$，插入队列头部。
2. 给定矩阵 $B$，插入队列尾部。
3. 若队列非空，删除队列中**最晚被插入**的矩阵。

共有 $m$ 个时刻，每个时刻发生以下事件之一：

1. 修改第 $i$ 条指令的内容。
2. 给定区间 $[l, r]$，求依次执行第 $l \sim r$ 条指令后，队列中所有矩阵从头到尾相乘的结果（对 998244353 取模）。若队列空，结果为单位矩阵。

### 输入格式

第一行 $n, m$。
接下来 $n$ 行，描述初始指令。格式：

* `1 A11 A12 A21 A22`: 头部插入矩阵 $A$。
* `2 B11 B12 B21 B22`: 尾部插入矩阵 $B$。
* `3`: 删除最晚插入的矩阵。
  接下来 $m$ 行，描述事件：
* `1 i ...`: 修改第 $i$ 条指令，格式同上。
* `2 l r`: 查询区间 $[l, r]$ 的结果。

### 输出格式

对于每个类型 2 的事件，输出一行四个整数，表示结果矩阵 $C_{1,1}, C_{1,2}, C_{2,1}, C_{2,2}$。

### 样例 1

**输入：**

```text
3 4
1 2 3 9 3
2 6 9 4 2
2 2 8 2 1
2 2 3
1 2 1 3 1 0 1
1 3 3
2 1 3
```

**输出：**

```text
30 57 12 34
2 3 9 3
```

### 子任务

* $1 \le n, m \le 10^5$。
* 部分数据限制了 $n, m$ 的大小或指令类型（如只有类型 1 或只有类型 2 查询）。

---

## 题目 5：彩色路径 (Colorful Path)

**时间限制：** 2.0 秒
**空间限制：** 512 MiB

### 题目描述

给定一个 $N$ 个节点 $M$ 条边的有向图。每个节点 $i$ 有颜色 $C[i] \in \{0, \dots, K-1\}$。每条边有长度 $D[j]$。
寻找一条从节点 0 到节点 $N-1$ 的**理想观光路线**，满足：

1. 简单路径。
2. **彩色路径**：路径上每个节点的颜色互不相同。
3. 节点数不超过 $L$。

求满足条件的最长路径长度。

### 输入格式

第一行 $N, M, L, K$。
第二行 $N$ 个整数 $C[0] \dots C[N-1]$。
第三行 $M$ 个整数 $U[0] \dots U[M-1]$（起点）。
第四行 $M$ 个整数 $V[0] \dots V[M-1]$（终点）。
第五行 $M$ 个整数 $D[0] \dots D[M-1]$（长度）。

### 输出格式

输出一个数，表示最大长度。

### 样例

**输入：**

```text
6 9 4 10
0 2 2 3 3 9
0 0 0 1 1 1 2 3 4
1 2 4 3 4 5 4 5 5
1 2 4 3 2 8 5 3 1
```

**输出：**

```text
9
```

### 子任务

* 20% 数据：颜色单调不降，边满足 $U < V$。
* 30% 数据：$K \le 15$。
* 全部数据：$2 \le N \le 100, 1 \le M \le 5000, 2 \le L \le 9 \le K \le 30$。
* $C[0]=0, C[N-1]=K-1$。对于中间节点 $1 \le C[i] \le K-2$。
* 边的两端颜色不同。边长 $\le 10^6$。
