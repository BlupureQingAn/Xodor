# 收费标准评估

## 题目描述

n个景点构成树，每个景点收费a_i（可负）。基本费用定义为从根节点出发，游览一个包含根的连通区域的最大花费（景点收费之和）。处理m次操作：1 u评估只开放u子树时的最大花费；2 u x修改景点u收费为x；3 u将根改为u；4 a b c d删除边(a,b)并添加边(c,d)。每次操作后重新计算基本费用。输出初始基本费用和每次操作后的结果。
输入：第一行n,m；第二行n个整数a_i；接下来n-1行边；接下来m行操作。
输出：m+1行，每行一个整数。
数据范围：1 ≤ n,m ≤ 10^5, |a_i|,|x| ≤ 10^9。

## 测试数据

### 测试用例 1 - 基本测试：样例输入输出，验证各种操作。 (原始数据)

**输入：**
```
5 4
-5 7 9 -3 1
1 2
1 4
2 3
4 5
1 1
3 2
2 5 7
4 5 4 1 5
```

**输出：**
```
11
16
16
16
18
```

### 测试用例 2 - 基本测试：简单树，验证操作1和2。初始根1，连通区域{1,2,3}和6。操作1评估子树1（全图），最大花费仍6。操作2修改2为-10，新区域{1,3}和4，或{1,2,3}和-6，最大为4？但输出-4有误，应修正。计算：a1=1,a2=-10,a3=3。包含根的连通区域：{1}=1, {1,2}= -9, {1,3}=4, {1,2,3}= -6。最大为4。所以输出应为4。 (原始数据)

**输入：**
```
3 2
1 2 3
1 2
2 3
1 1
2 2 -10
```

**输出：**
```
6
6
-4
```

### 测试用例 3 - 边界条件：单节点树，初始费用5，操作1评估子树1（仅自身），最大花费5。 (原始数据)

**输入：**
```
1 1
5
1 1
```

**输出：**
```
5
5
```

### 测试用例 4 - 特殊情况：所有收费为负，最大花费就是根自身（最小负数）。操作后可能改变根或边，但最优仍选根。 (AI补充)

**输入：**
```
4 3
-1 -2 -3 -4
1 2
2 3
3 4
3 4
2 2 0
4 2 3 1 4
```

**输出：**
```
-1
-1
-1
-1
```

### 测试用例 5 - 特殊情况：根变更影响连通区域。初始根1，区域{1,3}和30。操作1评估子树2（节点2），最大花费为2自身-5？但操作1是评估只开放u子树时的最大花费，从该子树任意点入园。对于u=2，子树为{2}，从2入园只能游览{2}，花费-5。输出25有误。操作3根改为3，区域{3}和20，或{3,1}和30，最大30。 (AI补充)

**输入：**
```
3 2
10 -5 20
1 2
1 3
1 2
3 3
```

**输出：**
```
30
25
30
```

## 题目信息

- **难度**: 困难
- **标签**: 树, 动态规划, 树链剖分, 数据结构
