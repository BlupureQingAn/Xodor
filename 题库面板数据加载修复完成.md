# é¢˜åº“é¢æ¿æ•°æ®åŠ è½½ä¿®å¤å®Œæˆ

## å®Œæˆæ—¶é—´
2024-12-05

## é—®é¢˜æè¿°
ç”¨æˆ·åé¦ˆé¢˜åº“é¢æ¿å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š
- é¢˜åº“é€‰æ‹©å™¨èƒ½åŠ è½½å‡ºé¢˜åº“åˆ—è¡¨
- ä½†æ˜¯ç»Ÿè®¡æ•°æ®å’Œé¢˜ç›®åˆ—è¡¨éƒ½æ²¡æœ‰åŠ è½½å‡ºé¢˜ç›®
- æ‰€æœ‰æ•°æ®æ˜¾ç¤ºä¸ºç©º

## é—®é¢˜æ ¹æºåˆ†æ

### åŸæœ‰æ¶æ„é—®é¢˜
```cpp
// PracticeWidget æ„é€ å‡½æ•°
PracticeWidget::PracticeWidget(QuestionBank *questionBank, QWidget *parent)
    : m_questionBank(questionBank)  // ä¾èµ–ä¼ å…¥çš„ QuestionBank
{
    // ...
}

// loadQuestions() æ–¹æ³•
void PracticeWidget::loadQuestions() {
    if (!m_questionBank) return;
    
    int count = m_questionBank->count();  // é—®é¢˜ï¼šm_questionBank å¯èƒ½æ˜¯ç©ºçš„
    QVector<Question> allQuestions = m_questionBank->allQuestions();
    // ...
}
```

**é—®é¢˜æ‰€åœ¨ï¼š**
1. `PracticeWidget` ä¾èµ– `MainWindow` ä¼ å…¥çš„ `m_questionBank`
2. `MainWindow` çš„ `m_questionBank` åªåœ¨æœ‰ä¼šè¯æ—¶æ‰åŠ è½½é¢˜ç›®
3. å¦‚æœæ²¡æœ‰ä¿å­˜çš„ä¼šè¯ï¼Œ`m_questionBank` å°±æ˜¯ç©ºçš„
4. `updateBankSelector()` ä» `QuestionBankManager` è·å–é¢˜åº“åˆ—è¡¨ï¼ˆæ­£å¸¸ï¼‰
5. ä½† `loadQuestions()` ä»ç©ºçš„ `m_questionBank` è·å–é¢˜ç›®ï¼ˆå¤±è´¥ï¼‰

### æ¶æ„ä¸ä¸€è‡´
- **é¢˜åº“åˆ—è¡¨æ¥æºï¼š** `QuestionBankManager`ï¼ˆå…¨å±€ç®¡ç†å™¨ï¼‰âœ…
- **é¢˜ç›®æ•°æ®æ¥æºï¼š** `MainWindow::m_questionBank`ï¼ˆå±€éƒ¨å¯¹è±¡ï¼‰âŒ

## è§£å†³æ–¹æ¡ˆ

### ç»Ÿä¸€æ•°æ®æº
å°† `PracticeWidget` çš„æ‰€æœ‰æ•°æ®è·å–ç»Ÿä¸€åˆ° `QuestionBankManager`ï¼š

```cpp
// ä¿®æ”¹å‰ï¼šä» m_questionBank è·å–
void PracticeWidget::loadQuestions() {
    if (!m_questionBank) return;
    QVector<Question> allQuestions = m_questionBank->allQuestions();
    // ...
}

// ä¿®æ”¹åï¼šä» QuestionBankManager è·å–
void PracticeWidget::loadQuestions() {
    QString currentBankId = QuestionBankManager::instance().getCurrentBankId();
    QuestionBankInfo bankInfo = QuestionBankManager::instance().getBankInfo(currentBankId);
    QVector<Question> allQuestions = loadQuestionsFromBank(bankInfo.path);
    // ...
}
```

## ä¿®æ”¹å†…å®¹

### 1. loadQuestions() æ–¹æ³•
**ä¿®æ”¹å‰ï¼š**
```cpp
if (!m_questionBank) return;
int count = m_questionBank->count();
QVector<Question> allQuestions = m_questionBank->allQuestions();
```

**ä¿®æ”¹åï¼š**
```cpp
QString currentBankId = QuestionBankManager::instance().getCurrentBankId();
QuestionBankInfo bankInfo = QuestionBankManager::instance().getBankInfo(currentBankId);
QVector<Question> allQuestions = loadQuestionsFromBank(bankInfo.path);
```

### 2. updateStatistics() æ–¹æ³•
**ä¿®æ”¹å‰ï¼š**
```cpp
if (!m_questionBank) return;
int total = m_questionBank->count();
for (int i = 0; i < m_questionBank->count(); ++i) {
    Question q = m_questionBank->allQuestions()[i];
    // ...
}
```

**ä¿®æ”¹åï¼š**
```cpp
QString currentBankId = QuestionBankManager::instance().getCurrentBankId();
QuestionBankInfo bankInfo = QuestionBankManager::instance().getBankInfo(currentBankId);
QVector<Question> allQuestions = loadQuestionsFromBank(bankInfo.path);
int total = allQuestions.size();
for (const Question &q : allQuestions) {
    // ...
}
```

### 3. refreshQuestionList() æ–¹æ³•
**ä¿®æ”¹å‰ï¼š**
```cpp
if (!m_questionBank) {
    qWarning() << "QuestionBank is null";
    return;
}
```

**ä¿®æ”¹åï¼š**
```cpp
qDebug() << "[PracticeWidget] refreshQuestionList() called";
// ç§»é™¤å¯¹ m_questionBank çš„æ£€æŸ¥
```

### 4. getRandomQuestion() æ–¹æ³•
**ä¿®æ”¹å‰ï¼š**
```cpp
if (!m_questionBank || m_questionBank->count() == 0) return Question();
QVector<Question> allQuestions = m_questionBank->allQuestions();
```

**ä¿®æ”¹åï¼š**
```cpp
QString currentBankId = QuestionBankManager::instance().getCurrentBankId();
QuestionBankInfo bankInfo = QuestionBankManager::instance().getBankInfo(currentBankId);
QVector<Question> allQuestions = loadQuestionsFromBank(bankInfo.path);
```

### 5. getRecommendedQuestion() æ–¹æ³•
**ä¿®æ”¹å‰ï¼š**
```cpp
if (!m_questionBank || m_questionBank->count() == 0) return Question();
QVector<Question> allQuestions = m_questionBank->allQuestions();
```

**ä¿®æ”¹åï¼š**
```cpp
QString currentBankId = QuestionBankManager::instance().getCurrentBankId();
QuestionBankInfo bankInfo = QuestionBankManager::instance().getBankInfo(currentBankId);
QVector<Question> allQuestions = loadQuestionsFromBank(bankInfo.path);
```

### 6. exportProgressReport() æ–¹æ³•
**ä¿®æ”¹å‰ï¼š**
```cpp
if (!m_questionBank || m_questionBank->count() == 0) return;
int total = m_questionBank->count();
QVector<Question> allQuestions = m_questionBank->allQuestions();
```

**ä¿®æ”¹åï¼š**
```cpp
QString currentBankId = QuestionBankManager::instance().getCurrentBankId();
QuestionBankInfo bankInfo = QuestionBankManager::instance().getBankInfo(currentBankId);
QVector<Question> allQuestions = loadQuestionsFromBank(bankInfo.path);
if (allQuestions.isEmpty()) return;
int total = allQuestions.size();
```

### 7. onQuestionDoubleClicked() æ–¹æ³•
**ä¿®æ”¹å‰ï¼š**
```cpp
QString questionId = item->data(Qt::UserRole).toString();
Question question = m_questionBank->getQuestion(questionId);
emit questionSelected(question);
```

**ä¿®æ”¹åï¼š**
```cpp
QString questionId = item->data(Qt::UserRole).toString();
QString currentBankId = QuestionBankManager::instance().getCurrentBankId();
QuestionBankInfo bankInfo = QuestionBankManager::instance().getBankInfo(currentBankId);
QVector<Question> allQuestions = loadQuestionsFromBank(bankInfo.path);
for (const Question &q : allQuestions) {
    if (q.id() == questionId) {
        emit questionSelected(q);
        break;
    }
}
```

### 8. onQuestionStatusUpdated() æ–¹æ³•
**ä¿®æ”¹å‰ï¼š**
```cpp
if (!m_questionBank) return;
for (int row = 0; row < m_questionTable->rowCount(); ++row) {
    QTableWidgetItem *idItem = m_questionTable->item(row, 0);
    if (idItem && idItem->text() == questionId) {
        QTableWidgetItem *statusItem = m_questionTable->item(row, 1);
        // ...
    }
}
```

**ä¿®æ”¹åï¼š**
```cpp
for (int row = 0; row < m_questionTable->rowCount(); ++row) {
    QTableWidgetItem *idItem = m_questionTable->item(row, 1);
    if (idItem && idItem->data(Qt::UserRole).toString() == questionId) {
        QTableWidgetItem *statusItem = m_questionTable->item(row, 0);
        // ...
    }
}
```

## ä¿®æ”¹çš„æ–‡ä»¶

### ä¸»è¦ä¿®æ”¹
**src/ui/PracticeWidget.cpp**
- ä¿®æ”¹ `loadQuestions()` - ä» QuestionBankManager è·å–é¢˜ç›®
- ä¿®æ”¹ `updateStatistics()` - ä» QuestionBankManager è·å–é¢˜ç›®
- ä¿®æ”¹ `refreshQuestionList()` - ç§»é™¤ m_questionBank æ£€æŸ¥
- ä¿®æ”¹ `getRandomQuestion()` - ä» QuestionBankManager è·å–é¢˜ç›®
- ä¿®æ”¹ `getRecommendedQuestion()` - ä» QuestionBankManager è·å–é¢˜ç›®
- ä¿®æ”¹ `exportProgressReport()` - ä» QuestionBankManager è·å–é¢˜ç›®
- ä¿®æ”¹ `onQuestionDoubleClicked()` - ä» QuestionBankManager æŸ¥æ‰¾é¢˜ç›®
- ä¿®æ”¹ `onQuestionStatusUpdated()` - ä¿®å¤åˆ—ç´¢å¼•é”™è¯¯

## æ•°æ®æµç¨‹

### ä¿®æ”¹å‰ï¼ˆæœ‰é—®é¢˜ï¼‰
```
QuestionBankManager â†’ é¢˜åº“åˆ—è¡¨ âœ…
MainWindow::m_questionBank â†’ é¢˜ç›®æ•°æ® âŒï¼ˆå¯èƒ½ä¸ºç©ºï¼‰
```

### ä¿®æ”¹åï¼ˆæ­£å¸¸ï¼‰
```
QuestionBankManager â†’ é¢˜åº“åˆ—è¡¨ âœ…
QuestionBankManager â†’ é¢˜ç›®æ•°æ® âœ…ï¼ˆç»Ÿä¸€æ•°æ®æºï¼‰
```

## å·¥ä½œæµç¨‹

### 1. åˆ‡æ¢åˆ°é¢˜åº“é¢æ¿
```
ç”¨æˆ·ç‚¹å‡» "ğŸ“Š é¢˜åº“åˆ—è¡¨"
  â†“
MainWindow::onSwitchToQuestionList()
  â†“
PracticeWidget::refreshQuestionList()
  â†“
updateBankSelector() â†’ ä» QuestionBankManager è·å–é¢˜åº“åˆ—è¡¨
loadQuestions() â†’ ä» QuestionBankManager è·å–å½“å‰é¢˜åº“çš„é¢˜ç›®
updateStatistics() â†’ ä» QuestionBankManager è·å–é¢˜ç›®å¹¶ç»Ÿè®¡
```

### 2. åŠ è½½é¢˜ç›®æ•°æ®
```
loadQuestions()
  â†“
QuestionBankManager::getCurrentBankId() â†’ è·å–å½“å‰é¢˜åº“ID
  â†“
QuestionBankManager::getBankInfo(bankId) â†’ è·å–é¢˜åº“ä¿¡æ¯
  â†“
loadQuestionsFromBank(bankInfo.path) â†’ ä»é¢˜åº“è·¯å¾„åŠ è½½æ‰€æœ‰é¢˜ç›®
  â†“
æ˜¾ç¤ºåˆ°è¡¨æ ¼ä¸­
```

### 3. æ›´æ–°ç»Ÿè®¡æ•°æ®
```
updateStatistics()
  â†“
ä» QuestionBankManager è·å–å½“å‰é¢˜åº“çš„æ‰€æœ‰é¢˜ç›®
  â†“
ç»Ÿè®¡æ€»æ•°ã€å®Œæˆæ•°ã€æŒæ¡æ•°ã€æ­£ç¡®ç‡
  â†“
æ›´æ–°ç»Ÿè®¡é¢æ¿ï¼ˆå¡ç‰‡ã€çƒ­åŠ›å›¾ã€éš¾åº¦åˆ†å¸ƒï¼‰
```

## ç¼–è¯‘ç»“æœ
âœ… ç¼–è¯‘æˆåŠŸï¼Œæ— é”™è¯¯
âœ… æ‰€æœ‰æ–¹æ³•å·²ç»Ÿä¸€ä½¿ç”¨ QuestionBankManager

## æµ‹è¯•æ­¥éª¤
1. å¯åŠ¨åº”ç”¨ç¨‹åº
2. ç‚¹å‡»å·¥å…·æ çš„ "ğŸ“Š é¢˜åº“åˆ—è¡¨" æŒ‰é’®
3. æ£€æŸ¥é¢˜åº“é€‰æ‹©å™¨æ˜¯å¦æ˜¾ç¤ºé¢˜åº“åˆ—è¡¨
4. æ£€æŸ¥ç»Ÿè®¡æ•°æ®æ˜¯å¦æ­£ç¡®æ˜¾ç¤ºï¼ˆæ€»å®Œæˆã€è¿ç»­å¤©æ•°ç­‰ï¼‰
5. æ£€æŸ¥é¢˜ç›®åˆ—è¡¨æ˜¯å¦æ˜¾ç¤ºé¢˜ç›®
6. å°è¯•åˆ‡æ¢é¢˜åº“ï¼Œæ£€æŸ¥æ•°æ®æ˜¯å¦æ›´æ–°
7. åŒå‡»é¢˜ç›®ï¼Œæ£€æŸ¥æ˜¯å¦èƒ½æ­£ç¡®åŠ è½½

## ä¼˜åŠ¿

### 1. ç»Ÿä¸€æ•°æ®æº
- æ‰€æœ‰æ•°æ®éƒ½ä» `QuestionBankManager` è·å–
- é¿å…äº†æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜

### 2. ç‹¬ç«‹æ€§
- `PracticeWidget` ä¸å†ä¾èµ– `MainWindow` çš„ `m_questionBank`
- å¯ä»¥ç‹¬ç«‹å·¥ä½œï¼Œä¸å—å…¶ä»–æ¨¡å—å½±å“

### 3. å®æ—¶æ€§
- æ¯æ¬¡åˆ·æ–°éƒ½ä»é¢˜åº“è·¯å¾„é‡æ–°åŠ è½½
- ç¡®ä¿æ•°æ®æ˜¯æœ€æ–°çš„

### 4. å¯é æ€§
- ä¸ä¼šå› ä¸º `m_questionBank` ä¸ºç©ºè€Œå¤±è´¥
- åªè¦ `QuestionBankManager` æœ‰é¢˜åº“ï¼Œå°±èƒ½æ­£å¸¸å·¥ä½œ

## æ€»ç»“
å·²å®Œæˆé¢˜åº“é¢æ¿æ•°æ®åŠ è½½çš„ä¿®å¤ï¼Œå°†æ‰€æœ‰æ•°æ®è·å–ç»Ÿä¸€åˆ° `QuestionBankManager`ï¼Œè§£å†³äº†å›  `MainWindow::m_questionBank` ä¸ºç©ºå¯¼è‡´çš„æ•°æ®åŠ è½½å¤±è´¥é—®é¢˜ã€‚ç°åœ¨é¢˜åº“é¢æ¿å¯ä»¥æ­£ç¡®æ˜¾ç¤ºé¢˜åº“åˆ—è¡¨ã€ç»Ÿè®¡æ•°æ®å’Œé¢˜ç›®åˆ—è¡¨ã€‚ç¼–è¯‘æˆåŠŸï¼Œå¯ä»¥æµ‹è¯•ä½¿ç”¨ã€‚
