# AI导师对话功能测试指南

## 测试目的
验证AI导师对话的保存、加载和恢复功能是否正常工作。

## 测试环境准备
1. 确保已导入题库
2. 确保AI服务已配置并可用
3. 清空测试数据（可选）：删除`data/conversations/`目录

## 测试用例

### 测试1：基本对话保存
**步骤**：
1. 选择题目A
2. 在AI导师面板发送消息："这道题怎么做？"
3. 等待AI回复完成
4. 切换到题目B
5. 再切回题目A

**预期结果**：
- ✅ 题目A的对话完整显示
- ✅ 用户消息和AI回复都保留
- ✅ 滚动位置在底部

### 测试2：快速切换（AI未回复）
**步骤**：
1. 选择题目A
2. 发送消息："帮我分析代码"
3. **立即**切换到题目B（不等AI回复）
4. 等待几秒
5. 切回题目A

**预期结果**：
- ✅ 用户消息已保存
- ✅ AI回复未保存（因为未完成）
- ✅ 可以继续对话

### 测试3：多题目对话
**步骤**：
1. 在题目A进行对话（至少2轮）
2. 切换到题目B，进行对话（至少2轮）
3. 切换到题目C，进行对话（至少2轮）
4. 依次切回题目A、B、C

**预期结果**：
- ✅ 每个题目的对话都独立保存
- ✅ 切换时不会混淆
- ✅ 所有对话内容完整

### 测试4：退出重启恢复
**步骤**：
1. 选择题目A
2. 进行对话（至少3轮）
3. 关闭程序
4. 重新启动程序

**预期结果**：
- ✅ 程序自动恢复到题目A
- ✅ 对话历史自动加载
- ✅ 所有消息完整显示
- ✅ 可以继续对话

### 测试5：新对话功能
**步骤**：
1. 选择题目A
2. 进行对话（至少2轮）
3. 点击"🆕 新对话"按钮
4. 确认清空
5. 点击"📜"历史记录按钮

**预期结果**：
- ✅ 当前对话被清空
- ✅ 历史记录中能找到之前的对话
- ✅ 可以从历史记录恢复对话

### 测试6：中文内容保存
**步骤**：
1. 选择任意题目
2. 发送包含中文的消息："请帮我分析这段代码的时间复杂度"
3. 等待AI回复（包含中文）
4. 切换题目后再切回
5. 关闭程序后重启

**预期结果**：
- ✅ 中文内容正确显示
- ✅ 没有乱码
- ✅ 重启后中文仍然正确

### 测试7：终止输出后的保存
**步骤**：
1. 选择任意题目
2. 发送消息触发AI回复
3. 在AI回复过程中点击"⏹ 终止"
4. 切换题目后再切回

**预期结果**：
- ✅ 用户消息已保存
- ✅ 已输出的AI内容保留
- ✅ 显示"输出已终止"标记

### 测试8：错误情况处理
**步骤**：
1. 选择任意题目
2. 断开AI服务（关闭Ollama或断网）
3. 发送消息
4. 等待错误提示
5. 切换题目后再切回

**预期结果**：
- ✅ 用户消息已保存
- ✅ 错误消息显示在对话中
- ✅ 切换后错误消息仍然显示

## 调试信息查看

在测试过程中，可以查看控制台输出的调试信息：

```
[AIAssistantPanel] Saved conversation to: data/conversations/xxx.json messages: 4
[AIAssistantPanel] Loading conversation history for question: xxx
[AIAssistantPanel] No conversation history found for question: xxx
```

## 文件验证

可以手动检查保存的文件：

**位置**：`data/conversations/{questionId}.json`

**格式示例**：
```json
{
  "questionId": "q001",
  "questionTitle": "两数之和",
  "questionCount": 0,
  "userLevel": "beginner",
  "messages": [
    {
      "role": "user",
      "content": "这道题怎么做？",
      "timestamp": "2024-12-06T10:30:00"
    },
    {
      "role": "assistant",
      "content": "让我来帮你分析...",
      "timestamp": "2024-12-06T10:30:15"
    }
  ]
}
```

## 常见问题排查

### 问题1：对话没有保存
**检查**：
- `data/conversations/`目录是否存在
- 是否有文件写入权限
- 查看控制台是否有错误日志

### 问题2：重启后对话没有恢复
**检查**：
- 是否正确恢复到同一题目
- `data/conversations/{questionId}.json`文件是否存在
- 文件内容是否正确

### 问题3：中文显示乱码
**检查**：
- JSON文件是否使用UTF-8编码
- 查看文件大小是否正常
- 尝试用文本编辑器打开JSON文件验证

## 测试通过标准

所有8个测试用例的预期结果都满足，即可认为功能正常。

## 报告问题

如果发现问题，请提供：
1. 具体的测试步骤
2. 预期结果 vs 实际结果
3. 控制台日志输出
4. 相关的JSON文件内容（如果有）
