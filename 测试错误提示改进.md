# 测试错误提示改进

## 问题描述
用户代码：
```cpp
#include <iostream>
using namespace std;
int main() {
    return 0;
}
```

之前的错误提示：
```
❌ 测试用例 1/6
❗ 失败原因：运行时错误
错误信息：程序启动失败
```

**问题**：
1. "程序启动失败"太模糊，不知道具体原因
2. 实际上程序正常运行了，只是没有输出
3. 用户不知道该如何修复

## 改进方案

### 1. 更详细的错误分类

#### 情况1: 程序没有输出
**之前**: "程序启动失败"
**现在**: 
```
❗ 失败原因：答案错误
错误信息：程序没有产生任何输出。请检查：
1. 是否读取了输入数据？
2. 是否输出了结果？
3. 输出格式是否正确？
```

#### 情况2: 输出不完整
**之前**: "程序启动失败"
**现在**:
```
❗ 失败原因：答案错误
错误信息：输出不完整。请检查：
1. 是否处理了所有输入数据？
2. 是否输出了所有结果？
```

#### 情况3: 输出过多
**之前**: "程序启动失败"
**现在**:
```
❗ 失败原因：答案错误
错误信息：输出过多。请检查：
1. 是否有多余的调试输出？
2. 输出格式是否正确？
```

#### 情况4: 输出格式错误
**之前**: "程序启动失败"
**现在**:
```
❗ 失败原因：答案错误
错误信息：输出不匹配。请检查：
1. 输出格式是否正确？
2. 计算逻辑是否正确？
3. 是否有多余的空格或换行？
```

#### 情况5: 真正的启动失败
**之前**: "程序启动失败"
**现在**:
```
❗ 失败原因：运行时错误
错误信息：程序启动失败：The process failed to start (找不到文件)
```

#### 情况6: 运行时崩溃
**之前**: "程序启动失败"
**现在**:
```
❗ 失败原因：运行时错误
错误信息：运行时错误（退出码 -1073741819）：程序异常退出
```
或者如果有stderr输出：
```
❗ 失败原因：运行时错误
错误信息：运行时错误（退出码 1）：Segmentation fault
```

### 2. 改进的错误处理逻辑

```cpp
// 1. 检查程序是否启动
if (!process.waitForStarted(1000)) {
    result.error = QString("程序启动失败：%1").arg(process.errorString());
    result.failureReason = TestFailureReason::RuntimeError;
}

// 2. 检查是否超时
else if (!finished) {
    result.error = "程序执行超时（超过5秒）";
    result.failureReason = TestFailureReason::TimeLimitExceeded;
}

// 3. 检查退出码
else if (process.exitCode() != 0) {
    if (!stderrOutput.isEmpty()) {
        result.error = QString("运行时错误（退出码 %1）：%2")
            .arg(process.exitCode())
            .arg(stderrOutput);
    } else {
        result.error = QString("运行时错误（退出码 %1）：程序异常退出")
            .arg(process.exitCode());
    }
    result.failureReason = TestFailureReason::RuntimeError;
}

// 4. 检查输出是否正确
else {
    if (result.actualOutput.isEmpty()) {
        result.error = "程序没有产生任何输出。请检查：\n"
                       "1. 是否读取了输入数据？\n"
                       "2. 是否输出了结果？\n"
                       "3. 输出格式是否正确？";
    } else if (result.actualOutput.length() < result.expectedOutput.length()) {
        result.error = "输出不完整。请检查：\n"
                       "1. 是否处理了所有输入数据？\n"
                       "2. 是否输出了所有结果？";
    } else if (result.actualOutput.length() > result.expectedOutput.length()) {
        result.error = "输出过多。请检查：\n"
                       "1. 是否有多余的调试输出？\n"
                       "2. 输出格式是否正确？";
    } else {
        result.error = "输出不匹配。请检查：\n"
                       "1. 输出格式是否正确？\n"
                       "2. 计算逻辑是否正确？\n"
                       "3. 是否有多余的空格或换行？";
    }
}
```

## 用户案例分析

### 案例：空main函数

**代码**:
```cpp
#include <iostream>
using namespace std;
int main() {
    return 0;
}
```

**测试输入**:
```
3 2
10 10
0 0
10 -20
1 -1
0 0
```

**期望输出**:
```
21 -11
20 -10
```

**实际输出**: (空)

**改进后的错误提示**:
```
❌ 测试用例 1/6 - 基本测试：样例输入

输入：3 2
10 10
0 0
10 -20
1 -1
0 0

期望输出：21 -11
20 -10

实际输出：

❗ 失败原因：答案错误

错误信息：程序没有产生任何输出。请检查：
1. 是否读取了输入数据？
2. 是否输出了结果？
3. 输出格式是否正确？

⏱️ 执行时间：0 ms
📋 原始测试数据
```

## 错误类型对照表

| 错误类型 | 退出码 | 输出情况 | 错误提示 |
|---------|--------|---------|---------|
| 程序未启动 | N/A | N/A | 程序启动失败：{系统错误信息} |
| 超时 | N/A | 部分输出 | 程序执行超时（超过5秒） |
| 崩溃 | 非0 | 可能有输出 | 运行时错误（退出码 X）：{stderr或"程序异常退出"} |
| 无输出 | 0 | 空 | 程序没有产生任何输出。请检查... |
| 输出不完整 | 0 | 长度<期望 | 输出不完整。请检查... |
| 输出过多 | 0 | 长度>期望 | 输出过多。请检查... |
| 输出不匹配 | 0 | 长度=期望 | 输出不匹配。请检查... |

## 常见退出码含义

| 退出码 | 含义 |
|-------|------|
| 0 | 正常退出 |
| 1 | 一般错误 |
| -1073741819 (0xC0000005) | 访问违规（Windows） |
| 139 | Segmentation fault（Linux） |
| 134 | SIGABRT（异常终止） |
| 136 | SIGFPE（浮点异常） |

## 测试建议

### 测试1: 空程序
```cpp
int main() { return 0; }
```
**预期**: "程序没有产生任何输出"

### 测试2: 只读取不输出
```cpp
int main() {
    int n;
    cin >> n;
    return 0;
}
```
**预期**: "程序没有产生任何输出"

### 测试3: 输出不完整
```cpp
int main() {
    cout << "21 -11" << endl;
    // 缺少第二行输出
    return 0;
}
```
**预期**: "输出不完整"

### 测试4: 输出过多
```cpp
int main() {
    cout << "Debug: start" << endl;  // 多余的调试输出
    cout << "21 -11" << endl;
    cout << "20 -10" << endl;
    return 0;
}
```
**预期**: "输出过多"

### 测试5: 数组越界
```cpp
int main() {
    int arr[5];
    arr[100] = 1;  // 越界访问
    return 0;
}
```
**预期**: "运行时错误（退出码 -1073741819）：程序异常退出"

### 测试6: 除零错误
```cpp
int main() {
    int x = 1 / 0;  // 除零
    return 0;
}
```
**预期**: "运行时错误（退出码 136）：Floating point exception"

## 用户体验改进

### 改进前
- ❌ 错误信息模糊："程序启动失败"
- ❌ 不知道具体原因
- ❌ 不知道如何修复

### 改进后
- ✅ 错误信息清晰："程序没有产生任何输出"
- ✅ 提供具体原因分析
- ✅ 给出修复建议（检查清单）
- ✅ 区分不同的错误类型

## 总结

✅ **更准确的错误分类** - 区分启动失败、崩溃、无输出等情况
✅ **更详细的错误信息** - 包含退出码、stderr输出
✅ **更实用的修复建议** - 提供检查清单
✅ **更好的用户体验** - 用户能快速定位问题

现在用户看到错误提示后，能立即知道：
1. 程序哪里出了问题
2. 为什么会出问题
3. 应该如何修复
