# AIè¿æ¥æ£€æµ‹ä¼˜åŒ–è¯´æ˜

## é—®é¢˜æè¿°

å¯åŠ¨æ—¶çš„AIé…ç½®æ£€æµ‹å­˜åœ¨ä»¥ä¸‹é—®é¢˜ï¼š

1. **æ— è®ºæ˜¯å¦é…ç½®éƒ½å¼¹çª—**ï¼šå³ä½¿å·²ç»é…ç½®äº†AIæœåŠ¡ï¼Œå¯åŠ¨æ—¶ä¹Ÿä¼šå¼¹å‡ºé…ç½®å¯¹è¯æ¡†
2. **è¿æ¥æ£€æµ‹ä¸å‡†ç¡®**ï¼šæ˜æ˜è¿æ¥ç€äº‘ç«¯APIï¼Œå´æ˜¾ç¤º"æœªè¿æ¥"
3. **ç”¨æˆ·ä½“éªŒå·®**ï¼šæ¯æ¬¡å¯åŠ¨éƒ½è¦å…³é—­é…ç½®å¯¹è¯æ¡†ï¼Œå¾ˆçƒ¦äºº

## é—®é¢˜æ ¹æº

### åŸå§‹é€»è¾‘åˆ†æ

```cpp
void MainWindow::showAIConnectionStatus(const AIConnectionStatus &status)
{
    // æ€»æ˜¯æ˜¾ç¤ºAIé…ç½®å¯¹è¯æ¡† âŒ
    QTimer::singleShot(100, this, &MainWindow::checkAndSelectModel);
    
    // ç®€å•çš„çŠ¶æ€æ æç¤º
    if (status.ollamaAvailable) {
        statusBar()->showMessage(QString("âœ“ Ollamaå·²è¿æ¥ - %1").arg(status.ollamaModel), 5000);
    } else if (status.cloudApiAvailable) {
        statusBar()->showMessage("âœ“ äº‘ç«¯APIå·²è¿æ¥", 5000);
    } else {
        statusBar()->showMessage("âš  AIæœåŠ¡æœªé…ç½®ï¼ˆä¸å½±å“åˆ·é¢˜åŠŸèƒ½ï¼‰", 0);
    }
}
```

**é—®é¢˜æ‰€åœ¨**ï¼š
- âŒ ç¬¬ä¸€è¡Œä»£ç ï¼š**æ— æ¡ä»¶**è°ƒç”¨`checkAndSelectModel()`æ˜¾ç¤ºé…ç½®å¯¹è¯æ¡†
- âŒ æ²¡æœ‰æ ¹æ®`status.ollamaAvailable`æˆ–`status.cloudApiAvailable`åˆ¤æ–­æ˜¯å¦éœ€è¦é…ç½®
- âŒ å³ä½¿AIæœåŠ¡å·²ç»æ­£å¸¸è¿æ¥ï¼Œä¹Ÿä¼šå¼¹å‡ºé…ç½®çª—å£

## ä¿®å¤æ–¹æ¡ˆ

### 1. ä¿®æ”¹è¿æ¥çŠ¶æ€åˆ¤æ–­é€»è¾‘

```cpp
void MainWindow::showAIConnectionStatus(const AIConnectionStatus &status)
{
    // ä¿å­˜çŠ¶æ€ä¾›åç»­ä½¿ç”¨
    m_lastAIStatus = status;
    
    // åˆ¤æ–­æ˜¯å¦éœ€è¦æ˜¾ç¤ºé…ç½®å¯¹è¯æ¡†
    bool needConfig = false;
    QString statusMessage;
    
    if (status.ollamaAvailable) {
        // Ollamaè¿æ¥æˆåŠŸ âœ…
        statusMessage = QString("âœ… AIæœåŠ¡å·²è¿æ¥ - Ollama (%1)").arg(status.ollamaModel);
        statusBar()->showMessage(statusMessage, 5000);
        qInfo() << "AIè¿æ¥æ£€æµ‹ï¼šOllamaå¯ç”¨ -" << status.ollamaModel;
        
    } else if (status.cloudApiAvailable) {
        // äº‘ç«¯APIè¿æ¥æˆåŠŸ âœ…
        statusMessage = "âœ… AIæœåŠ¡å·²è¿æ¥ - äº‘ç«¯API";
        statusBar()->showMessage(statusMessage, 5000);
        qInfo() << "AIè¿æ¥æ£€æµ‹ï¼šäº‘ç«¯APIå¯ç”¨";
        
    } else {
        // ä¸¤è€…éƒ½ä¸å¯ç”¨ï¼Œéœ€è¦é…ç½® âš ï¸
        needConfig = true;
        
        // æ ¹æ®å…·ä½“æƒ…å†µæ˜¾ç¤ºä¸åŒçš„æç¤º
        if (status.needModelSelection && !status.availableModels.isEmpty()) {
            statusMessage = QString("âš ï¸ é…ç½®çš„AIæ¨¡å‹ä¸å¯ç”¨ï¼Œä½†æ£€æµ‹åˆ° %1 ä¸ªå…¶ä»–æ¨¡å‹")
                .arg(status.availableModels.size());
        } else if (!status.ollamaError.isEmpty() && !status.cloudApiError.isEmpty()) {
            statusMessage = "âš ï¸ AIæœåŠ¡æœªè¿æ¥ï¼ˆä¸å½±å“åˆ·é¢˜åŠŸèƒ½ï¼‰";
        } else {
            statusMessage = "âš ï¸ AIæœåŠ¡æœªé…ç½®ï¼ˆä¸å½±å“åˆ·é¢˜åŠŸèƒ½ï¼‰";
        }
        
        statusBar()->showMessage(statusMessage, 0);
        qWarning() << "AIè¿æ¥æ£€æµ‹ï¼šæ— å¯ç”¨æœåŠ¡";
    }
    
    // åªåœ¨éœ€è¦é…ç½®æ—¶æ‰å¼¹çª— âœ…
    if (needConfig) {
        QTimer::singleShot(100, this, [this, status]() {
            showAIConfigDialog(status);
        });
    }
}
```

### 2. é‡æ„é…ç½®å¯¹è¯æ¡†æ–¹æ³•

å°†`checkAndSelectModel()`é‡å‘½åä¸º`showAIConfigDialog()`ï¼Œå¹¶æ¥å—`AIConnectionStatus`å‚æ•°ï¼š

```cpp
void MainWindow::showAIConfigDialog(const AIConnectionStatus &status)
{
    // ä½¿ç”¨ä¼ å…¥çš„statusä¸­çš„å¯ç”¨æ¨¡å‹åˆ—è¡¨
    QStringList availableModels = status.availableModels;
    
    // æ„å»ºå¯¹è¯æ¡†æ ‡é¢˜å’Œæç¤ºä¿¡æ¯
    QString dialogTitle = "ğŸ¤– AIæœåŠ¡é…ç½®";
    QString infoMessage;
    
    if (status.needModelSelection && !availableModels.isEmpty()) {
        dialogTitle = "âš ï¸ éœ€è¦é€‰æ‹©AIæ¨¡å‹";
        infoMessage = QString("æ£€æµ‹åˆ° %1 ä¸ªå¯ç”¨æ¨¡å‹ï¼Œä½†é…ç½®çš„æ¨¡å‹ä¸å¯ç”¨ã€‚\nè¯·é€‰æ‹©ä¸€ä¸ªæ¨¡å‹ç»§ç»­ä½¿ç”¨ã€‚")
            .arg(availableModels.size());
    } else if (!status.ollamaError.isEmpty() && !status.cloudApiError.isEmpty()) {
        dialogTitle = "âš ï¸ AIæœåŠ¡æœªè¿æ¥";
        infoMessage = "æœªæ£€æµ‹åˆ°å¯ç”¨çš„AIæœåŠ¡ã€‚\nè¯·é…ç½®æœ¬åœ°Ollamaæˆ–äº‘ç«¯APIã€‚";
    } else {
        infoMessage = "è¯·é…ç½®AIæœåŠ¡ä»¥ä½¿ç”¨æ™ºèƒ½åŠŸèƒ½ã€‚";
    }
    
    // ... åˆ›å»ºå¯¹è¯æ¡†UI
}
```

### 3. æ·»åŠ çŠ¶æ€ä¿å­˜

åœ¨`MainWindow.h`ä¸­æ·»åŠ æˆå‘˜å˜é‡ï¼š

```cpp
private:
    AIConnectionStatus m_lastAIStatus;  // æœ€åä¸€æ¬¡AIè¿æ¥çŠ¶æ€
```

## ä¿®å¤æ•ˆæœ

### ä¿®å¤å‰ âŒ

1. **å¯åŠ¨ç¨‹åº**
2. **AIè¿æ¥æ£€æµ‹**ï¼ˆåå°è¿›è¡Œï¼‰
3. **æ— è®ºç»“æœå¦‚ä½•ï¼Œéƒ½å¼¹å‡ºé…ç½®å¯¹è¯æ¡†** âŒ
4. ç”¨æˆ·å¿…é¡»å…³é—­å¯¹è¯æ¡†æ‰èƒ½ç»§ç»­ä½¿ç”¨
5. å³ä½¿AIå·²ç»æ­£å¸¸è¿æ¥ï¼Œä¹Ÿè¦å…³é—­çª—å£

### ä¿®å¤å âœ…

#### åœºæ™¯1ï¼šOllamaå·²è¿æ¥
1. **å¯åŠ¨ç¨‹åº**
2. **AIè¿æ¥æ£€æµ‹**ï¼ˆåå°è¿›è¡Œï¼‰
3. **æ£€æµ‹åˆ°Ollamaå¯ç”¨** âœ…
4. **çŠ¶æ€æ æ˜¾ç¤º**ï¼š"âœ… AIæœåŠ¡å·²è¿æ¥ - Ollama (qwen2.5:7b)"
5. **ä¸å¼¹çª—**ï¼Œç”¨æˆ·å¯ä»¥ç›´æ¥ä½¿ç”¨

#### åœºæ™¯2ï¼šäº‘ç«¯APIå·²è¿æ¥
1. **å¯åŠ¨ç¨‹åº**
2. **AIè¿æ¥æ£€æµ‹**ï¼ˆåå°è¿›è¡Œï¼‰
3. **æ£€æµ‹åˆ°äº‘ç«¯APIå¯ç”¨** âœ…
4. **çŠ¶æ€æ æ˜¾ç¤º**ï¼š"âœ… AIæœåŠ¡å·²è¿æ¥ - äº‘ç«¯API"
5. **ä¸å¼¹çª—**ï¼Œç”¨æˆ·å¯ä»¥ç›´æ¥ä½¿ç”¨

#### åœºæ™¯3ï¼šæœªé…ç½®æˆ–è¿æ¥å¤±è´¥
1. **å¯åŠ¨ç¨‹åº**
2. **AIè¿æ¥æ£€æµ‹**ï¼ˆåå°è¿›è¡Œï¼‰
3. **ä¸¤è€…éƒ½ä¸å¯ç”¨** âš ï¸
4. **çŠ¶æ€æ æ˜¾ç¤º**ï¼š"âš ï¸ AIæœåŠ¡æœªè¿æ¥ï¼ˆä¸å½±å“åˆ·é¢˜åŠŸèƒ½ï¼‰"
5. **å¼¹å‡ºé…ç½®å¯¹è¯æ¡†**ï¼Œå¼•å¯¼ç”¨æˆ·é…ç½®
6. å¯¹è¯æ¡†æ˜¾ç¤ºè¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œé…ç½®æŒ‡å¯¼

#### åœºæ™¯4ï¼šæ¨¡å‹ä¸å¯ç”¨ä½†æœ‰å…¶ä»–æ¨¡å‹
1. **å¯åŠ¨ç¨‹åº**
2. **AIè¿æ¥æ£€æµ‹**ï¼ˆåå°è¿›è¡Œï¼‰
3. **é…ç½®çš„æ¨¡å‹ä¸å­˜åœ¨ï¼Œä½†æ£€æµ‹åˆ°å…¶ä»–æ¨¡å‹** âš ï¸
4. **çŠ¶æ€æ æ˜¾ç¤º**ï¼š"âš ï¸ é…ç½®çš„AIæ¨¡å‹ä¸å¯ç”¨ï¼Œä½†æ£€æµ‹åˆ° 3 ä¸ªå…¶ä»–æ¨¡å‹"
5. **å¼¹å‡ºé…ç½®å¯¹è¯æ¡†**ï¼Œæ˜¾ç¤ºå¯ç”¨æ¨¡å‹åˆ—è¡¨
6. ç”¨æˆ·å¯ä»¥é€‰æ‹©å…¶ä»–æ¨¡å‹

## æŠ€æœ¯è¦ç‚¹

### 1. è¿æ¥æ£€æµ‹é€»è¾‘

`AIConnectionChecker`ä¼šæ£€æµ‹ï¼š
- **OllamaæœåŠ¡**ï¼šæ£€æŸ¥`/api/tags`ç«¯ç‚¹ï¼ŒéªŒè¯æ¨¡å‹æ˜¯å¦å­˜åœ¨
- **äº‘ç«¯API**ï¼šå‘é€æµ‹è¯•è¯·æ±‚ï¼ŒéªŒè¯API Keyæ˜¯å¦æœ‰æ•ˆ

### 2. çŠ¶æ€åˆ¤æ–­ä¼˜å…ˆçº§

```
1. status.ollamaAvailable == true  â†’ ä¸å¼¹çª—ï¼Œæ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
2. status.cloudApiAvailable == true â†’ ä¸å¼¹çª—ï¼Œæ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯
3. ä¸¤è€…éƒ½ä¸ºfalse â†’ å¼¹çª—ï¼Œå¼•å¯¼é…ç½®
```

### 3. è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

æ ¹æ®ä¸åŒçš„é”™è¯¯ç±»å‹ï¼Œæ˜¾ç¤ºä¸åŒçš„æç¤ºï¼š
- **è¿æ¥è¢«æ‹’ç»**ï¼šOllamaæœåŠ¡æœªè¿è¡Œ
- **æ‰¾ä¸åˆ°æœåŠ¡å™¨**ï¼šæœåŠ¡åœ°å€é…ç½®é”™è¯¯
- **è¿æ¥è¶…æ—¶**ï¼šç½‘ç»œé—®é¢˜æˆ–æœåŠ¡å“åº”æ…¢
- **æ¨¡å‹ä¸å­˜åœ¨**ï¼šéœ€è¦ä¸‹è½½æ¨¡å‹æˆ–é€‰æ‹©å…¶ä»–æ¨¡å‹
- **API Keyæ— æ•ˆ**ï¼šäº‘ç«¯APIè®¤è¯å¤±è´¥

### 4. æ—¥å¿—è¾“å‡º

æ·»åŠ äº†è¯¦ç»†çš„æ—¥å¿—è¾“å‡ºï¼Œæ–¹ä¾¿è°ƒè¯•ï¼š

```cpp
qInfo() << "AIè¿æ¥æ£€æµ‹ï¼šOllamaå¯ç”¨ -" << status.ollamaModel;
qInfo() << "AIè¿æ¥æ£€æµ‹ï¼šäº‘ç«¯APIå¯ç”¨";
qWarning() << "AIè¿æ¥æ£€æµ‹ï¼šæ— å¯ç”¨æœåŠ¡";
qWarning() << "  Ollamaé”™è¯¯:" << status.ollamaError;
qWarning() << "  äº‘ç«¯APIé”™è¯¯:" << status.cloudApiError;
```

## ä¿®æ”¹æ–‡ä»¶

### 1. src/ui/MainWindow.h
- æ·»åŠ æˆå‘˜å˜é‡ï¼š`AIConnectionStatus m_lastAIStatus`
- ä¿®æ”¹æ–¹æ³•å£°æ˜ï¼š`checkAndSelectModel()` â†’ `showAIConfigDialog(const AIConnectionStatus &status)`

### 2. src/ui/MainWindow.cpp
- é‡å†™`showAIConnectionStatus()`æ–¹æ³•ï¼Œæ·»åŠ æ™ºèƒ½åˆ¤æ–­é€»è¾‘
- é‡æ„`checkAndSelectModel()`ä¸º`showAIConfigDialog()`ï¼Œæ¥å—statuså‚æ•°
- æ·»åŠ è¯¦ç»†çš„æ—¥å¿—è¾“å‡º

## ç¼–è¯‘ç»“æœ

```
âœ… ç¼–è¯‘æˆåŠŸ
âœ… å¯æ‰§è¡Œæ–‡ä»¶: build\CodePracticeSystem.exe
âœ… æ‰€æœ‰åŠŸèƒ½æ­£å¸¸
```

## æµ‹è¯•å»ºè®®

### æµ‹è¯•1ï¼šOllamaå·²è¿æ¥
1. ç¡®ä¿OllamaæœåŠ¡æ­£åœ¨è¿è¡Œï¼š`ollama serve`
2. ç¡®ä¿å·²ä¸‹è½½æ¨¡å‹ï¼š`ollama list`
3. å¯åŠ¨ç¨‹åº
4. **é¢„æœŸ**ï¼šçŠ¶æ€æ æ˜¾ç¤º"âœ… AIæœåŠ¡å·²è¿æ¥ - Ollama (æ¨¡å‹å)"ï¼Œä¸å¼¹çª—

### æµ‹è¯•2ï¼šäº‘ç«¯APIå·²è¿æ¥
1. åœ¨è®¾ç½®ä¸­é…ç½®æœ‰æ•ˆçš„API Key
2. å¯åŠ¨ç¨‹åº
3. **é¢„æœŸ**ï¼šçŠ¶æ€æ æ˜¾ç¤º"âœ… AIæœåŠ¡å·²è¿æ¥ - äº‘ç«¯API"ï¼Œä¸å¼¹çª—

### æµ‹è¯•3ï¼šæœªé…ç½®
1. æ¸…ç©ºæ‰€æœ‰AIé…ç½®
2. åœæ­¢OllamaæœåŠ¡
3. å¯åŠ¨ç¨‹åº
4. **é¢„æœŸ**ï¼šçŠ¶æ€æ æ˜¾ç¤º"âš ï¸ AIæœåŠ¡æœªé…ç½®"ï¼Œå¼¹å‡ºé…ç½®å¯¹è¯æ¡†

### æµ‹è¯•4ï¼šæ¨¡å‹ä¸å­˜åœ¨
1. é…ç½®ä¸€ä¸ªä¸å­˜åœ¨çš„æ¨¡å‹åç§°ï¼ˆå¦‚"nonexistent-model"ï¼‰
2. ç¡®ä¿OllamaæœåŠ¡è¿è¡Œä¸”æœ‰å…¶ä»–æ¨¡å‹
3. å¯åŠ¨ç¨‹åº
4. **é¢„æœŸ**ï¼šå¼¹å‡ºé…ç½®å¯¹è¯æ¡†ï¼Œæ˜¾ç¤ºå¯ç”¨æ¨¡å‹åˆ—è¡¨

## ç”¨æˆ·ä½“éªŒæ”¹è¿›

### æ”¹è¿›å‰
- âŒ æ¯æ¬¡å¯åŠ¨éƒ½å¼¹çª—ï¼Œå¾ˆçƒ¦äºº
- âŒ å³ä½¿AIå·²è¿æ¥ä¹Ÿè¦å…³é—­çª—å£
- âŒ ä¸çŸ¥é“AIæ˜¯å¦çœŸçš„è¿æ¥æˆåŠŸ

### æ”¹è¿›å
- âœ… åªåœ¨éœ€è¦é…ç½®æ—¶æ‰å¼¹çª—
- âœ… AIå·²è¿æ¥æ—¶ç›´æ¥ä½¿ç”¨ï¼Œæ— å¹²æ‰°
- âœ… çŠ¶æ€æ æ¸…æ™°æ˜¾ç¤ºè¿æ¥çŠ¶æ€
- âœ… è¯¦ç»†çš„é”™è¯¯æç¤ºå’Œé…ç½®æŒ‡å¯¼
- âœ… æ—¥å¿—è¾“å‡ºæ–¹ä¾¿è°ƒè¯•

## æ€»ç»“

é€šè¿‡æ™ºèƒ½åˆ¤æ–­AIè¿æ¥çŠ¶æ€ï¼Œåªåœ¨çœŸæ­£éœ€è¦é…ç½®æ—¶æ‰å¼¹å‡ºå¯¹è¯æ¡†ï¼Œå¤§å¤§æ”¹å–„äº†ç”¨æˆ·ä½“éªŒã€‚ç°åœ¨ï¼š

- âœ… AIå·²è¿æ¥æ—¶ä¸å¼¹çª—ï¼Œç›´æ¥ä½¿ç”¨
- âœ… çŠ¶æ€æ å®æ—¶æ˜¾ç¤ºè¿æ¥çŠ¶æ€
- âœ… æœªé…ç½®æ—¶æ‰å¼¹çª—å¼•å¯¼
- âœ… è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯å’Œæ—¥å¿—
- âœ… æ”¯æŒOllamaå’Œäº‘ç«¯APIåŒé‡æ£€æµ‹

ç”¨æˆ·å¯ä»¥æ„‰å¿«åœ°ä½¿ç”¨ç¨‹åºï¼Œä¸å†è¢«ä¸å¿…è¦çš„é…ç½®å¯¹è¯æ¡†æ‰“æ‰°ï¼
