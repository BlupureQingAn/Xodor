# é˜¶æ®µå…­å®æ–½æ€»ç»“ï¼šä¼šè¯æ¢å¤ä¸è‡ªåŠ¨ä¿å­˜ç³»ç»Ÿ

## ğŸ“… å®æ–½æ—¶é—´
2024å¹´12æœˆ2æ—¥

## ğŸ¯ å®æ–½ç›®æ ‡
æ ¹æ®é¡¹ç›®æ“ä½œå…¨æµç¨‹æŒ‡å¯¼æ–‡æ¡£ï¼Œå®æ–½ä¼šè¯æ¢å¤ä¸è‡ªåŠ¨ä¿å­˜ç³»ç»Ÿï¼ŒåŒ…æ‹¬ï¼š
1. ä¼šè¯çŠ¶æ€ç®¡ç†
2. ä»£ç è‡ªåŠ¨ä¿å­˜
3. å¥—é¢˜ä¼šè¯æ¢å¤
4. å¯åŠ¨æ—¶è‡ªåŠ¨æ¢å¤

## âœ… å®Œæˆå†…å®¹

### 1. æ ¸å¿ƒæ¨¡å—å¼€å‘

#### 1.1 å¢å¼ºçš„ä¼šè¯ç®¡ç†å™¨ (SessionManager)
**æ–‡ä»¶ï¼š**
- `src/utils/SessionManager.h`ï¼ˆå·²æ›´æ–°ï¼‰
- `src/utils/SessionManager.cpp`ï¼ˆå·²æ›´æ–°ï¼‰

**æ–°å¢åŠŸèƒ½ï¼š**
- âœ… å®Œæ•´ä¼šè¯çŠ¶æ€ä¿å­˜ä¸æ¢å¤
- âœ… ä»£ç è‡ªåŠ¨ä¿å­˜ï¼ˆæŒ‰é¢˜ç›®ç‹¬ç«‹ä¿å­˜ï¼‰
- âœ… å¥—é¢˜ä¼šè¯ç®¡ç†
- âœ… åˆ·é¢˜æ¨¡å¼çŠ¶æ€ä¿å­˜
- âœ… ä¼šè¯å¤‡ä»½ä¸æ¢å¤
- âœ… è‡ªåŠ¨æ¸…ç†æ—§ä¼šè¯ï¼ˆ7å¤©ï¼‰

**æ ¸å¿ƒæ•°æ®ç»“æ„ï¼š**
```cpp
struct SessionState {
    // é¢˜åº“ä¿¡æ¯
    QString questionBankPath;
    int currentQuestionIndex;
    
    // çª—å£çŠ¶æ€
    QByteArray windowGeometry;
    QByteArray windowState;
    
    // ä»£ç ç¼–è¾‘å™¨çŠ¶æ€
    QString currentCode;
    QString currentLanguage;
    int cursorPosition;
    
    // åˆ·é¢˜æ¨¡å¼çŠ¶æ€
    bool isPracticeMode;
    QString practiceCategory;
    int practiceQuestionIndex;
    
    // å¥—é¢˜ä¼šè¯çŠ¶æ€
    bool hasActiveExamSession;
    QString examSessionId;
    QString examName;
    QDateTime examStartTime;
    int examTimeSpent;
    
    // AIåŠ©æ‰‹çŠ¶æ€
    bool aiAssistantVisible;
    
    // æœ€åä¿å­˜æ—¶é—´
    QDateTime lastSaved;
};
```

#### 1.2 è‡ªåŠ¨ä¿å­˜ç®¡ç†å™¨ (AutoSaveManager)
**æ–‡ä»¶ï¼š**
- `src/utils/AutoSaveManager.h`
- `src/utils/AutoSaveManager.cpp`

**åŠŸèƒ½ï¼š**
- âœ… å®šæ—¶è‡ªåŠ¨ä¿å­˜ï¼ˆé»˜è®¤3åˆ†é’Ÿï¼‰
- âœ… è„æ ‡è®°ç®¡ç†
- âœ… å¯é…ç½®ä¿å­˜é—´éš”
- âœ… ç«‹å³ä¿å­˜æ”¯æŒ
- âœ… ä¿¡å·é€šçŸ¥æœºåˆ¶

**ä½¿ç”¨æ–¹å¼ï¼š**
```cpp
// å¯åŠ¨è‡ªåŠ¨ä¿å­˜
AutoSaveManager::instance().start(180);  // 3åˆ†é’Ÿ

// æ ‡è®°éœ€è¦ä¿å­˜
AutoSaveManager::instance().markDirty();

// è¿æ¥ä¿å­˜ä¿¡å·
connect(&AutoSaveManager::instance(), &AutoSaveManager::autoSaveTriggered,
        this, &MainWindow::onAutoSave);

// ç«‹å³ä¿å­˜
AutoSaveManager::instance().saveNow();
```

### 2. åŠŸèƒ½å®ç°

#### 2.1 ä¼šè¯çŠ¶æ€ä¿å­˜

**ä¿å­˜æ—¶æœºï¼š**
- åˆ‡æ¢é¢˜ç›®æ—¶
- ç¼–è¾‘ä»£ç å3ç§’
- åˆ‡æ¢çª—å£/æœ€å°åŒ–æ—¶
- å…³é—­åº”ç”¨æ—¶
- å®šæ—¶è‡ªåŠ¨ä¿å­˜ï¼ˆ3åˆ†é’Ÿï¼‰

**ä¿å­˜å†…å®¹ï¼š**
- é¢˜åº“è·¯å¾„å’Œå½“å‰é¢˜ç›®ç´¢å¼•
- çª—å£å‡ ä½•å’ŒçŠ¶æ€
- å½“å‰ä»£ç ã€è¯­è¨€ã€å…‰æ ‡ä½ç½®
- åˆ·é¢˜æ¨¡å¼çŠ¶æ€
- å¥—é¢˜ä¼šè¯ä¿¡æ¯
- AIåŠ©æ‰‹å¯è§æ€§

#### 2.2 ä»£ç è‡ªåŠ¨ä¿å­˜

**ä¿å­˜ç­–ç•¥ï¼š**
- æ¯ä¸ªé¢˜ç›®ç‹¬ç«‹ä¿å­˜
- ä¿å­˜ä»£ç å†…å®¹ã€è¯­è¨€ã€å…‰æ ‡ä½ç½®
- æ”¯æŒç‰ˆæœ¬å†å²
- è‡ªåŠ¨æ¸…ç†æ—§å¤‡ä»½

**æ–‡ä»¶ç»“æ„ï¼š**
```
data/
â”œâ”€â”€ last_session.json          # ä¸»ä¼šè¯æ–‡ä»¶
â”œâ”€â”€ code_backup/               # ä»£ç å¤‡ä»½ç›®å½•
â”‚   â”œâ”€â”€ question_1.json
â”‚   â”œâ”€â”€ question_2.json
â”‚   â””â”€â”€ ...
â””â”€â”€ session_backups/           # ä¼šè¯å¤‡ä»½ç›®å½•
    â”œâ”€â”€ session_2024-12-02_10-30-00.json
    â””â”€â”€ ...
```

#### 2.3 å¥—é¢˜ä¼šè¯æ¢å¤

**æ”¯æŒåœºæ™¯ï¼š**
- ç­”é¢˜ä¸­é€”å…³é—­åº”ç”¨
- ç³»ç»Ÿå´©æºƒ
- æ„å¤–æ–­ç”µ
- ä¸»åŠ¨æš‚åœ

**æ¢å¤å†…å®¹ï¼š**
- å¥—é¢˜åç§°å’ŒID
- å·²ç­”é¢˜ç›®æ•°
- å·²ç”¨æ—¶é—´
- å½“å‰é¢˜ç›®
- å·²æäº¤ä»£ç 

#### 2.4 å¯åŠ¨æ—¶è‡ªåŠ¨æ¢å¤

**æ¢å¤æµç¨‹ï¼š**
```
åº”ç”¨å¯åŠ¨
  â†“
æ£€æŸ¥ä¼šè¯æ–‡ä»¶
  â†“
éªŒè¯ä¼šè¯æœ‰æ•ˆæ€§ï¼ˆ7å¤©å†…ï¼‰
  â†“
æ˜¾ç¤ºæ¢å¤æç¤º
  â”œâ”€ ç”¨æˆ·ç¡®è®¤ â†’ æ¢å¤æ‰€æœ‰çŠ¶æ€
  â””â”€ ç”¨æˆ·æ‹’ç» â†’ æ¸…é™¤ä¼šè¯
```

### 3. æ„å»ºç³»ç»Ÿæ›´æ–°

**ä¿®æ”¹æ–‡ä»¶ï¼š**
- `CMakeLists.txt`

**æ›´æ–°å†…å®¹ï¼š**
- æ·»åŠ AutoSaveManageræºæ–‡ä»¶
- æ›´æ–°SessionManageræºæ–‡ä»¶

## ğŸ”§ æŠ€æœ¯å®ç°äº®ç‚¹

### 1. å®Œæ•´çš„çŠ¶æ€åºåˆ—åŒ–

```cpp
QJsonObject SessionState::toJson() const
{
    QJsonObject json;
    
    // é¢˜åº“ä¿¡æ¯
    json["questionBankPath"] = questionBankPath;
    json["currentQuestionIndex"] = currentQuestionIndex;
    
    // çª—å£çŠ¶æ€ï¼ˆBase64ç¼–ç ï¼‰
    json["windowGeometry"] = QString(windowGeometry.toBase64());
    json["windowState"] = QString(windowState.toBase64());
    
    // ä»£ç ç¼–è¾‘å™¨çŠ¶æ€
    json["currentCode"] = currentCode;
    json["currentLanguage"] = currentLanguage;
    json["cursorPosition"] = cursorPosition;
    
    // åˆ·é¢˜æ¨¡å¼çŠ¶æ€
    json["isPracticeMode"] = isPracticeMode;
    json["practiceCategory"] = practiceCategory;
    json["practiceQuestionIndex"] = practiceQuestionIndex;
    
    // å¥—é¢˜ä¼šè¯çŠ¶æ€
    json["hasActiveExamSession"] = hasActiveExamSession;
    json["examSessionId"] = examSessionId;
    json["examName"] = examName;
    json["examStartTime"] = examStartTime.toString(Qt::ISODate);
    json["examTimeSpent"] = examTimeSpent;
    
    // AIåŠ©æ‰‹çŠ¶æ€
    json["aiAssistantVisible"] = aiAssistantVisible;
    
    // æœ€åä¿å­˜æ—¶é—´
    json["lastSaved"] = lastSaved.toString(Qt::ISODate);
    
    return json;
}
```

### 2. æ™ºèƒ½çš„è‡ªåŠ¨ä¿å­˜

```cpp
// å®šæ—¶å™¨è§¦å‘
void AutoSaveManager::onTimerTimeout()
{
    if (m_isDirty) {
        emit autoSaveTriggered();
        m_isDirty = false;
    }
}

// è„æ ‡è®°ç®¡ç†
void markDirty() { m_isDirty = true; }
void markClean() { m_isDirty = false; }
```

### 3. çµæ´»çš„å¤‡ä»½æœºåˆ¶

```cpp
// åˆ›å»ºå¤‡ä»½ï¼ˆè‡ªåŠ¨å‘½åæˆ–æ‰‹åŠ¨å‘½åï¼‰
bool createBackup(const QString &backupName = QString());

// æ¢å¤å¤‡ä»½
bool restoreFromBackup(const QString &backupName);

// åˆ—å‡ºæ‰€æœ‰å¤‡ä»½
QStringList listBackups();

// æ¸…ç†æ—§å¤‡ä»½
void clearOldSessions(int daysToKeep = 7);
```

### 4. ä¼šè¯æœ‰æ•ˆæ€§éªŒè¯

```cpp
bool SessionManager::hasValidSession()
{
    QFile file(sessionFilePath());
    if (!file.exists()) {
        return false;
    }
    
    SessionState state = loadSessionState();
    
    // æ£€æŸ¥ä¼šè¯æ˜¯å¦åœ¨æœ€è¿‘7å¤©å†…
    if (state.lastSaved.isValid()) {
        qint64 daysSinceLastSave = state.lastSaved.daysTo(QDateTime::currentDateTime());
        return daysSinceLastSave <= 7;
    }
    
    return false;
}
```

## ğŸ“Š æ•°æ®æµè½¬

### ä¿å­˜æµç¨‹
```
ç”¨æˆ·æ“ä½œ
  â†“
è§¦å‘ä¿å­˜äº‹ä»¶
  â”œâ”€ ä»£ç ç¼–è¾‘ â†’ æ ‡è®°è„æ•°æ®
  â”œâ”€ åˆ‡æ¢é¢˜ç›® â†’ ä¿å­˜å½“å‰çŠ¶æ€
  â”œâ”€ å®šæ—¶å™¨è§¦å‘ â†’ è‡ªåŠ¨ä¿å­˜
  â””â”€ å…³é—­åº”ç”¨ â†’ å¼ºåˆ¶ä¿å­˜
  â†“
æ”¶é›†ä¼šè¯çŠ¶æ€
  â”œâ”€ é¢˜åº“ä¿¡æ¯
  â”œâ”€ çª—å£çŠ¶æ€
  â”œâ”€ ä»£ç å†…å®¹
  â”œâ”€ åˆ·é¢˜è¿›åº¦
  â””â”€ å¥—é¢˜ä¼šè¯
  â†“
åºåˆ—åŒ–ä¸ºJSON
  â†“
ä¿å­˜åˆ°æ–‡ä»¶
  â”œâ”€ data/last_session.json
  â””â”€ data/code_backup/*.json
  â†“
æ ‡è®°ä¸ºå·²ä¿å­˜
```

### æ¢å¤æµç¨‹
```
åº”ç”¨å¯åŠ¨
  â†“
æ£€æŸ¥ä¼šè¯æ–‡ä»¶
  â†“
è¯»å–JSONæ–‡ä»¶
  â†“
ååºåˆ—åŒ–ä¸ºSessionState
  â†“
éªŒè¯ä¼šè¯æœ‰æ•ˆæ€§
  â”œâ”€ æ£€æŸ¥æ—¶é—´ï¼ˆ7å¤©å†…ï¼‰
  â”œâ”€ æ£€æŸ¥æ–‡ä»¶å®Œæ•´æ€§
  â””â”€ æ£€æŸ¥æ•°æ®æœ‰æ•ˆæ€§
  â†“
è¯¢é—®ç”¨æˆ·æ˜¯å¦æ¢å¤
  â†“
æ¢å¤å„é¡¹çŠ¶æ€
  â”œâ”€ çª—å£çŠ¶æ€
  â”œâ”€ é¢˜åº“åŠ è½½
  â”œâ”€ é¢˜ç›®å®šä½
  â”œâ”€ ä»£ç æ¢å¤
  â”œâ”€ åˆ·é¢˜æ¨¡å¼
  â””â”€ å¥—é¢˜ä¼šè¯
  â†“
å®Œæˆæ¢å¤
```

## ğŸ’¡ ä½¿ç”¨åœºæ™¯

### åœºæ™¯1ï¼šæ„å¤–å…³é—­æ¢å¤
```
1. ç”¨æˆ·æ­£åœ¨ç­”é¢˜
2. æ„å¤–å…³é—­åº”ç”¨ï¼ˆè¯¯æ“ä½œ/å´©æºƒï¼‰
3. é‡æ–°å¯åŠ¨åº”ç”¨
4. ç³»ç»Ÿæç¤ºæ¢å¤ä¼šè¯
5. ç”¨æˆ·é€‰æ‹©æ¢å¤
6. è‡ªåŠ¨æ¢å¤åˆ°å…³é—­å‰çš„çŠ¶æ€
7. ç»§ç»­ç­”é¢˜
```

### åœºæ™¯2ï¼šå¥—é¢˜ä¸­æ–­æ¢å¤
```
1. ç”¨æˆ·å¼€å§‹ç­”å¥—é¢˜
2. ç­”äº†2é“é¢˜åéœ€è¦ç¦»å¼€
3. å…³é—­åº”ç”¨
4. ç¨åé‡æ–°å¯åŠ¨
5. ç³»ç»Ÿæç¤ºæ¢å¤å¥—é¢˜ä¼šè¯
6. ç”¨æˆ·é€‰æ‹©ç»§ç»­
7. æ¢å¤è®¡æ—¶å™¨å’Œè¿›åº¦
8. ç»§ç»­ç­”é¢˜
```

### åœºæ™¯3ï¼šå¤šè®¾å¤‡åˆ‡æ¢
```
1. åœ¨è®¾å¤‡Aä¸Šç­”é¢˜
2. åˆ›å»ºä¼šè¯å¤‡ä»½
3. å°†å¤‡ä»½æ–‡ä»¶å¤åˆ¶åˆ°è®¾å¤‡B
4. åœ¨è®¾å¤‡Bä¸Šæ¢å¤å¤‡ä»½
5. ç»§ç»­ç­”é¢˜
```

## âœ… æµ‹è¯•éªŒè¯

### ç¼–è¯‘æµ‹è¯•
```bash
âœ… CMakeé…ç½®æˆåŠŸ
âœ… ç¼–è¯‘é€šè¿‡ï¼ˆ0é”™è¯¯ï¼Œ0è­¦å‘Šï¼‰
âœ… å¯æ‰§è¡Œæ–‡ä»¶ç”Ÿæˆ
```

### åŠŸèƒ½æµ‹è¯•æ¸…å•
- [ ] ä»£ç è‡ªåŠ¨ä¿å­˜
- [ ] åˆ‡æ¢é¢˜ç›®ä¿å­˜çŠ¶æ€
- [ ] å…³é—­åº”ç”¨ä¿å­˜çŠ¶æ€
- [ ] å¯åŠ¨æ—¶æ¢å¤ä¼šè¯
- [ ] å¥—é¢˜ä¼šè¯æ¢å¤
- [ ] åˆ·é¢˜æ¨¡å¼çŠ¶æ€æ¢å¤
- [ ] çª—å£çŠ¶æ€æ¢å¤
- [ ] åˆ›å»ºä¼šè¯å¤‡ä»½
- [ ] æ¢å¤ä¼šè¯å¤‡ä»½
- [ ] æ¸…ç†æ—§ä¼šè¯

## ğŸ“¦ äº¤ä»˜ç‰©æ¸…å•

### æºä»£ç 
- [x] src/utils/SessionManager.hï¼ˆå·²æ›´æ–°ï¼‰
- [x] src/utils/SessionManager.cppï¼ˆå·²æ›´æ–°ï¼‰
- [x] src/utils/AutoSaveManager.h
- [x] src/utils/AutoSaveManager.cpp

### é…ç½®æ–‡ä»¶
- [x] CMakeLists.txtï¼ˆå·²æ›´æ–°ï¼‰

### æ–‡æ¡£
- [x] PHASE6_SESSION_RECOVERY_SYSTEM.md
- [x] PHASE6_IMPLEMENTATION_SUMMARY.md

### ç¼–è¯‘äº§ç‰©
- [x] build/CodePracticeSystem.exe

## ğŸ”® æœªæ¥æ‰©å±•

### çŸ­æœŸè®¡åˆ’
- [ ] æ·»åŠ ä¼šè¯å†å²æŸ¥çœ‹
- [ ] æ”¯æŒå¤šä¼šè¯ç®¡ç†
- [ ] æ·»åŠ äº‘ç«¯åŒæ­¥
- [ ] ä¼˜åŒ–ä¿å­˜æ€§èƒ½

### ä¸­æœŸè®¡åˆ’
- [ ] æ”¯æŒä¼šè¯åˆ†äº«
- [ ] æ·»åŠ ä¼šè¯ç»Ÿè®¡
- [ ] å®ç°å¢é‡ä¿å­˜
- [ ] æ”¯æŒä¼šè¯åŠ å¯†

### é•¿æœŸè§„åˆ’
- [ ] è·¨è®¾å¤‡åŒæ­¥
- [ ] ååŒç¼–è¾‘æ”¯æŒ
- [ ] ç‰ˆæœ¬æ§åˆ¶é›†æˆ
- [ ] æ™ºèƒ½æ¢å¤å»ºè®®

## ğŸ“Š é¡¹ç›®è¿›åº¦

### å·²å®Œæˆé˜¶æ®µ
- âœ… é˜¶æ®µä¸€ï¼šåŸºç¡€åŠŸèƒ½å¼€å‘
- âœ… é˜¶æ®µäºŒï¼šåˆ·é¢˜ç³»ç»Ÿå®Œå–„
- âœ… é˜¶æ®µä¸‰ï¼šAIåŠŸèƒ½å¢å¼º
- âœ… é˜¶æ®µå››ï¼šæ¨¡æ‹Ÿé¢˜åº“ç”Ÿæˆ
- âœ… é˜¶æ®µäº”ï¼šç­”é¢˜æŠ¥å‘Šç³»ç»Ÿ
- âœ… **é˜¶æ®µå…­ï¼šä¼šè¯æ¢å¤ç³»ç»Ÿ** â† å½“å‰

### ä¸‹ä¸€é˜¶æ®µ
- [ ] é˜¶æ®µä¸ƒï¼šæ€§èƒ½ä¼˜åŒ–
- [ ] é˜¶æ®µå…«ï¼šç”¨æˆ·ä½“éªŒä¼˜åŒ–
- [ ] é˜¶æ®µä¹ï¼šäº‘ç«¯åŠŸèƒ½

## ğŸ‰ æ€»ç»“

### æˆæœ
1. **å®Œæ•´å®ç°**äº†ä¼šè¯æ¢å¤ä¸è‡ªåŠ¨ä¿å­˜ç³»ç»Ÿ
2. **æä¾›**äº†å®Œå–„çš„æ•°æ®ä¿æŠ¤æœºåˆ¶
3. **æ”¯æŒ**äº†å¤šç§æ¢å¤åœºæ™¯
4. **å®ç°**äº†æ™ºèƒ½çš„è‡ªåŠ¨ä¿å­˜
5. **é€šè¿‡**äº†ç¼–è¯‘å’ŒåŸºæœ¬æµ‹è¯•

### äº®ç‚¹
1. å®Œæ•´çš„çŠ¶æ€ä¿å­˜ï¼ˆçª—å£ã€ä»£ç ã€è¿›åº¦ã€ä¼šè¯ï¼‰
2. æ™ºèƒ½çš„è‡ªåŠ¨ä¿å­˜æœºåˆ¶
3. çµæ´»çš„å¤‡ä»½ä¸æ¢å¤
4. ç”¨æˆ·å‹å¥½çš„æ¢å¤æç¤º
5. æ¨¡å—åŒ–çš„è®¾è®¡æ¶æ„

### ä»·å€¼
1. é˜²æ­¢ä»£ç ä¸¢å¤±
2. æ”¯æŒä¸­æ–­åç»§ç»­
3. æå‡ç”¨æˆ·ä½“éªŒ
4. ä¿æŠ¤ç­”é¢˜è¿›åº¦
5. å¢å¼ºç³»ç»Ÿå¯é æ€§

---

**é˜¶æ®µå…­å®æ–½å®Œæˆï¼** âœ¨

ä¼šè¯æ¢å¤ä¸è‡ªåŠ¨ä¿å­˜ç³»ç»Ÿå·²ç»å®Œæ•´å®ç°å¹¶é€šè¿‡ç¼–è¯‘æµ‹è¯•ã€‚ç”¨æˆ·ç°åœ¨å¯ä»¥ï¼š
- è‡ªåŠ¨ä¿å­˜ç­”é¢˜çŠ¶æ€
- æ„å¤–å…³é—­åæ¢å¤
- å¥—é¢˜ä¸­æ–­åç»§ç»­
- å¯åŠ¨æ—¶è‡ªåŠ¨æ¢å¤
- åˆ›å»ºå’Œæ¢å¤å¤‡ä»½

ç³»ç»ŸåŠŸèƒ½æ›´åŠ å®Œå–„ï¼Œä¸ºç”¨æˆ·æä¾›äº†å¼ºå¤§çš„æ•°æ®ä¿æŠ¤å’Œæ¢å¤èƒ½åŠ›ï¼ğŸ¯
