# é¢˜åº“ç®¡ç†æ¨¡å—ç»Ÿä¸€ä¿®å¤æ–¹æ¡ˆ

## è¯Šæ–­ç»“æœ

ç»è¿‡å…¨é¢æ£€æŸ¥ï¼Œå‘ç°ä»¥ä¸‹é—®é¢˜ï¼š

### âœ… å·²ç¡®è®¤çš„é—®é¢˜

1. **QuestionListWidget.cpp æ˜¯å­¤ç«‹æ–‡ä»¶**
   - æ²¡æœ‰å¯¹åº”çš„ .h å¤´æ–‡ä»¶
   - æ²¡æœ‰åœ¨ CMakeLists.txt ä¸­ç¼–è¯‘
   - æ²¡æœ‰è¢«ä»»ä½•ä»£ç å¼•ç”¨
   - **ç»“è®º**ï¼šè¿™æ˜¯ä¸€ä¸ªåºŸå¼ƒçš„æ–‡ä»¶ï¼Œåº”è¯¥åˆ é™¤

2. **QuestionBankPanel å­˜åœ¨åŒæ¨¡å¼è®¾è®¡**
   - é¢˜ç›®åˆ—è¡¨æ¨¡å¼ï¼ˆæ­£å¸¸ä½¿ç”¨ï¼‰
   - é¢˜åº“åˆ—è¡¨æ¨¡å¼ï¼ˆä¸ QuestionBankManagerDialog åŠŸèƒ½é‡å¤ï¼‰
   - **é—®é¢˜**ï¼šèŒè´£ä¸æ¸…ï¼Œå¢åŠ å¤æ‚åº¦

3. **é¢˜åº“ç®¡ç†é€»è¾‘åˆ†æ•£**
   - QuestionBankManagerDialogï¼šä½¿ç”¨ QuestionBankManagerï¼ˆæ­£ç¡®ï¼‰
   - QuestionBankPanel é¢˜åº“æ¨¡å¼ï¼šç›´æ¥æ‰«ææ–‡ä»¶ç³»ç»Ÿï¼ˆä¸æ­£ç¡®ï¼‰
   - **é—®é¢˜**ï¼šæ•°æ®æºä¸ç»Ÿä¸€

4. **è·¯å¾„é—®é¢˜å·²ä¿®å¤**
   - âœ… QuestionBankManager è·¯å¾„è§„èŒƒåŒ–
   - âœ… è‡ªåŠ¨è·¯å¾„éªŒè¯å’Œä¿®å¤
   - âœ… é¢˜åº“è¯¦æƒ…æ˜¾ç¤ºç»å¯¹è·¯å¾„

---

## ä¿®å¤æ–¹æ¡ˆ

### æ–¹æ¡ˆæ¦‚è¿°

**ç›®æ ‡**ï¼šå»ºç«‹æ¸…æ™°çš„èŒè´£åˆ†å·¥ï¼Œç»Ÿä¸€æ•°æ®æºï¼Œç®€åŒ–æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   QuestionBankManager (æ ¸å¿ƒæ•°æ®æº)      â”‚
â”‚   - é¢˜åº“æ³¨å†Œå’Œç®¡ç†                       â”‚
â”‚   - è·¯å¾„è§„èŒƒåŒ–                           â”‚
â”‚   - å…ƒæ•°æ®æŒä¹…åŒ–                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  QuestionBankManagerDialog (å”¯ä¸€ç®¡ç†å…¥å£) â”‚
â”‚  - æŸ¥çœ‹æ‰€æœ‰é¢˜åº“                           â”‚
â”‚  - åˆ‡æ¢é¢˜åº“                               â”‚
â”‚  - åˆ é™¤/é‡å‘½åé¢˜åº“                        â”‚
â”‚  - æŸ¥çœ‹è¯¦æƒ…å’Œç»Ÿè®¡                         â”‚
â”‚  - å¯¼å…¥æ–°é¢˜åº“                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         MainWindow (åè°ƒå±‚)               â”‚
â”‚  - æ¥æ”¶é¢˜åº“åˆ‡æ¢ä¿¡å·                       â”‚
â”‚  - åŠ è½½é¢˜åº“åˆ° QuestionBank               â”‚
â”‚  - æ›´æ–°æ‰€æœ‰UIç»„ä»¶                         â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚                   â”‚
       â†“                   â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚QuestionBank  â”‚    â”‚  PracticeWidget â”‚
â”‚Panel         â”‚    â”‚  (åˆ·é¢˜ç•Œé¢)      â”‚
â”‚(é¢˜ç›®åˆ—è¡¨)     â”‚    â”‚  - é¢˜ç›®è¡¨æ ¼      â”‚
â”‚- æ˜¾ç¤ºé¢˜ç›®     â”‚    â”‚  - ç­›é€‰æ’åº      â”‚
â”‚- æœç´¢ç­›é€‰     â”‚    â”‚  - ç»Ÿè®¡ä¿¡æ¯      â”‚
â”‚- çŠ¶æ€æ˜¾ç¤º     â”‚    â”‚  - æ¨èé¢˜ç›®      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## å…·ä½“ä¿®å¤æ­¥éª¤

### ç¬¬ä¸€æ­¥ï¼šåˆ é™¤å­¤ç«‹æ–‡ä»¶ âœ…

**æ“ä½œ**ï¼šåˆ é™¤ `src/ui/QuestionListWidget.cpp`

**åŸå› **ï¼š
- æ²¡æœ‰å¤´æ–‡ä»¶
- æ²¡æœ‰è¢«ç¼–è¯‘
- æ²¡æœ‰è¢«ä½¿ç”¨
- åŠŸèƒ½ä¸ QuestionBankPanel é‡å¤

**å‘½ä»¤**ï¼š
```bash
rm src/ui/QuestionListWidget.cpp
```

---

### ç¬¬äºŒæ­¥ï¼šç®€åŒ– QuestionBankPanel

**ç›®æ ‡**ï¼šç§»é™¤é¢˜åº“åˆ—è¡¨æ¨¡å¼ï¼Œä¸“æ³¨äºé¢˜ç›®åˆ—è¡¨åŠŸèƒ½

#### 2.1 ä¿®æ”¹ QuestionBankPanel.h

**åˆ é™¤**ï¼š
```cpp
// æ˜¾ç¤ºæ¨¡å¼
enum class PanelMode {
    Questions,      // é¢˜ç›®åˆ—è¡¨æ¨¡å¼
    QuestionBanks   // é¢˜åº“åˆ—è¡¨æ¨¡å¼  â† åˆ é™¤è¿™ä¸ª
};

// é¢˜åº“é¢æ¿æ¨¡å¼  â† åˆ é™¤è¿™äº›å‡½æ•°
void setMode(PanelMode mode);
void refreshBankList();
QString getSelectedBankPath() const { return m_selectedBankPath; }

signals:
void bankSelected(const QString &bankPath);  â† åˆ é™¤
void bankLoadRequested(const QString &bankPath);  â† åˆ é™¤

private slots:
void onLoadBank();  â† åˆ é™¤
void onDeleteBank();  â† åˆ é™¤
void onRenameBank();  â† åˆ é™¤

private:
void updateBankList();  â† åˆ é™¤
QString getBankInfo(const QString &bankPath) const;  â† åˆ é™¤

PanelMode m_mode;  â† åˆ é™¤
QPushButton *m_loadBankBtn;  â† åˆ é™¤
QPushButton *m_deleteBankBtn;  â† åˆ é™¤
QPushButton *m_renameBankBtn;  â† åˆ é™¤
QString m_selectedBankPath;  â† åˆ é™¤
```

**ä¿ç•™**ï¼š
```cpp
class QuestionBankPanel : public QWidget
{
    Q_OBJECT
public:
    explicit QuestionBankPanel(QWidget *parent = nullptr);
    
    // é¢˜ç›®åˆ—è¡¨åŠŸèƒ½
    void setQuestions(const QVector<Question> &questions);
    void setCurrentQuestion(int index);
    QVector<int> getSelectedIndices() const;
    
public slots:
    void updateQuestionStatus(const QString &questionId);

signals:
    void questionSelected(int index);
    void questionsDeleteRequested(const QVector<int> &indices);
    
private slots:
    void onSearchTextChanged(const QString &text);
    void onDifficultyFilterChanged(int index);
    void onQuestionItemClicked(QListWidgetItem *item);
    void onDeleteSelected();
    void onSelectAll();
    
protected:
    void keyPressEvent(QKeyEvent *event) override;
    void contextMenuEvent(QContextMenuEvent *event) override;
    
private:
    void setupUI();
    void updateQuestionList();
    void filterQuestions();
    QString getQuestionStatusIcon(const QString &questionId) const;
    
    QLineEdit *m_searchEdit;
    QComboBox *m_difficultyFilter;
    QListWidget *m_questionList;
    
    QVector<Question> m_allQuestions;
    QVector<int> m_filteredIndices;
};
```

#### 2.2 ä¿®æ”¹ QuestionBankPanel.cpp

**åˆ é™¤æ‰€æœ‰é¢˜åº“ç›¸å…³çš„ä»£ç **ï¼š
- `setMode()` å‡½æ•°
- `refreshBankList()` å‡½æ•°
- `updateBankList()` å‡½æ•°
- `getBankInfo()` å‡½æ•°
- `onLoadBank()` å‡½æ•°
- `onDeleteBank()` å‡½æ•°
- `onRenameBank()` å‡½æ•°
- é¢˜åº“æŒ‰é’®çš„åˆ›å»ºå’Œè¿æ¥

**ç®€åŒ– setupUI()**ï¼š
```cpp
void QuestionBankPanel::setupUI()
{
    QVBoxLayout *layout = new QVBoxLayout(this);
    
    // æœç´¢æ¡†
    m_searchEdit = new QLineEdit(this);
    m_searchEdit->setPlaceholderText("æœç´¢é¢˜ç›®...");
    
    // éš¾åº¦ç­›é€‰
    m_difficultyFilter = new QComboBox(this);
    m_difficultyFilter->addItem("å…¨éƒ¨éš¾åº¦", -1);
    m_difficultyFilter->addItem("ç®€å•", static_cast<int>(Difficulty::Easy));
    m_difficultyFilter->addItem("ä¸­ç­‰", static_cast<int>(Difficulty::Medium));
    m_difficultyFilter->addItem("å›°éš¾", static_cast<int>(Difficulty::Hard));
    
    // é¢˜ç›®åˆ—è¡¨
    m_questionList = new QListWidget(this);
    // ... æ ·å¼è®¾ç½®
    
    layout->addWidget(new QLabel("æœç´¢:", this));
    layout->addWidget(m_searchEdit);
    layout->addWidget(new QLabel("éš¾åº¦:", this));
    layout->addWidget(m_difficultyFilter);
    layout->addWidget(m_questionList);
    
    // è¿æ¥ä¿¡å·
    connect(m_searchEdit, &QLineEdit::textChanged,
            this, &QuestionBankPanel::onSearchTextChanged);
    connect(m_difficultyFilter, QOverload<int>::of(&QComboBox::currentIndexChanged),
            this, &QuestionBankPanel::onDifficultyFilterChanged);
    connect(m_questionList, &QListWidget::itemClicked,
            this, &QuestionBankPanel::onQuestionItemClicked);
    connect(&ProgressManager::instance(), &ProgressManager::progressUpdated,
            this, &QuestionBankPanel::updateQuestionStatus);
}
```

---

### ç¬¬ä¸‰æ­¥ï¼šç¡®ä¿ QuestionBankManagerDialog åŠŸèƒ½å®Œæ•´

**å·²å®Œæˆ**ï¼š
- âœ… è·¯å¾„è§„èŒƒåŒ–
- âœ… è‡ªåŠ¨è·¯å¾„ä¿®å¤
- âœ… é¢˜åº“è¯¦æƒ…æ˜¾ç¤º
- âœ… åˆ‡æ¢ã€åˆ é™¤ã€é‡å‘½ååŠŸèƒ½
- âœ… ä½¿ç”¨ QuestionBankManager ä½œä¸ºæ•°æ®æº

**æ— éœ€ä¿®æ”¹**

---

### ç¬¬å››æ­¥ï¼šæ›´æ–° PracticeWidget

**ç›®æ ‡**ï¼šç§»é™¤é¢˜åº“ç®¡ç†åŠŸèƒ½ï¼Œåªä¿ç•™é¢˜åº“é€‰æ‹©å™¨

#### 4.1 ä¿®æ”¹é¢˜åº“é€‰æ‹©å™¨è¡Œä¸º

```cpp
// åœ¨ setupUI() ä¸­
m_bankSelector = new QComboBox(this);
m_bankSelector->setEnabled(false);  // è®¾ä¸ºåªè¯»
m_bankSelector->setToolTip("å½“å‰é¢˜åº“ï¼ˆç‚¹å‡»åˆ‡æ¢æŒ‰é’®ç®¡ç†é¢˜åº“ï¼‰");

// æ·»åŠ åˆ‡æ¢æŒ‰é’®
QPushButton *switchBankBtn = new QPushButton("ğŸ“š ç®¡ç†é¢˜åº“", this);
connect(switchBankBtn, &QPushButton::clicked, this, &PracticeWidget::onSwitchBankClicked);
```

#### 4.2 ä¿®æ”¹åˆ‡æ¢é€»è¾‘

```cpp
void PracticeWidget::onSwitchBankClicked()
{
    // å‘å‡ºä¿¡å·ï¼Œè®© MainWindow æ‰“å¼€ QuestionBankManagerDialog
    emit switchBankRequested();
}
```

---

### ç¬¬äº”æ­¥ï¼šæ›´æ–° MainWindow

**å·²å®Œæˆ**ï¼š
- âœ… QuestionBankManagerDialog çš„ä¿¡å·è¿æ¥
- âœ… é¢˜åº“åˆ‡æ¢é€»è¾‘
- âœ… é¢˜åº“åˆ é™¤åçš„æ¸…ç†

**éœ€è¦æ·»åŠ **ï¼š
```cpp
// è¿æ¥ PracticeWidget çš„åˆ‡æ¢è¯·æ±‚
connect(m_practiceWidget, &PracticeWidget::switchBankRequested,
        this, &MainWindow::onManageQuestionBanks);
```

---

## ä¿®å¤åçš„æ¶æ„

### èŒè´£æ¸…æ™°

| ç»„ä»¶ | èŒè´£ | æ•°æ®æº |
|------|------|--------|
| QuestionBankManager | é¢˜åº“å…ƒæ•°æ®ç®¡ç† | é…ç½®æ–‡ä»¶ + æ–‡ä»¶ç³»ç»Ÿ |
| QuestionBankManagerDialog | é¢˜åº“ç®¡ç†UI | QuestionBankManager |
| QuestionBankPanel | é¢˜ç›®åˆ—è¡¨æ˜¾ç¤º | MainWindow ä¼ å…¥ |
| PracticeWidget | åˆ·é¢˜ç»ƒä¹ åŠŸèƒ½ | QuestionBank |
| MainWindow | åè°ƒå’Œæ•°æ®æµè½¬ | - |

### æ•°æ®æµ

```
ç”¨æˆ·æ“ä½œ â†’ QuestionBankManagerDialog
         â†“
    é€‰æ‹©é¢˜åº“ (bankId)
         â†“
    MainWindow æ¥æ”¶ä¿¡å·
         â†“
    QuestionBankManager.getBankInfo(bankId)
         â†“
    QuestionBank.loadFromDirectory(path)
         â†“
    æ›´æ–° QuestionBankPanel å’Œ PracticeWidget
```

### ä¼˜åŠ¿

1. **èŒè´£å•ä¸€**ï¼šæ¯ä¸ªç»„ä»¶åªåšä¸€ä»¶äº‹
2. **æ•°æ®ç»Ÿä¸€**ï¼šQuestionBankManager æ˜¯å”¯ä¸€æ•°æ®æº
3. **æ˜“äºç»´æŠ¤**ï¼šä»£ç æ¸…æ™°ï¼Œé€»è¾‘ç®€å•
4. **é¿å…å†—ä½™**ï¼šåˆ é™¤é‡å¤ä»£ç 
5. **ç”¨æˆ·å‹å¥½**ï¼šç»Ÿä¸€çš„é¢˜åº“ç®¡ç†å…¥å£

---

## æµ‹è¯•è®¡åˆ’

### åŠŸèƒ½æµ‹è¯•

1. **é¢˜åº“ç®¡ç†**
   - [ ] æ‰“å¼€é¢˜åº“ç®¡ç†å¯¹è¯æ¡†
   - [ ] æŸ¥çœ‹é¢˜åº“åˆ—è¡¨
   - [ ] æŸ¥çœ‹é¢˜åº“è¯¦æƒ…ï¼ˆè·¯å¾„æ­£ç¡®ï¼‰
   - [ ] åˆ‡æ¢é¢˜åº“
   - [ ] åˆ é™¤é¢˜åº“
   - [ ] é‡å‘½åé¢˜åº“
   - [ ] åˆ·æ–°é¢˜åº“

2. **é¢˜ç›®åˆ—è¡¨**
   - [ ] æ˜¾ç¤ºå½“å‰é¢˜åº“é¢˜ç›®
   - [ ] æœç´¢é¢˜ç›®
   - [ ] éš¾åº¦ç­›é€‰
   - [ ] çŠ¶æ€å›¾æ ‡æ˜¾ç¤º
   - [ ] é€‰æ‹©é¢˜ç›®

3. **åˆ·é¢˜åŠŸèƒ½**
   - [ ] é¢˜ç›®è¡¨æ ¼æ˜¾ç¤º
   - [ ] ç­›é€‰å’Œæ’åº
   - [ ] éšæœºé¢˜ç›®
   - [ ] æ¨èé¢˜ç›®
   - [ ] ç»Ÿè®¡ä¿¡æ¯

4. **è·¯å¾„ä¿®å¤**
   - [ ] å¯åŠ¨æ—¶è‡ªåŠ¨ä¿®å¤é”™è¯¯è·¯å¾„
   - [ ] æ–°å¯¼å…¥é¢˜åº“è·¯å¾„æ­£ç¡®
   - [ ] é¢˜åº“è¯¦æƒ…æ˜¾ç¤ºç»å¯¹è·¯å¾„

### å›å½’æµ‹è¯•

- [ ] é¢˜åº“å¯¼å…¥åŠŸèƒ½
- [ ] é¢˜ç›®ç¼–è¾‘åŠŸèƒ½
- [ ] ä»£ç ç¼–è¯‘è¿è¡Œ
- [ ] è¿›åº¦ä¿å­˜
- [ ] ä¼šè¯æ¢å¤

---

## å®æ–½æ—¶é—´è¡¨

| æ­¥éª¤ | é¢„è®¡æ—¶é—´ | ä¼˜å…ˆçº§ |
|------|---------|--------|
| åˆ é™¤ QuestionListWidget.cpp | 1åˆ†é’Ÿ | é«˜ |
| ç®€åŒ– QuestionBankPanel | 30åˆ†é’Ÿ | é«˜ |
| æ›´æ–° PracticeWidget | 15åˆ†é’Ÿ | ä¸­ |
| æ›´æ–° MainWindow | 10åˆ†é’Ÿ | ä¸­ |
| æµ‹è¯•éªŒè¯ | 30åˆ†é’Ÿ | é«˜ |
| **æ€»è®¡** | **çº¦1.5å°æ—¶** | - |

---

## é£é™©è¯„ä¼°

| é£é™© | å½±å“ | æ¦‚ç‡ | ç¼“è§£æªæ–½ |
|------|------|------|---------|
| åˆ é™¤æ–‡ä»¶å¯¼è‡´ç¼–è¯‘é”™è¯¯ | ä½ | ä½ | QuestionListWidget æœªè¢«ä½¿ç”¨ |
| QuestionBankPanel ä¿®æ”¹å½±å“ç°æœ‰åŠŸèƒ½ | ä¸­ | ä½ | åªåˆ é™¤æœªä½¿ç”¨çš„é¢˜åº“æ¨¡å¼ |
| ç”¨æˆ·ä¹ æƒ¯æ”¹å˜ | ä½ | ä¸­ | åŠŸèƒ½æ›´é›†ä¸­ï¼Œæ›´æ˜“ç”¨ |

---

## æ€»ç»“

é€šè¿‡è¿™æ¬¡ä¿®å¤ï¼š

1. âœ… **åˆ é™¤å†—ä½™ä»£ç **ï¼šQuestionListWidget.cpp
2. âœ… **ç®€åŒ–æ¶æ„**ï¼šQuestionBankPanel ä¸“æ³¨é¢˜ç›®åˆ—è¡¨
3. âœ… **ç»Ÿä¸€ç®¡ç†**ï¼šQuestionBankManagerDialog å”¯ä¸€å…¥å£
4. âœ… **ä¿®å¤è·¯å¾„é—®é¢˜**ï¼šè‡ªåŠ¨éªŒè¯å’Œä¿®å¤
5. âœ… **æå‡å¯ç»´æŠ¤æ€§**ï¼šèŒè´£æ¸…æ™°ï¼Œé€»è¾‘ç®€å•

**å»ºè®®ç«‹å³å®æ–½**ï¼Œé£é™©ä½ï¼Œæ”¶ç›Šé«˜ã€‚
